Desrciption: Run autoconf to apply the configure.ac changes.
Author: Benjamin Drung <bdrung@ubuntu.com>
Forwarded: not-needed

--- a/configure
+++ b/configure
@@ -1,13 +1,13 @@
 #! /bin/sh
 # Guess values for system-dependent variables and create Makefiles.
-# Generated by GNU Autoconf 2.65 for audacious-plugins 2.4.0.
+# Generated by GNU Autoconf 2.67 for audacious-plugins 2.4.0.
 #
 # Report bugs to <bugs+audacious-plugins@atheme.org>.
 #
 #
 # Copyright (C) 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001,
-# 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009 Free Software Foundation,
-# Inc.
+# 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010 Free Software
+# Foundation, Inc.
 #
 #
 # This configure script is free software; the Free Software Foundation
@@ -319,7 +319,7 @@
       test -d "$as_dir" && break
     done
     test -z "$as_dirs" || eval "mkdir $as_dirs"
-  } || test -d "$as_dir" || as_fn_error "cannot create directory $as_dir"
+  } || test -d "$as_dir" || as_fn_error $? "cannot create directory $as_dir"
 
 
 } # as_fn_mkdir_p
@@ -359,19 +359,19 @@
 fi # as_fn_arith
 
 
-# as_fn_error ERROR [LINENO LOG_FD]
-# ---------------------------------
+# as_fn_error STATUS ERROR [LINENO LOG_FD]
+# ----------------------------------------
 # Output "`basename $0`: error: ERROR" to stderr. If LINENO and LOG_FD are
 # provided, also output the error to LOG_FD, referencing LINENO. Then exit the
-# script with status $?, using 1 if that was 0.
+# script with STATUS, using 1 if that was 0.
 as_fn_error ()
 {
-  as_status=$?; test $as_status -eq 0 && as_status=1
-  if test "$3"; then
-    as_lineno=${as_lineno-"$2"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
-    $as_echo "$as_me:${as_lineno-$LINENO}: error: $1" >&$3
+  as_status=$1; test $as_status -eq 0 && as_status=1
+  if test "$4"; then
+    as_lineno=${as_lineno-"$3"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+    $as_echo "$as_me:${as_lineno-$LINENO}: error: $2" >&$4
   fi
-  $as_echo "$as_me: error: $1" >&2
+  $as_echo "$as_me: error: $2" >&2
   as_fn_exit $as_status
 } # as_fn_error
 
@@ -533,7 +533,7 @@
 exec 6>&1
 
 # Name of the host.
-# hostname on some systems (SVR3.2, Linux) returns a bogus exit status,
+# hostname on some systems (SVR3.2, old GNU/Linux) returns a bogus exit status,
 # so uname gets run too.
 ac_hostname=`(hostname || uname -n) 2>/dev/null | sed 1q`
 
@@ -593,6 +593,7 @@
 # include <unistd.h>
 #endif"
 
+gt_needs=
 ac_subst_vars='LTLIBOBJS
 LIBOBJS
 GCC42_CFLAGS
@@ -670,18 +671,6 @@
 ALSA_CFLAGS
 OSS_LIBS
 OSS_CFLAGS
-CXXCPP
-BUILDERS_LIBS
-BUILDERS_LDFLAGS
-BUILDERS_CFLAGS
-SIDPLAY2_CFLAGS
-SIDPLAY2_LIBS
-SIDPLAY1_CFLAGS
-SIDPLAY1_LIBS
-SAMPLERATE_LIBS
-SAMPLERATE_CFLAGS
-JACK_LIBS
-JACK_CFLAGS
 FFMPEG_LIBS
 FFMPEG_CFLAGS
 SNDFILE_LIBS
@@ -691,6 +680,7 @@
 WAVPACK_LIBS
 WAVPACK_CFLAGS
 LIBFLAC_LIBS
+LIBFLAC_LIBDIR
 LIBFLAC_CFLAGS
 OGG_VORBIS_LIBS
 OGG_VORBIS_CFLAGS
@@ -714,21 +704,6 @@
 LIBROAR_CFLAGS
 PULSE_LIBS
 PULSE_CFLAGS
-PROG_IMPLIB_LDFLAGS
-PROG_IMPLIB_NEEDED
-CLEAN_LIB
-UNINSTALL_LIB
-INSTALL_LIB
-PLUGIN_SUFFIX
-PLUGIN_LDFLAGS
-PLUGIN_CFLAGS
-PLUGIN_CPPFLAGS
-LDFLAGS_RPATH
-LIB_SUFFIX
-LIB_PREFIX
-LIB_LDFLAGS
-LIB_CFLAGS
-LIB_CPPFLAGS
 USE_CHARDET
 USE_CHARDET_FALSE
 USE_CHARDET_TRUE
@@ -750,6 +725,8 @@
 PC_REQUIRES
 AUDACIOUS_LIBS
 AUDACIOUS_CFLAGS
+PKG_CONFIG_LIBDIR
+PKG_CONFIG_PATH
 PKG_CONFIG
 POSUB
 LTLIBINTL
@@ -757,12 +734,19 @@
 INTLLIBS
 LTLIBICONV
 LIBICONV
+INTL_MACOSX_LIBS
+XGETTEXT_EXTRA_OPTIONS
 MSGMERGE
+XGETTEXT_015
 XGETTEXT
+GMSGFMT_015
+MSGFMT_015
 GMSGFMT
 MSGFMT
+GETTEXT_MACRO_VERSION
 USE_NLS
-MKINSTALLDIRS
+mkdir_p
+MKDIR_P
 INSTALL_DATA
 INSTALL_SCRIPT
 INSTALL_PROGRAM
@@ -874,6 +858,7 @@
 enable_dockalbumart
 enable_altivec
 enable_sse2
+enable_psf
 enable_usf
 enable_mp3
 enable_rocklight
@@ -899,15 +884,6 @@
 enable_ffaudio
 enable_jack
 enable_sid
-with_sidplay1
-with_sidplay1_inc
-with_sidplay1_lib
-with_sidplay2
-with_sidplay2_inc
-with_sidplay2_lib
-with_sidbuilders
-with_builders_inc
-with_builders_lib
 enable_oss
 enable_oss4
 enable_alsa
@@ -924,6 +900,7 @@
 enable_paranormal
 with_sdl_prefix
 with_sdl_exec_prefix
+enable_sdltest
 enable_cue
 enable_projectm
 enable_projectm_1_0
@@ -949,6 +926,8 @@
 CCAS
 CCASFLAGS
 PKG_CONFIG
+PKG_CONFIG_PATH
+PKG_CONFIG_LIBDIR
 AUDACIOUS_CFLAGS
 AUDACIOUS_LIBS
 GLIB_CFLAGS
@@ -989,11 +968,6 @@
 SNDFILE_LIBS
 FFMPEG_CFLAGS
 FFMPEG_LIBS
-JACK_CFLAGS
-JACK_LIBS
-SAMPLERATE_CFLAGS
-SAMPLERATE_LIBS
-CXXCPP
 ALSA_CFLAGS
 ALSA_LIBS
 FLUIDSYNTH_CFLAGS
@@ -1090,8 +1064,9 @@
   fi
 
   case $ac_option in
-  *=*)	ac_optarg=`expr "X$ac_option" : '[^=]*=\(.*\)'` ;;
-  *)	ac_optarg=yes ;;
+  *=?*) ac_optarg=`expr "X$ac_option" : '[^=]*=\(.*\)'` ;;
+  *=)   ac_optarg= ;;
+  *)    ac_optarg=yes ;;
   esac
 
   # Accept the important Cygnus configure options, so we can diagnose typos.
@@ -1136,7 +1111,7 @@
     ac_useropt=`expr "x$ac_option" : 'x-*disable-\(.*\)'`
     # Reject names that are not valid shell variable names.
     expr "x$ac_useropt" : ".*[^-+._$as_cr_alnum]" >/dev/null &&
-      as_fn_error "invalid feature name: $ac_useropt"
+      as_fn_error $? "invalid feature name: $ac_useropt"
     ac_useropt_orig=$ac_useropt
     ac_useropt=`$as_echo "$ac_useropt" | sed 's/[-+.]/_/g'`
     case $ac_user_opts in
@@ -1162,7 +1137,7 @@
     ac_useropt=`expr "x$ac_option" : 'x-*enable-\([^=]*\)'`
     # Reject names that are not valid shell variable names.
     expr "x$ac_useropt" : ".*[^-+._$as_cr_alnum]" >/dev/null &&
-      as_fn_error "invalid feature name: $ac_useropt"
+      as_fn_error $? "invalid feature name: $ac_useropt"
     ac_useropt_orig=$ac_useropt
     ac_useropt=`$as_echo "$ac_useropt" | sed 's/[-+.]/_/g'`
     case $ac_user_opts in
@@ -1366,7 +1341,7 @@
     ac_useropt=`expr "x$ac_option" : 'x-*with-\([^=]*\)'`
     # Reject names that are not valid shell variable names.
     expr "x$ac_useropt" : ".*[^-+._$as_cr_alnum]" >/dev/null &&
-      as_fn_error "invalid package name: $ac_useropt"
+      as_fn_error $? "invalid package name: $ac_useropt"
     ac_useropt_orig=$ac_useropt
     ac_useropt=`$as_echo "$ac_useropt" | sed 's/[-+.]/_/g'`
     case $ac_user_opts in
@@ -1382,7 +1357,7 @@
     ac_useropt=`expr "x$ac_option" : 'x-*without-\(.*\)'`
     # Reject names that are not valid shell variable names.
     expr "x$ac_useropt" : ".*[^-+._$as_cr_alnum]" >/dev/null &&
-      as_fn_error "invalid package name: $ac_useropt"
+      as_fn_error $? "invalid package name: $ac_useropt"
     ac_useropt_orig=$ac_useropt
     ac_useropt=`$as_echo "$ac_useropt" | sed 's/[-+.]/_/g'`
     case $ac_user_opts in
@@ -1412,8 +1387,8 @@
   | --x-librar=* | --x-libra=* | --x-libr=* | --x-lib=* | --x-li=* | --x-l=*)
     x_libraries=$ac_optarg ;;
 
-  -*) as_fn_error "unrecognized option: \`$ac_option'
-Try \`$0 --help' for more information."
+  -*) as_fn_error $? "unrecognized option: \`$ac_option'
+Try \`$0 --help' for more information"
     ;;
 
   *=*)
@@ -1421,7 +1396,7 @@
     # Reject names that are not valid shell variable names.
     case $ac_envvar in #(
       '' | [0-9]* | *[!_$as_cr_alnum]* )
-      as_fn_error "invalid variable name: \`$ac_envvar'" ;;
+      as_fn_error $? "invalid variable name: \`$ac_envvar'" ;;
     esac
     eval $ac_envvar=\$ac_optarg
     export $ac_envvar ;;
@@ -1439,13 +1414,13 @@
 
 if test -n "$ac_prev"; then
   ac_option=--`echo $ac_prev | sed 's/_/-/g'`
-  as_fn_error "missing argument to $ac_option"
+  as_fn_error $? "missing argument to $ac_option"
 fi
 
 if test -n "$ac_unrecognized_opts"; then
   case $enable_option_checking in
     no) ;;
-    fatal) as_fn_error "unrecognized options: $ac_unrecognized_opts" ;;
+    fatal) as_fn_error $? "unrecognized options: $ac_unrecognized_opts" ;;
     *)     $as_echo "$as_me: WARNING: unrecognized options: $ac_unrecognized_opts" >&2 ;;
   esac
 fi
@@ -1468,7 +1443,7 @@
     [\\/$]* | ?:[\\/]* )  continue;;
     NONE | '' ) case $ac_var in *prefix ) continue;; esac;;
   esac
-  as_fn_error "expected an absolute directory name for --$ac_var: $ac_val"
+  as_fn_error $? "expected an absolute directory name for --$ac_var: $ac_val"
 done
 
 # There might be people who depend on the old broken behavior: `$host'
@@ -1482,8 +1457,8 @@
 if test "x$host_alias" != x; then
   if test "x$build_alias" = x; then
     cross_compiling=maybe
-    $as_echo "$as_me: WARNING: If you wanted to set the --build type, don't use --host.
-    If a cross compiler is detected then cross compile mode will be used." >&2
+    $as_echo "$as_me: WARNING: if you wanted to set the --build type, don't use --host.
+    If a cross compiler is detected then cross compile mode will be used" >&2
   elif test "x$build_alias" != "x$host_alias"; then
     cross_compiling=yes
   fi
@@ -1498,9 +1473,9 @@
 ac_pwd=`pwd` && test -n "$ac_pwd" &&
 ac_ls_di=`ls -di .` &&
 ac_pwd_ls_di=`cd "$ac_pwd" && ls -di .` ||
-  as_fn_error "working directory cannot be determined"
+  as_fn_error $? "working directory cannot be determined"
 test "X$ac_ls_di" = "X$ac_pwd_ls_di" ||
-  as_fn_error "pwd does not report name of working directory"
+  as_fn_error $? "pwd does not report name of working directory"
 
 
 # Find the source files, if location was not specified.
@@ -1539,11 +1514,11 @@
 fi
 if test ! -r "$srcdir/$ac_unique_file"; then
   test "$ac_srcdir_defaulted" = yes && srcdir="$ac_confdir or .."
-  as_fn_error "cannot find sources ($ac_unique_file) in $srcdir"
+  as_fn_error $? "cannot find sources ($ac_unique_file) in $srcdir"
 fi
 ac_msg="sources are in $srcdir, but \`cd $srcdir' does not work"
 ac_abs_confdir=`(
-	cd "$srcdir" && test -r "./$ac_unique_file" || as_fn_error "$ac_msg"
+	cd "$srcdir" && test -r "./$ac_unique_file" || as_fn_error $? "$ac_msg"
 	pwd)`
 # When building in place, set srcdir=.
 if test "$ac_abs_confdir" = "$ac_pwd"; then
@@ -1583,7 +1558,7 @@
       --help=short        display options specific to this package
       --help=recursive    display the short help of all the included packages
   -V, --version           display version information and exit
-  -q, --quiet, --silent   do not print \`checking...' messages
+  -q, --quiet, --silent   do not print \`checking ...' messages
       --cache-file=FILE   cache test results in FILE [disabled]
   -C, --config-cache      alias for \`--cache-file=config.cache'
   -n, --no-create         do not create output files
@@ -1659,6 +1634,7 @@
   --disable-dockalbumart  disable MacOS dock albumart plugin (default=guess)
   --disable-altivec       disable AltiVec support. (default=enabled)
   --disable-sse2          disable SSE2 support. (default=enabled)
+  --disable-psf            disable PlayStation (psf/psf2) audio decoder
   --enable-usf            enable the USF input plugin (default=disabled)
   --disable-mp3           disable mp3 plugin. (default=enabled)
   --disable-rocklight     disable Rocklight vis plugin (default=enabled)
@@ -1673,7 +1649,7 @@
   --disable-adplug        disable AdPlug plugin (default=enabled)
   --disable-vorbis        disable Ogg Vorbis input plugin (default=enabled)
   --disable-flacng        disable flac input plugin (default=enabled)
-  --disable-libFLACtest   do not try to compile and run a test libFLAC program
+  --disable-libFLACtest       Do not try to compile and run a test libFLAC program
   --disable-wavpack       disable WavPack input plugin (default=enabled)
   --disable-aac           disable aac plugin (default=enabled)
   --disable-sndfile       disable sndfile extensions. default=enabled
@@ -1695,6 +1671,7 @@
   --disable-mtp_up           disable mtp upload support. (default=enabled)
   --disable-bluetooth           disable bluetooth audio support. (default=enabled)
   --disable-paranormal    disable paranormal vis plugin. (default=enabled)
+  --disable-sdltest       Do not try to compile and run a test SDL program
   --disable-cue           disable cue support. (default=enabled)
   --disable-projectm      disable projectM vis plugin. (default=enabled)
   --disable-projectm-1.0      disable projectM 1.0+ vis plugin. (default=enabled)
@@ -1718,15 +1695,6 @@
   --with-libFLAC=PFX   Prefix where libFLAC is installed (optional)
   --with-libFLAC-libraries=DIR   Directory where libFLAC library is installed (optional)
   --with-libFLAC-includes=DIR   Directory where libFLAC header files are installed (optional)
-  --with-sidplay1=PREFIX  Enable libSIDPlay1 with install-PREFIX
-  --with-sidplay1-inc=DIR Where the libSIDPlay1 headers are located
-  --with-sidplay1-lib=DIR Where the libSIDPlay1 library is installed
-  --with-sidplay2=PREFIX  Enable libSIDPlay2 with install-PREFIX
-  --with-sidplay2-inc=DIR Where the libSIDPlay2 headers are located
-  --with-sidplay2-lib=DIR Where the libSIDPlay2 library is installed
-  --with-sidbuilders=DIR  What the SIDPlay2 builders install PREFIX is
-  --with-builders-inc=DIR Where the SIDPlay2 builders headers are located
-  --with-builders-lib=DIR Where the SIDPlay2 builders libraries are installed
   --with-sdl-prefix=PFX   Prefix where SDL is installed (optional)
   --with-sdl-exec-prefix=PFX Exec prefix where SDL is installed (optional)
 
@@ -1744,6 +1712,10 @@
   CCAS        assembler compiler command (defaults to CC)
   CCASFLAGS   assembler compiler flags (defaults to CFLAGS)
   PKG_CONFIG  path to pkg-config utility
+  PKG_CONFIG_PATH
+              directories to add to pkg-config's search path
+  PKG_CONFIG_LIBDIR
+              path overriding pkg-config's built-in search path
   AUDACIOUS_CFLAGS
               C compiler flags for AUDACIOUS, overriding pkg-config
   AUDACIOUS_LIBS
@@ -1808,13 +1780,6 @@
   FFMPEG_CFLAGS
               C compiler flags for FFMPEG, overriding pkg-config
   FFMPEG_LIBS linker flags for FFMPEG, overriding pkg-config
-  JACK_CFLAGS C compiler flags for JACK, overriding pkg-config
-  JACK_LIBS   linker flags for JACK, overriding pkg-config
-  SAMPLERATE_CFLAGS
-              C compiler flags for SAMPLERATE, overriding pkg-config
-  SAMPLERATE_LIBS
-              linker flags for SAMPLERATE, overriding pkg-config
-  CXXCPP      C++ preprocessor
   ALSA_CFLAGS C compiler flags for ALSA, overriding pkg-config
   ALSA_LIBS   linker flags for ALSA, overriding pkg-config
   FLUIDSYNTH_CFLAGS
@@ -1928,9 +1893,9 @@
 if $ac_init_version; then
   cat <<\_ACEOF
 audacious-plugins configure 2.4.0
-generated by GNU Autoconf 2.65
+generated by GNU Autoconf 2.67
 
-Copyright (C) 2009 Free Software Foundation, Inc.
+Copyright (C) 2010 Free Software Foundation, Inc.
 This configure script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it.
 _ACEOF
@@ -2126,7 +2091,7 @@
     mv -f conftest.er1 conftest.err
   fi
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
-  test $ac_status = 0; } >/dev/null && {
+  test $ac_status = 0; } > conftest.i && {
 	 test -z "$ac_c_preproc_warn_flag$ac_c_werror_flag" ||
 	 test ! -s conftest.err
        }; then :
@@ -2151,7 +2116,7 @@
   as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
 $as_echo_n "checking for $2... " >&6; }
-if { as_var=$3; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval "test \"\${$3+set}\"" = set; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -2181,7 +2146,7 @@
   as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
 $as_echo_n "checking for $2... " >&6; }
-if { as_var=$3; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval "test \"\${$3+set}\"" = set; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -2248,10 +2213,10 @@
 ac_fn_c_check_header_mongrel ()
 {
   as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
-  if { as_var=$3; eval "test \"\${$as_var+set}\" = set"; }; then :
+  if eval "test \"\${$3+set}\"" = set; then :
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
 $as_echo_n "checking for $2... " >&6; }
-if { as_var=$3; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval "test \"\${$3+set}\"" = set; then :
   $as_echo_n "(cached) " >&6
 fi
 eval ac_res=\$$3
@@ -2287,7 +2252,7 @@
 else
   ac_header_preproc=no
 fi
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_header_preproc" >&5
 $as_echo "$ac_header_preproc" >&6; }
 
@@ -2310,17 +2275,15 @@
 $as_echo "$as_me: WARNING: $2:     section \"Present But Cannot Be Compiled\"" >&2;}
     { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: proceeding with the compiler's result" >&5
 $as_echo "$as_me: WARNING: $2: proceeding with the compiler's result" >&2;}
-( cat <<\_ASBOX
-## ------------------------------------------------ ##
+( $as_echo "## ------------------------------------------------ ##
 ## Report this to bugs+audacious-plugins@atheme.org ##
-## ------------------------------------------------ ##
-_ASBOX
+## ------------------------------------------------ ##"
      ) | sed "s/^/$as_me: WARNING:     /" >&2
     ;;
 esac
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
 $as_echo_n "checking for $2... " >&6; }
-if { as_var=$3; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval "test \"\${$3+set}\"" = set; then :
   $as_echo_n "(cached) " >&6
 else
   eval "$3=\$ac_header_compiler"
@@ -2333,15 +2296,18 @@
 
 } # ac_fn_c_check_header_mongrel
 
-# ac_fn_c_check_decl LINENO SYMBOL VAR
-# ------------------------------------
-# Tests whether SYMBOL is declared, setting cache variable VAR accordingly.
+# ac_fn_c_check_decl LINENO SYMBOL VAR INCLUDES
+# ---------------------------------------------
+# Tests whether SYMBOL is declared in INCLUDES, setting cache variable VAR
+# accordingly.
 ac_fn_c_check_decl ()
 {
   as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $2 is declared" >&5
-$as_echo_n "checking whether $2 is declared... " >&6; }
-if { as_var=$3; eval "test \"\${$as_var+set}\" = set"; }; then :
+  as_decl_name=`echo $2|sed 's/ *(.*//'`
+  as_decl_use=`echo $2|sed -e 's/(/((/' -e 's/)/) 0&/' -e 's/,/) 0& (/g'`
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $as_decl_name is declared" >&5
+$as_echo_n "checking whether $as_decl_name is declared... " >&6; }
+if eval "test \"\${$3+set}\"" = set; then :
   $as_echo_n "(cached) " >&6
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -2350,8 +2316,12 @@
 int
 main ()
 {
-#ifndef $2
-  (void) $2;
+#ifndef $as_decl_name
+#ifdef __cplusplus
+  (void) $as_decl_use;
+#else
+  (void) $as_decl_name;
+#endif
 #endif
 
   ;
@@ -2371,95 +2341,12 @@
   eval $as_lineno_stack; test "x$as_lineno_stack" = x && { as_lineno=; unset as_lineno;}
 
 } # ac_fn_c_check_decl
-
-# ac_fn_cxx_try_link LINENO
-# -------------------------
-# Try to link conftest.$ac_ext, and return whether this succeeded.
-ac_fn_cxx_try_link ()
-{
-  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
-  rm -f conftest.$ac_objext conftest$ac_exeext
-  if { { ac_try="$ac_link"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
-$as_echo "$ac_try_echo"; } >&5
-  (eval "$ac_link") 2>conftest.err
-  ac_status=$?
-  if test -s conftest.err; then
-    grep -v '^ *+' conftest.err >conftest.er1
-    cat conftest.er1 >&5
-    mv -f conftest.er1 conftest.err
-  fi
-  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
-  test $ac_status = 0; } && {
-	 test -z "$ac_cxx_werror_flag" ||
-	 test ! -s conftest.err
-       } && test -s conftest$ac_exeext && {
-	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
-       }; then :
-  ac_retval=0
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-	ac_retval=1
-fi
-  # Delete the IPA/IPO (Inter Procedural Analysis/Optimization) information
-  # created by the PGI compiler (conftest_ipa8_conftest.oo), as it would
-  # interfere with the next link command; also delete a directory that is
-  # left behind by Apple's compiler.  We do this before executing the actions.
-  rm -rf conftest.dSYM conftest_ipa8_conftest.oo
-  eval $as_lineno_stack; test "x$as_lineno_stack" = x && { as_lineno=; unset as_lineno;}
-  as_fn_set_status $ac_retval
-
-} # ac_fn_cxx_try_link
-
-# ac_fn_cxx_try_cpp LINENO
-# ------------------------
-# Try to preprocess conftest.$ac_ext, and return whether this succeeded.
-ac_fn_cxx_try_cpp ()
-{
-  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
-  if { { ac_try="$ac_cpp conftest.$ac_ext"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
-$as_echo "$ac_try_echo"; } >&5
-  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.err
-  ac_status=$?
-  if test -s conftest.err; then
-    grep -v '^ *+' conftest.err >conftest.er1
-    cat conftest.er1 >&5
-    mv -f conftest.er1 conftest.err
-  fi
-  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
-  test $ac_status = 0; } >/dev/null && {
-	 test -z "$ac_cxx_preproc_warn_flag$ac_cxx_werror_flag" ||
-	 test ! -s conftest.err
-       }; then :
-  ac_retval=0
-else
-  $as_echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-    ac_retval=1
-fi
-  eval $as_lineno_stack; test "x$as_lineno_stack" = x && { as_lineno=; unset as_lineno;}
-  as_fn_set_status $ac_retval
-
-} # ac_fn_cxx_try_cpp
 cat >config.log <<_ACEOF
 This file contains any messages produced by compilers while
 running configure, to aid debugging if configure makes a mistake.
 
 It was created by audacious-plugins $as_me 2.4.0, which was
-generated by GNU Autoconf 2.65.  Invocation command line was
+generated by GNU Autoconf 2.67.  Invocation command line was
 
   $ $0 $@
 
@@ -2569,11 +2456,9 @@
   {
     echo
 
-    cat <<\_ASBOX
-## ---------------- ##
+    $as_echo "## ---------------- ##
 ## Cache variables. ##
-## ---------------- ##
-_ASBOX
+## ---------------- ##"
     echo
     # The following way of writing the cache mishandles newlines in values,
 (
@@ -2607,11 +2492,9 @@
 )
     echo
 
-    cat <<\_ASBOX
-## ----------------- ##
+    $as_echo "## ----------------- ##
 ## Output variables. ##
-## ----------------- ##
-_ASBOX
+## ----------------- ##"
     echo
     for ac_var in $ac_subst_vars
     do
@@ -2624,11 +2507,9 @@
     echo
 
     if test -n "$ac_subst_files"; then
-      cat <<\_ASBOX
-## ------------------- ##
+      $as_echo "## ------------------- ##
 ## File substitutions. ##
-## ------------------- ##
-_ASBOX
+## ------------------- ##"
       echo
       for ac_var in $ac_subst_files
       do
@@ -2642,11 +2523,9 @@
     fi
 
     if test -s confdefs.h; then
-      cat <<\_ASBOX
-## ----------- ##
+      $as_echo "## ----------- ##
 ## confdefs.h. ##
-## ----------- ##
-_ASBOX
+## ----------- ##"
       echo
       cat confdefs.h
       echo
@@ -2701,7 +2580,12 @@
 ac_site_file1=NONE
 ac_site_file2=NONE
 if test -n "$CONFIG_SITE"; then
-  ac_site_file1=$CONFIG_SITE
+  # We do not want a PATH search for config.site.
+  case $CONFIG_SITE in #((
+    -*)  ac_site_file1=./$CONFIG_SITE;;
+    */*) ac_site_file1=$CONFIG_SITE;;
+    *)   ac_site_file1=./$CONFIG_SITE;;
+  esac
 elif test "x$prefix" != xNONE; then
   ac_site_file1=$prefix/share/config.site
   ac_site_file2=$prefix/etc/config.site
@@ -2716,7 +2600,11 @@
     { $as_echo "$as_me:${as_lineno-$LINENO}: loading site script $ac_site_file" >&5
 $as_echo "$as_me: loading site script $ac_site_file" >&6;}
     sed 's/^/| /' "$ac_site_file" >&5
-    . "$ac_site_file"
+    . "$ac_site_file" \
+      || { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error $? "failed to load site script $ac_site_file
+See \`config.log' for more details" "$LINENO" 5 ; }
   fi
 done
 
@@ -2737,6 +2625,7 @@
   >$cache_file
 fi
 
+gt_needs="$gt_needs "
 # Check that the precious variables saved in the cache have kept the same
 # value.
 ac_cache_corrupted=false
@@ -2792,7 +2681,7 @@
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
   { $as_echo "$as_me:${as_lineno-$LINENO}: error: changes in the environment can compromise the build" >&5
 $as_echo "$as_me: error: changes in the environment can compromise the build" >&2;}
-  as_fn_error "run \`make distclean' and/or \`rm $cache_file' and start over" "$LINENO" 5
+  as_fn_error $? "run \`make distclean' and/or \`rm $cache_file' and start over" "$LINENO" 5
 fi
 ## -------------------- ##
 ## Main body of script. ##
@@ -2809,16 +2698,22 @@
 
 ac_aux_dir=
 for ac_dir in "$srcdir" "$srcdir/.." "$srcdir/../.."; do
-  for ac_t in install-sh install.sh shtool; do
-    if test -f "$ac_dir/$ac_t"; then
-      ac_aux_dir=$ac_dir
-      ac_install_sh="$ac_aux_dir/$ac_t -c"
-      break 2
-    fi
-  done
+  if test -f "$ac_dir/install-sh"; then
+    ac_aux_dir=$ac_dir
+    ac_install_sh="$ac_aux_dir/install-sh -c"
+    break
+  elif test -f "$ac_dir/install.sh"; then
+    ac_aux_dir=$ac_dir
+    ac_install_sh="$ac_aux_dir/install.sh -c"
+    break
+  elif test -f "$ac_dir/shtool"; then
+    ac_aux_dir=$ac_dir
+    ac_install_sh="$ac_aux_dir/shtool install -c"
+    break
+  fi
 done
 if test -z "$ac_aux_dir"; then
-  as_fn_error "cannot find install-sh, install.sh, or shtool in \"$srcdir\" \"$srcdir/..\" \"$srcdir/../..\"" "$LINENO" 5
+  as_fn_error $? "cannot find install-sh, install.sh, or shtool in \"$srcdir\" \"$srcdir/..\" \"$srcdir/../..\"" "$LINENO" 5
 fi
 
 # These three variables are undocumented and unsupported,
@@ -2832,7 +2727,7 @@
 
 # Make sure we can run config.sub.
 $SHELL "$ac_aux_dir/config.sub" sun4 >/dev/null 2>&1 ||
-  as_fn_error "cannot run $SHELL $ac_aux_dir/config.sub" "$LINENO" 5
+  as_fn_error $? "cannot run $SHELL $ac_aux_dir/config.sub" "$LINENO" 5
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking build system type" >&5
 $as_echo_n "checking build system type... " >&6; }
@@ -2843,16 +2738,16 @@
 test "x$ac_build_alias" = x &&
   ac_build_alias=`$SHELL "$ac_aux_dir/config.guess"`
 test "x$ac_build_alias" = x &&
-  as_fn_error "cannot guess build type; you must specify one" "$LINENO" 5
+  as_fn_error $? "cannot guess build type; you must specify one" "$LINENO" 5
 ac_cv_build=`$SHELL "$ac_aux_dir/config.sub" $ac_build_alias` ||
-  as_fn_error "$SHELL $ac_aux_dir/config.sub $ac_build_alias failed" "$LINENO" 5
+  as_fn_error $? "$SHELL $ac_aux_dir/config.sub $ac_build_alias failed" "$LINENO" 5
 
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_build" >&5
 $as_echo "$ac_cv_build" >&6; }
 case $ac_cv_build in
 *-*-*) ;;
-*) as_fn_error "invalid value of canonical build" "$LINENO" 5;;
+*) as_fn_error $? "invalid value of canonical build" "$LINENO" 5 ;;
 esac
 build=$ac_cv_build
 ac_save_IFS=$IFS; IFS='-'
@@ -2877,7 +2772,7 @@
   ac_cv_host=$ac_cv_build
 else
   ac_cv_host=`$SHELL "$ac_aux_dir/config.sub" $host_alias` ||
-    as_fn_error "$SHELL $ac_aux_dir/config.sub $host_alias failed" "$LINENO" 5
+    as_fn_error $? "$SHELL $ac_aux_dir/config.sub $host_alias failed" "$LINENO" 5
 fi
 
 fi
@@ -2885,7 +2780,7 @@
 $as_echo "$ac_cv_host" >&6; }
 case $ac_cv_host in
 *-*-*) ;;
-*) as_fn_error "invalid value of canonical host" "$LINENO" 5;;
+*) as_fn_error $? "invalid value of canonical host" "$LINENO" 5 ;;
 esac
 host=$ac_cv_host
 ac_save_IFS=$IFS; IFS='-'
@@ -2910,7 +2805,7 @@
   ac_cv_target=$ac_cv_host
 else
   ac_cv_target=`$SHELL "$ac_aux_dir/config.sub" $target_alias` ||
-    as_fn_error "$SHELL $ac_aux_dir/config.sub $target_alias failed" "$LINENO" 5
+    as_fn_error $? "$SHELL $ac_aux_dir/config.sub $target_alias failed" "$LINENO" 5
 fi
 
 fi
@@ -2918,7 +2813,7 @@
 $as_echo "$ac_cv_target" >&6; }
 case $ac_cv_target in
 *-*-*) ;;
-*) as_fn_error "invalid value of canonical target" "$LINENO" 5;;
+*) as_fn_error $? "invalid value of canonical target" "$LINENO" 5 ;;
 esac
 target=$ac_cv_target
 ac_save_IFS=$IFS; IFS='-'
@@ -3268,8 +3163,8 @@
 
 test -z "$CC" && { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-as_fn_error "no acceptable C compiler found in \$PATH
-See \`config.log' for more details." "$LINENO" 5; }
+as_fn_error $? "no acceptable C compiler found in \$PATH
+See \`config.log' for more details" "$LINENO" 5 ; }
 
 # Provide some information about the compiler.
 $as_echo "$as_me:${as_lineno-$LINENO}: checking for C compiler version" >&5
@@ -3383,9 +3278,8 @@
 
 { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-{ as_fn_set_status 77
-as_fn_error "C compiler cannot create executables
-See \`config.log' for more details." "$LINENO" 5; }; }
+as_fn_error 77 "C compiler cannot create executables
+See \`config.log' for more details" "$LINENO" 5 ; }
 else
   { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
@@ -3427,8 +3321,8 @@
 else
   { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-as_fn_error "cannot compute suffix of executables: cannot compile and link
-See \`config.log' for more details." "$LINENO" 5; }
+as_fn_error $? "cannot compute suffix of executables: cannot compile and link
+See \`config.log' for more details" "$LINENO" 5 ; }
 fi
 rm -f conftest conftest$ac_cv_exeext
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_exeext" >&5
@@ -3485,9 +3379,9 @@
     else
 	{ { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-as_fn_error "cannot run C compiled programs.
+as_fn_error $? "cannot run C compiled programs.
 If you meant to cross compile, use \`--host'.
-See \`config.log' for more details." "$LINENO" 5; }
+See \`config.log' for more details" "$LINENO" 5 ; }
     fi
   fi
 fi
@@ -3538,8 +3432,8 @@
 
 { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-as_fn_error "cannot compute suffix of object files: cannot compile
-See \`config.log' for more details." "$LINENO" 5; }
+as_fn_error $? "cannot compute suffix of object files: cannot compile
+See \`config.log' for more details" "$LINENO" 5 ; }
 fi
 rm -f conftest.$ac_cv_objext conftest.$ac_ext
 fi
@@ -4017,14 +3911,12 @@
 ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
 
-
-        { $as_echo "$as_me:${as_lineno-$LINENO}: checking for strerror in -lcposix" >&5
-$as_echo_n "checking for strerror in -lcposix... " >&6; }
-if test "${ac_cv_lib_cposix_strerror+set}" = set; then :
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for library containing strerror" >&5
+$as_echo_n "checking for library containing strerror... " >&6; }
+if test "${ac_cv_search_strerror+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lcposix  $LIBS"
+  ac_func_search_save_LIBS=$LIBS
 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
@@ -4043,22 +3935,37 @@
   return 0;
 }
 _ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_lib_cposix_strerror=yes
-else
-  ac_cv_lib_cposix_strerror=no
+for ac_lib in '' cposix; do
+  if test -z "$ac_lib"; then
+    ac_res="none required"
+  else
+    ac_res=-l$ac_lib
+    LIBS="-l$ac_lib  $ac_func_search_save_LIBS"
+  fi
+  if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_search_strerror=$ac_res
 fi
 rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_cposix_strerror" >&5
-$as_echo "$ac_cv_lib_cposix_strerror" >&6; }
-if test "x$ac_cv_lib_cposix_strerror" = x""yes; then :
-  LIBS="$LIBS -lcposix"
+    conftest$ac_exeext
+  if test "${ac_cv_search_strerror+set}" = set; then :
+  break
 fi
+done
+if test "${ac_cv_search_strerror+set}" = set; then :
 
+else
+  ac_cv_search_strerror=no
+fi
+rm conftest.$ac_ext
+LIBS=$ac_func_search_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_search_strerror" >&5
+$as_echo "$ac_cv_search_strerror" >&6; }
+ac_res=$ac_cv_search_strerror
+if test "$ac_res" != no; then :
+  test "$ac_res" = "none required" || LIBS="$ac_res $LIBS"
 
+fi
 
 ac_ext=c
 ac_cpp='$CPP $CPPFLAGS'
@@ -4102,7 +4009,7 @@
   # Broken: fails on valid input.
 continue
 fi
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
   # OK, works on sane cases.  Now check whether nonexistent headers
   # can be detected and how.
@@ -4118,11 +4025,11 @@
 ac_preproc_ok=:
 break
 fi
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
 done
 # Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.i conftest.err conftest.$ac_ext
 if $ac_preproc_ok; then :
   break
 fi
@@ -4161,7 +4068,7 @@
   # Broken: fails on valid input.
 continue
 fi
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
   # OK, works on sane cases.  Now check whether nonexistent headers
   # can be detected and how.
@@ -4177,18 +4084,18 @@
 ac_preproc_ok=:
 break
 fi
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.err conftest.i conftest.$ac_ext
 
 done
 # Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
-rm -f conftest.err conftest.$ac_ext
+rm -f conftest.i conftest.err conftest.$ac_ext
 if $ac_preproc_ok; then :
 
 else
   { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-as_fn_error "C preprocessor \"$CPP\" fails sanity check
-See \`config.log' for more details." "$LINENO" 5; }
+as_fn_error $? "C preprocessor \"$CPP\" fails sanity check
+See \`config.log' for more details" "$LINENO" 5 ; }
 fi
 
 ac_ext=c
@@ -4249,7 +4156,7 @@
   done
 IFS=$as_save_IFS
   if test -z "$ac_cv_path_GREP"; then
-    as_fn_error "no acceptable grep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" "$LINENO" 5
+    as_fn_error $? "no acceptable grep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" "$LINENO" 5
   fi
 else
   ac_cv_path_GREP=$GREP
@@ -4315,7 +4222,7 @@
   done
 IFS=$as_save_IFS
   if test -z "$ac_cv_path_EGREP"; then
-    as_fn_error "no acceptable egrep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" "$LINENO" 5
+    as_fn_error $? "no acceptable egrep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" "$LINENO" 5
   fi
 else
   ac_cv_path_EGREP=$EGREP
@@ -4447,8 +4354,7 @@
   as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
 ac_fn_c_check_header_compile "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default
 "
-eval as_val=\$$as_ac_Header
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
   cat >>confdefs.h <<_ACEOF
 #define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
 _ACEOF
@@ -4678,8 +4584,8 @@
 
      ;; #(
    *)
-     as_fn_error "unknown endianness
- presetting ac_cv_c_bigendian=no (or yes) will help" "$LINENO" 5 ;;
+     as_fn_error $? "unknown endianness
+ presetting ac_cv_c_bigendian=no (or yes) will help" "$LINENO" 5  ;;
  esac
 
 
@@ -5002,7 +4908,7 @@
 $as_echo_n "checking whether ${MAKE-make} sets \$(MAKE)... " >&6; }
 set x ${MAKE-make}
 ac_make=`$as_echo "$2" | sed 's/+/p/g; s/[^a-zA-Z0-9_]/_/g'`
-if { as_var=ac_cv_prog_make_${ac_make}_set; eval "test \"\${$as_var+set}\" = set"; }; then :
+if eval "test \"\${ac_cv_prog_make_${ac_make}_set+set}\"" = set; then :
   $as_echo_n "(cached) " >&6
 else
   cat >conftest.make <<\_ACEOF
@@ -5010,7 +4916,7 @@
 all:
 	@echo '@@@%%%=$(MAKE)=@@@%%%'
 _ACEOF
-# GNU make sometimes prints "make[1]: Entering...", which would confuse us.
+# GNU make sometimes prints "make[1]: Entering ...", which would confuse us.
 case `${MAKE-make} -f conftest.make 2>/dev/null` in
   *@@@%%%=?*=@@@%%%*)
     eval ac_cv_prog_make_${ac_make}_set=yes;;
@@ -5364,18 +5270,53 @@
 
 test -z "$INSTALL_DATA" && INSTALL_DATA='${INSTALL} -m 644'
 
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for a thread-safe mkdir -p" >&5
+$as_echo_n "checking for a thread-safe mkdir -p... " >&6; }
+if test -z "$MKDIR_P"; then
+  if test "${ac_cv_path_mkdir+set}" = set; then :
+  $as_echo_n "(cached) " >&6
+else
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH$PATH_SEPARATOR/opt/sfw/bin
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_prog in mkdir gmkdir; do
+	 for ac_exec_ext in '' $ac_executable_extensions; do
+	   { test -f "$as_dir/$ac_prog$ac_exec_ext" && $as_test_x "$as_dir/$ac_prog$ac_exec_ext"; } || continue
+	   case `"$as_dir/$ac_prog$ac_exec_ext" --version 2>&1` in #(
+	     'mkdir (GNU coreutils) '* | \
+	     'mkdir (coreutils) '* | \
+	     'mkdir (fileutils) '4.1*)
+	       ac_cv_path_mkdir=$as_dir/$ac_prog$ac_exec_ext
+	       break 3;;
+	   esac
+	 done
+       done
+  done
+IFS=$as_save_IFS
+
+fi
 
-        MKINSTALLDIRS=
-  if test -n "$ac_aux_dir"; then
-    case "$ac_aux_dir" in
-      /*) MKINSTALLDIRS="$ac_aux_dir/mkinstalldirs" ;;
-      *) MKINSTALLDIRS="\$(top_builddir)/$ac_aux_dir/mkinstalldirs" ;;
-    esac
-  fi
-  if test -z "$MKINSTALLDIRS"; then
-    MKINSTALLDIRS="\$(top_srcdir)/mkinstalldirs"
+  test -d ./--version && rmdir ./--version
+  if test "${ac_cv_path_mkdir+set}" = set; then
+    MKDIR_P="$ac_cv_path_mkdir -p"
+  else
+    # As a last resort, use the slow shell script.  Don't cache a
+    # value for MKDIR_P within a source directory, because that will
+    # break other packages using the cache if that directory is
+    # removed, or if the value is a relative name.
+    MKDIR_P="$ac_install_sh -d"
   fi
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $MKDIR_P" >&5
+$as_echo "$MKDIR_P" >&6; }
 
+mkdir_p="$MKDIR_P"
+case $mkdir_p in
+  [\\/$]* | ?:[\\/]*) ;;
+  */*) mkdir_p="\$(top_builddir)/$mkdir_p" ;;
+esac
 
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether NLS is requested" >&5
@@ -5393,6 +5334,9 @@
 
 
 
+      GETTEXT_MACRO_VERSION=0.18
+
+
 
 
 # Prepare PATH_SEPARATOR.
@@ -5441,7 +5385,8 @@
       test -z "$ac_dir" && ac_dir=.
       for ac_exec_ext in '' $ac_executable_extensions; do
         if $ac_executable_p "$ac_dir/$ac_word$ac_exec_ext"; then
-          if $ac_dir/$ac_word --statistics /dev/null >/dev/null 2>&1 &&
+          echo "$as_me: trying $ac_dir/$ac_word..." >&5
+          if $ac_dir/$ac_word --statistics /dev/null >&5 2>&1 &&
      (if $ac_dir/$ac_word --statistics /dev/null 2>&1 >/dev/null | grep usage >/dev/null; then exit 1; else exit 0; fi); then
             ac_cv_path_MSGFMT="$ac_dir/$ac_word$ac_exec_ext"
             break 2
@@ -5505,6 +5450,17 @@
 
 
 
+    case `$MSGFMT --version | sed 1q | sed -e 's,^[^0-9]*,,'` in
+    '' | 0.[0-9] | 0.[0-9].* | 0.1[0-4] | 0.1[0-4].*) MSGFMT_015=: ;;
+    *) MSGFMT_015=$MSGFMT ;;
+  esac
+
+  case `$GMSGFMT --version | sed 1q | sed -e 's,^[^0-9]*,,'` in
+    '' | 0.[0-9] | 0.[0-9].* | 0.1[0-4] | 0.1[0-4].*) GMSGFMT_015=: ;;
+    *) GMSGFMT_015=$GMSGFMT ;;
+  esac
+
+
 
 # Prepare PATH_SEPARATOR.
 # The user is always right.
@@ -5552,7 +5508,8 @@
       test -z "$ac_dir" && ac_dir=.
       for ac_exec_ext in '' $ac_executable_extensions; do
         if $ac_executable_p "$ac_dir/$ac_word$ac_exec_ext"; then
-          if $ac_dir/$ac_word --omit-header --copyright-holder= --msgid-bugs-address= /dev/null >/dev/null 2>&1 &&
+          echo "$as_me: trying $ac_dir/$ac_word..." >&5
+          if $ac_dir/$ac_word --omit-header --copyright-holder= --msgid-bugs-address= /dev/null >&5 2>&1 &&
      (if $ac_dir/$ac_word --omit-header --copyright-holder= --msgid-bugs-address= /dev/null 2>&1 >/dev/null | grep usage >/dev/null; then exit 1; else exit 0; fi); then
             ac_cv_path_XGETTEXT="$ac_dir/$ac_word$ac_exec_ext"
             break 2
@@ -5576,6 +5533,12 @@
 
     rm -f messages.po
 
+    case `$XGETTEXT --version | sed 1q | sed -e 's,^[^0-9]*,,'` in
+    '' | 0.[0-9] | 0.[0-9].* | 0.1[0-4] | 0.1[0-4].*) XGETTEXT_015=: ;;
+    *) XGETTEXT_015=$XGETTEXT ;;
+  esac
+
+
 
 # Prepare PATH_SEPARATOR.
 # The user is always right.
@@ -5623,7 +5586,8 @@
       test -z "$ac_dir" && ac_dir=.
       for ac_exec_ext in '' $ac_executable_extensions; do
         if $ac_executable_p "$ac_dir/$ac_word$ac_exec_ext"; then
-          if $ac_dir/$ac_word --update -q /dev/null /dev/null >/dev/null 2>&1; then
+          echo "$as_me: trying $ac_dir/$ac_word..." >&5
+          if $ac_dir/$ac_word --update -q /dev/null /dev/null >&5 2>&1; then
             ac_cv_path_MSGMERGE="$ac_dir/$ac_word$ac_exec_ext"
             break 2
           fi
@@ -5645,31 +5609,13 @@
 fi
 
 
-      if test "$GMSGFMT" != ":"; then
-            if $GMSGFMT --statistics /dev/null >/dev/null 2>&1 &&
-       (if $GMSGFMT --statistics /dev/null 2>&1 >/dev/null | grep usage >/dev/null; then exit 1; else exit 0; fi); then
-      : ;
-    else
-      GMSGFMT=`echo "$GMSGFMT" | sed -e 's,^.*/,,'`
-      { $as_echo "$as_me:${as_lineno-$LINENO}: result: found $GMSGFMT program is not GNU msgfmt; ignore it" >&5
-$as_echo "found $GMSGFMT program is not GNU msgfmt; ignore it" >&6; }
-      GMSGFMT=":"
-    fi
-  fi
+        test -n "$localedir" || localedir='${datadir}/locale'
 
-      if test "$XGETTEXT" != ":"; then
-            if $XGETTEXT --omit-header --copyright-holder= --msgid-bugs-address= /dev/null >/dev/null 2>&1 &&
-       (if $XGETTEXT --omit-header --copyright-holder= --msgid-bugs-address= /dev/null 2>&1 >/dev/null | grep usage >/dev/null; then exit 1; else exit 0; fi); then
-      : ;
-    else
-      { $as_echo "$as_me:${as_lineno-$LINENO}: result: found xgettext program is not GNU xgettext; ignore it" >&5
-$as_echo "found xgettext program is not GNU xgettext; ignore it" >&6; }
-      XGETTEXT=":"
-    fi
-        rm -f messages.po
-  fi
 
-  ac_config_commands="$ac_config_commands default-1"
+    test -n "${XGETTEXT_EXTRA_OPTIONS+set}" || XGETTEXT_EXTRA_OPTIONS=
+
+
+  ac_config_commands="$ac_config_commands po-directories"
 
 
 
@@ -5728,7 +5674,7 @@
       # Canonicalize the path of ld
       ac_prog=`echo $ac_prog| sed 's%\\\\%/%g'`
       while echo $ac_prog | grep "$re_direlt" > /dev/null 2>&1; do
-	ac_prog=`echo $ac_prog| sed "s%$re_direlt%/%"`
+        ac_prog=`echo $ac_prog| sed "s%$re_direlt%/%"`
       done
       test -z "$LD" && LD="$ac_prog"
       ;;
@@ -5760,11 +5706,12 @@
       # Check to see if the program is GNU ld.  I'd rather use --version,
       # but apparently some GNU ld's only accept -v.
       # Break only if it was the GNU/non-GNU ld that we prefer.
-      if "$acl_cv_path_LD" -v 2>&1 < /dev/null | egrep '(GNU|with BFD)' > /dev/null; then
-	test "$with_gnu_ld" != no && break
-      else
-	test "$with_gnu_ld" != yes && break
-      fi
+      case `"$acl_cv_path_LD" -v 2>&1 < /dev/null` in
+      *GNU* | *'with BFD'*)
+        test "$with_gnu_ld" != no && break ;;
+      *)
+        test "$with_gnu_ld" != yes && break ;;
+      esac
     fi
   done
   IFS="$ac_save_ifs"
@@ -5781,18 +5728,19 @@
   { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
-test -z "$LD" && as_fn_error "no acceptable ld found in \$PATH" "$LINENO" 5
+test -z "$LD" && as_fn_error $? "no acceptable ld found in \$PATH" "$LINENO" 5
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking if the linker ($LD) is GNU ld" >&5
 $as_echo_n "checking if the linker ($LD) is GNU ld... " >&6; }
 if test "${acl_cv_prog_gnu_ld+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
   # I'd rather use --version here, but apparently some GNU ld's only accept -v.
-if $LD -v 2>&1 </dev/null | egrep '(GNU|with BFD)' 1>&5; then
-  acl_cv_prog_gnu_ld=yes
-else
-  acl_cv_prog_gnu_ld=no
-fi
+case `$LD -v 2>&1 </dev/null` in
+*GNU* | *'with BFD'*)
+  acl_cv_prog_gnu_ld=yes ;;
+*)
+  acl_cv_prog_gnu_ld=no ;;
+esac
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $acl_cv_prog_gnu_ld" >&5
 $as_echo "$acl_cv_prog_gnu_ld" >&6; }
@@ -5800,6 +5748,7 @@
 
 
 
+
                                                 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for shared library run path origin" >&5
 $as_echo_n "checking for shared library run path origin... " >&6; }
 if test "${acl_cv_rpath+set}" = set; then :
@@ -5816,12 +5765,14 @@
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $acl_cv_rpath" >&5
 $as_echo "$acl_cv_rpath" >&6; }
   wl="$acl_cv_wl"
-  libext="$acl_cv_libext"
-  shlibext="$acl_cv_shlibext"
-  hardcode_libdir_flag_spec="$acl_cv_hardcode_libdir_flag_spec"
-  hardcode_libdir_separator="$acl_cv_hardcode_libdir_separator"
-  hardcode_direct="$acl_cv_hardcode_direct"
-  hardcode_minus_L="$acl_cv_hardcode_minus_L"
+  acl_libext="$acl_cv_libext"
+  acl_shlibext="$acl_cv_shlibext"
+  acl_libname_spec="$acl_cv_libname_spec"
+  acl_library_names_spec="$acl_cv_library_names_spec"
+  acl_hardcode_libdir_flag_spec="$acl_cv_hardcode_libdir_flag_spec"
+  acl_hardcode_libdir_separator="$acl_cv_hardcode_libdir_separator"
+  acl_hardcode_direct="$acl_cv_hardcode_direct"
+  acl_hardcode_minus_L="$acl_cv_hardcode_minus_L"
     # Check whether --enable-rpath was given.
 if test "${enable_rpath+set}" = set; then :
   enableval=$enable_rpath; :
@@ -5832,6 +5783,74 @@
 
 
 
+  acl_libdirstem=lib
+  acl_libdirstem2=
+  case "$host_os" in
+    solaris*)
+                                    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for 64-bit host" >&5
+$as_echo_n "checking for 64-bit host... " >&6; }
+if test "${gl_cv_solaris_64bit+set}" = set; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#ifdef _LP64
+sixtyfour bits
+#endif
+
+_ACEOF
+if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
+  $EGREP "sixtyfour bits" >/dev/null 2>&1; then :
+  gl_cv_solaris_64bit=yes
+else
+  gl_cv_solaris_64bit=no
+fi
+rm -f conftest*
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $gl_cv_solaris_64bit" >&5
+$as_echo "$gl_cv_solaris_64bit" >&6; }
+      if test $gl_cv_solaris_64bit = yes; then
+        acl_libdirstem=lib/64
+        case "$host_cpu" in
+          sparc*)        acl_libdirstem2=lib/sparcv9 ;;
+          i*86 | x86_64) acl_libdirstem2=lib/amd64 ;;
+        esac
+      fi
+      ;;
+    *)
+      searchpath=`(LC_ALL=C $CC -print-search-dirs) 2>/dev/null | sed -n -e 's,^libraries: ,,p' | sed -e 's,^=,,'`
+      if test -n "$searchpath"; then
+        acl_save_IFS="${IFS= 	}"; IFS=":"
+        for searchdir in $searchpath; do
+          if test -d "$searchdir"; then
+            case "$searchdir" in
+              */lib64/ | */lib64 ) acl_libdirstem=lib64 ;;
+              */../ | */.. )
+                # Better ignore directories of this form. They are misleading.
+                ;;
+              *) searchdir=`cd "$searchdir" && pwd`
+                 case "$searchdir" in
+                   */lib64 ) acl_libdirstem=lib64 ;;
+                 esac ;;
+            esac
+          fi
+        done
+        IFS="$acl_save_IFS"
+      fi
+      ;;
+  esac
+  test -n "$acl_libdirstem2" || acl_libdirstem2="$acl_libdirstem"
+
+
+
+
+
+
+
+
 
 
 
@@ -5871,7 +5890,11 @@
 
       else
         additional_includedir="$withval/include"
-        additional_libdir="$withval/lib"
+        additional_libdir="$withval/$acl_libdirstem"
+        if test "$acl_libdirstem2" != "$acl_libdirstem" \
+           && ! test -d "$withval/$acl_libdirstem"; then
+          additional_libdir="$withval/$acl_libdirstem2"
+        fi
       fi
     fi
 
@@ -5880,6 +5903,8 @@
       LIBICONV=
   LTLIBICONV=
   INCICONV=
+  LIBICONV_PREFIX=
+      HAVE_LIBICONV=
   rpathdirs=
   ltrpathdirs=
   names_already_handled=
@@ -5913,22 +5938,52 @@
           found_la=
           found_so=
           found_a=
+          eval libname=\"$acl_libname_spec\"    # typically: libname=lib$name
+          if test -n "$acl_shlibext"; then
+            shrext=".$acl_shlibext"             # typically: shrext=.so
+          else
+            shrext=
+          fi
           if test $use_additional = yes; then
-            if test -n "$shlibext" && test -f "$additional_libdir/lib$name.$shlibext"; then
-              found_dir="$additional_libdir"
-              found_so="$additional_libdir/lib$name.$shlibext"
-              if test -f "$additional_libdir/lib$name.la"; then
-                found_la="$additional_libdir/lib$name.la"
-              fi
-            else
-              if test -f "$additional_libdir/lib$name.$libext"; then
-                found_dir="$additional_libdir"
-                found_a="$additional_libdir/lib$name.$libext"
-                if test -f "$additional_libdir/lib$name.la"; then
-                  found_la="$additional_libdir/lib$name.la"
+            dir="$additional_libdir"
+                                    if test -n "$acl_shlibext"; then
+              if test -f "$dir/$libname$shrext"; then
+                found_dir="$dir"
+                found_so="$dir/$libname$shrext"
+              else
+                if test "$acl_library_names_spec" = '$libname$shrext$versuffix'; then
+                  ver=`(cd "$dir" && \
+                        for f in "$libname$shrext".*; do echo "$f"; done \
+                        | sed -e "s,^$libname$shrext\\\\.,," \
+                        | sort -t '.' -n -r -k1,1 -k2,2 -k3,3 -k4,4 -k5,5 \
+                        | sed 1q ) 2>/dev/null`
+                  if test -n "$ver" && test -f "$dir/$libname$shrext.$ver"; then
+                    found_dir="$dir"
+                    found_so="$dir/$libname$shrext.$ver"
+                  fi
+                else
+                  eval library_names=\"$acl_library_names_spec\"
+                  for f in $library_names; do
+                    if test -f "$dir/$f"; then
+                      found_dir="$dir"
+                      found_so="$dir/$f"
+                      break
+                    fi
+                  done
                 fi
               fi
             fi
+                        if test "X$found_dir" = "X"; then
+              if test -f "$dir/$libname.$acl_libext"; then
+                found_dir="$dir"
+                found_a="$dir/$libname.$acl_libext"
+              fi
+            fi
+            if test "X$found_dir" != "X"; then
+              if test -f "$dir/$libname.la"; then
+                found_la="$dir/$libname.la"
+              fi
+            fi
           fi
           if test "X$found_dir" = "X"; then
             for x in $LDFLAGS $LTLIBICONV; do
@@ -5944,21 +5999,44 @@
               case "$x" in
                 -L*)
                   dir=`echo "X$x" | sed -e 's/^X-L//'`
-                  if test -n "$shlibext" && test -f "$dir/lib$name.$shlibext"; then
-                    found_dir="$dir"
-                    found_so="$dir/lib$name.$shlibext"
-                    if test -f "$dir/lib$name.la"; then
-                      found_la="$dir/lib$name.la"
-                    fi
-                  else
-                    if test -f "$dir/lib$name.$libext"; then
+                                    if test -n "$acl_shlibext"; then
+                    if test -f "$dir/$libname$shrext"; then
                       found_dir="$dir"
-                      found_a="$dir/lib$name.$libext"
-                      if test -f "$dir/lib$name.la"; then
-                        found_la="$dir/lib$name.la"
+                      found_so="$dir/$libname$shrext"
+                    else
+                      if test "$acl_library_names_spec" = '$libname$shrext$versuffix'; then
+                        ver=`(cd "$dir" && \
+                              for f in "$libname$shrext".*; do echo "$f"; done \
+                              | sed -e "s,^$libname$shrext\\\\.,," \
+                              | sort -t '.' -n -r -k1,1 -k2,2 -k3,3 -k4,4 -k5,5 \
+                              | sed 1q ) 2>/dev/null`
+                        if test -n "$ver" && test -f "$dir/$libname$shrext.$ver"; then
+                          found_dir="$dir"
+                          found_so="$dir/$libname$shrext.$ver"
+                        fi
+                      else
+                        eval library_names=\"$acl_library_names_spec\"
+                        for f in $library_names; do
+                          if test -f "$dir/$f"; then
+                            found_dir="$dir"
+                            found_so="$dir/$f"
+                            break
+                          fi
+                        done
                       fi
                     fi
                   fi
+                                    if test "X$found_dir" = "X"; then
+                    if test -f "$dir/$libname.$acl_libext"; then
+                      found_dir="$dir"
+                      found_a="$dir/$libname.$acl_libext"
+                    fi
+                  fi
+                  if test "X$found_dir" != "X"; then
+                    if test -f "$dir/$libname.la"; then
+                      found_la="$dir/$libname.la"
+                    fi
+                  fi
                   ;;
               esac
               if test "X$found_dir" != "X"; then
@@ -5969,7 +6047,9 @@
           if test "X$found_dir" != "X"; then
                         LTLIBICONV="${LTLIBICONV}${LTLIBICONV:+ }-L$found_dir -l$name"
             if test "X$found_so" != "X"; then
-                                                        if test "$enable_rpath" = no || test "X$found_dir" = "X/usr/lib"; then
+                                                        if test "$enable_rpath" = no \
+                 || test "X$found_dir" = "X/usr/$acl_libdirstem" \
+                 || test "X$found_dir" = "X/usr/$acl_libdirstem2"; then
                                 LIBICONV="${LIBICONV}${LIBICONV:+ }$found_so"
               else
                                                                                 haveit=
@@ -5982,10 +6062,10 @@
                 if test -z "$haveit"; then
                   ltrpathdirs="$ltrpathdirs $found_dir"
                 fi
-                                if test "$hardcode_direct" = yes; then
+                                if test "$acl_hardcode_direct" = yes; then
                                                       LIBICONV="${LIBICONV}${LIBICONV:+ }$found_so"
                 else
-                  if test -n "$hardcode_libdir_flag_spec" && test "$hardcode_minus_L" = no; then
+                  if test -n "$acl_hardcode_libdir_flag_spec" && test "$acl_hardcode_minus_L" = no; then
                                                             LIBICONV="${LIBICONV}${LIBICONV:+ }$found_so"
                                                             haveit=
                     for x in $rpathdirs; do
@@ -6017,7 +6097,7 @@
                     if test -z "$haveit"; then
                       LIBICONV="${LIBICONV}${LIBICONV:+ }-L$found_dir"
                     fi
-                    if test "$hardcode_minus_L" != no; then
+                    if test "$acl_hardcode_minus_L" != no; then
                                                                                         LIBICONV="${LIBICONV}${LIBICONV:+ }$found_so"
                     else
                                                                                                                                                                                 LIBICONV="${LIBICONV}${LIBICONV:+ }-l$name"
@@ -6034,8 +6114,18 @@
             fi
                         additional_includedir=
             case "$found_dir" in
-              */lib | */lib/)
-                basedir=`echo "X$found_dir" | sed -e 's,^X,,' -e 's,/lib/*$,,'`
+              */$acl_libdirstem | */$acl_libdirstem/)
+                basedir=`echo "X$found_dir" | sed -e 's,^X,,' -e "s,/$acl_libdirstem/"'*$,,'`
+                if test "$name" = 'iconv'; then
+                  LIBICONV_PREFIX="$basedir"
+                fi
+                additional_includedir="$basedir/include"
+                ;;
+              */$acl_libdirstem2 | */$acl_libdirstem2/)
+                basedir=`echo "X$found_dir" | sed -e 's,^X,,' -e "s,/$acl_libdirstem2/"'*$,,'`
+                if test "$name" = 'iconv'; then
+                  LIBICONV_PREFIX="$basedir"
+                fi
                 additional_includedir="$basedir/include"
                 ;;
             esac
@@ -6045,7 +6135,7 @@
                 if test "X$additional_includedir" = "X/usr/local/include"; then
                   if test -n "$GCC"; then
                     case $host_os in
-                      linux*) haveit=yes;;
+                      linux* | gnu* | k*bsd*-gnu) haveit=yes;;
                     esac
                   fi
                 fi
@@ -6084,12 +6174,14 @@
                 case "$dep" in
                   -L*)
                     additional_libdir=`echo "X$dep" | sed -e 's/^X-L//'`
-                                                                                                                                                                if test "X$additional_libdir" != "X/usr/lib"; then
+                                                                                                                                                                if test "X$additional_libdir" != "X/usr/$acl_libdirstem" \
+                       && test "X$additional_libdir" != "X/usr/$acl_libdirstem2"; then
                       haveit=
-                      if test "X$additional_libdir" = "X/usr/local/lib"; then
+                      if test "X$additional_libdir" = "X/usr/local/$acl_libdirstem" \
+                         || test "X$additional_libdir" = "X/usr/local/$acl_libdirstem2"; then
                         if test -n "$GCC"; then
                           case $host_os in
-                            linux*) haveit=yes;;
+                            linux* | gnu* | k*bsd*-gnu) haveit=yes;;
                           esac
                         fi
                       fi
@@ -6186,21 +6278,21 @@
     done
   done
   if test "X$rpathdirs" != "X"; then
-    if test -n "$hardcode_libdir_separator"; then
+    if test -n "$acl_hardcode_libdir_separator"; then
                         alldirs=
       for found_dir in $rpathdirs; do
-        alldirs="${alldirs}${alldirs:+$hardcode_libdir_separator}$found_dir"
+        alldirs="${alldirs}${alldirs:+$acl_hardcode_libdir_separator}$found_dir"
       done
             acl_save_libdir="$libdir"
       libdir="$alldirs"
-      eval flag=\"$hardcode_libdir_flag_spec\"
+      eval flag=\"$acl_hardcode_libdir_flag_spec\"
       libdir="$acl_save_libdir"
       LIBICONV="${LIBICONV}${LIBICONV:+ }$flag"
     else
             for found_dir in $rpathdirs; do
         acl_save_libdir="$libdir"
         libdir="$found_dir"
-        eval flag=\"$hardcode_libdir_flag_spec\"
+        eval flag=\"$acl_hardcode_libdir_flag_spec\"
         libdir="$acl_save_libdir"
         LIBICONV="${LIBICONV}${LIBICONV:+ }$flag"
       done
@@ -6229,77 +6321,175 @@
 
 
 
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether NLS is requested" >&5
-$as_echo_n "checking whether NLS is requested... " >&6; }
-    # Check whether --enable-nls was given.
-if test "${enable_nls+set}" = set; then :
-  enableval=$enable_nls; USE_NLS=$enableval
-else
-  USE_NLS=yes
-fi
 
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $USE_NLS" >&5
-$as_echo "$USE_NLS" >&6; }
 
 
 
 
-  LIBINTL=
-  LTLIBINTL=
-  POSUB=
 
-    if test "$USE_NLS" = "yes"; then
-    gt_use_preinstalled_gnugettext=no
 
 
 
 
 
 
-        { $as_echo "$as_me:${as_lineno-$LINENO}: checking for GNU gettext in libc" >&5
-$as_echo_n "checking for GNU gettext in libc... " >&6; }
-if test "${gt_cv_func_gnugettext1_libc+set}" = set; then :
+
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for CFPreferencesCopyAppValue" >&5
+$as_echo_n "checking for CFPreferencesCopyAppValue... " >&6; }
+if test "${gt_cv_func_CFPreferencesCopyAppValue+set}" = set; then :
   $as_echo_n "(cached) " >&6
 else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+  gt_save_LIBS="$LIBS"
+     LIBS="$LIBS -Wl,-framework -Wl,CoreFoundation"
+     cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-#include <libintl.h>
-extern int _nl_msg_cat_cntr;
-extern int *_nl_domain_bindings;
+#include <CoreFoundation/CFPreferences.h>
 int
 main ()
 {
-bindtextdomain ("", "");
-return (int) gettext ("") + _nl_msg_cat_cntr + *_nl_domain_bindings
+CFPreferencesCopyAppValue(NULL, NULL)
   ;
   return 0;
 }
 _ACEOF
 if ac_fn_c_try_link "$LINENO"; then :
-  gt_cv_func_gnugettext1_libc=yes
+  gt_cv_func_CFPreferencesCopyAppValue=yes
 else
-  gt_cv_func_gnugettext1_libc=no
+  gt_cv_func_CFPreferencesCopyAppValue=no
 fi
 rm -f core conftest.err conftest.$ac_objext \
     conftest$ac_exeext conftest.$ac_ext
+     LIBS="$gt_save_LIBS"
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $gt_cv_func_gnugettext1_libc" >&5
-$as_echo "$gt_cv_func_gnugettext1_libc" >&6; }
-
-        if test "$gt_cv_func_gnugettext1_libc" != "yes"; then
-
-
-
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $gt_cv_func_CFPreferencesCopyAppValue" >&5
+$as_echo "$gt_cv_func_CFPreferencesCopyAppValue" >&6; }
+  if test $gt_cv_func_CFPreferencesCopyAppValue = yes; then
 
+$as_echo "#define HAVE_CFPREFERENCESCOPYAPPVALUE 1" >>confdefs.h
 
-          am_save_CPPFLAGS="$CPPFLAGS"
-
-  for element in $INCICONV; do
-    haveit=
-    for x in $CPPFLAGS; do
-
-  acl_save_prefix="$prefix"
-  prefix="$acl_final_prefix"
+  fi
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for CFLocaleCopyCurrent" >&5
+$as_echo_n "checking for CFLocaleCopyCurrent... " >&6; }
+if test "${gt_cv_func_CFLocaleCopyCurrent+set}" = set; then :
+  $as_echo_n "(cached) " >&6
+else
+  gt_save_LIBS="$LIBS"
+     LIBS="$LIBS -Wl,-framework -Wl,CoreFoundation"
+     cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <CoreFoundation/CFLocale.h>
+int
+main ()
+{
+CFLocaleCopyCurrent();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  gt_cv_func_CFLocaleCopyCurrent=yes
+else
+  gt_cv_func_CFLocaleCopyCurrent=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+     LIBS="$gt_save_LIBS"
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $gt_cv_func_CFLocaleCopyCurrent" >&5
+$as_echo "$gt_cv_func_CFLocaleCopyCurrent" >&6; }
+  if test $gt_cv_func_CFLocaleCopyCurrent = yes; then
+
+$as_echo "#define HAVE_CFLOCALECOPYCURRENT 1" >>confdefs.h
+
+  fi
+  INTL_MACOSX_LIBS=
+  if test $gt_cv_func_CFPreferencesCopyAppValue = yes || test $gt_cv_func_CFLocaleCopyCurrent = yes; then
+    INTL_MACOSX_LIBS="-Wl,-framework -Wl,CoreFoundation"
+  fi
+
+
+
+
+
+
+  LIBINTL=
+  LTLIBINTL=
+  POSUB=
+
+    case " $gt_needs " in
+    *" need-formatstring-macros "*) gt_api_version=3 ;;
+    *" need-ngettext "*) gt_api_version=2 ;;
+    *) gt_api_version=1 ;;
+  esac
+  gt_func_gnugettext_libc="gt_cv_func_gnugettext${gt_api_version}_libc"
+  gt_func_gnugettext_libintl="gt_cv_func_gnugettext${gt_api_version}_libintl"
+
+    if test "$USE_NLS" = "yes"; then
+    gt_use_preinstalled_gnugettext=no
+
+
+        if test $gt_api_version -ge 3; then
+          gt_revision_test_code='
+#ifndef __GNU_GETTEXT_SUPPORTED_REVISION
+#define __GNU_GETTEXT_SUPPORTED_REVISION(major) ((major) == 0 ? 0 : -1)
+#endif
+typedef int array [2 * (__GNU_GETTEXT_SUPPORTED_REVISION(0) >= 1) - 1];
+'
+        else
+          gt_revision_test_code=
+        fi
+        if test $gt_api_version -ge 2; then
+          gt_expression_test_code=' + * ngettext ("", "", 0)'
+        else
+          gt_expression_test_code=
+        fi
+
+        { $as_echo "$as_me:${as_lineno-$LINENO}: checking for GNU gettext in libc" >&5
+$as_echo_n "checking for GNU gettext in libc... " >&6; }
+if eval "test \"\${$gt_func_gnugettext_libc+set}\"" = set; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <libintl.h>
+$gt_revision_test_code
+extern int _nl_msg_cat_cntr;
+extern int *_nl_domain_bindings;
+int
+main ()
+{
+bindtextdomain ("", "");
+return * gettext ("")$gt_expression_test_code + _nl_msg_cat_cntr + *_nl_domain_bindings
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  eval "$gt_func_gnugettext_libc=yes"
+else
+  eval "$gt_func_gnugettext_libc=no"
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+fi
+eval ac_res=\$$gt_func_gnugettext_libc
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+
+        if { eval "gt_val=\$$gt_func_gnugettext_libc"; test "$gt_val" != "yes"; }; then
+
+
+
+
+
+          am_save_CPPFLAGS="$CPPFLAGS"
+
+  for element in $INCICONV; do
+    haveit=
+    for x in $CPPFLAGS; do
+
+  acl_save_prefix="$prefix"
+  prefix="$acl_final_prefix"
   acl_save_exec_prefix="$exec_prefix"
   exec_prefix="$acl_final_exec_prefix"
   eval x=\"$x\"
@@ -6374,6 +6564,123 @@
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $am_cv_func_iconv" >&5
 $as_echo "$am_cv_func_iconv" >&6; }
   if test "$am_cv_func_iconv" = yes; then
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for working iconv" >&5
+$as_echo_n "checking for working iconv... " >&6; }
+if test "${am_cv_func_iconv_works+set}" = set; then :
+  $as_echo_n "(cached) " >&6
+else
+
+            am_save_LIBS="$LIBS"
+      if test $am_cv_lib_iconv = yes; then
+        LIBS="$LIBS $LIBICONV"
+      fi
+      if test "$cross_compiling" = yes; then :
+  case "$host_os" in
+           aix* | hpux*) am_cv_func_iconv_works="guessing no" ;;
+           *)            am_cv_func_iconv_works="guessing yes" ;;
+         esac
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#include <iconv.h>
+#include <string.h>
+int main ()
+{
+  /* Test against AIX 5.1 bug: Failures are not distinguishable from successful
+     returns.  */
+  {
+    iconv_t cd_utf8_to_88591 = iconv_open ("ISO8859-1", "UTF-8");
+    if (cd_utf8_to_88591 != (iconv_t)(-1))
+      {
+        static const char input[] = "\342\202\254"; /* EURO SIGN */
+        char buf[10];
+        const char *inptr = input;
+        size_t inbytesleft = strlen (input);
+        char *outptr = buf;
+        size_t outbytesleft = sizeof (buf);
+        size_t res = iconv (cd_utf8_to_88591,
+                            (char **) &inptr, &inbytesleft,
+                            &outptr, &outbytesleft);
+        if (res == 0)
+          return 1;
+      }
+  }
+  /* Test against Solaris 10 bug: Failures are not distinguishable from
+     successful returns.  */
+  {
+    iconv_t cd_ascii_to_88591 = iconv_open ("ISO8859-1", "646");
+    if (cd_ascii_to_88591 != (iconv_t)(-1))
+      {
+        static const char input[] = "\263";
+        char buf[10];
+        const char *inptr = input;
+        size_t inbytesleft = strlen (input);
+        char *outptr = buf;
+        size_t outbytesleft = sizeof (buf);
+        size_t res = iconv (cd_ascii_to_88591,
+                            (char **) &inptr, &inbytesleft,
+                            &outptr, &outbytesleft);
+        if (res == 0)
+          return 1;
+      }
+  }
+#if 0 /* This bug could be worked around by the caller.  */
+  /* Test against HP-UX 11.11 bug: Positive return value instead of 0.  */
+  {
+    iconv_t cd_88591_to_utf8 = iconv_open ("utf8", "iso88591");
+    if (cd_88591_to_utf8 != (iconv_t)(-1))
+      {
+        static const char input[] = "\304rger mit b\366sen B\374bchen ohne Augenma\337";
+        char buf[50];
+        const char *inptr = input;
+        size_t inbytesleft = strlen (input);
+        char *outptr = buf;
+        size_t outbytesleft = sizeof (buf);
+        size_t res = iconv (cd_88591_to_utf8,
+                            (char **) &inptr, &inbytesleft,
+                            &outptr, &outbytesleft);
+        if ((int)res > 0)
+          return 1;
+      }
+  }
+#endif
+  /* Test against HP-UX 11.11 bug: No converter from EUC-JP to UTF-8 is
+     provided.  */
+  if (/* Try standardized names.  */
+      iconv_open ("UTF-8", "EUC-JP") == (iconv_t)(-1)
+      /* Try IRIX, OSF/1 names.  */
+      && iconv_open ("UTF-8", "eucJP") == (iconv_t)(-1)
+      /* Try AIX names.  */
+      && iconv_open ("UTF-8", "IBM-eucJP") == (iconv_t)(-1)
+      /* Try HP-UX names.  */
+      && iconv_open ("utf8", "eucJP") == (iconv_t)(-1))
+    return 1;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_run "$LINENO"; then :
+  am_cv_func_iconv_works=yes
+else
+  am_cv_func_iconv_works=no
+fi
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
+fi
+
+      LIBS="$am_save_LIBS"
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $am_cv_func_iconv_works" >&5
+$as_echo "$am_cv_func_iconv_works" >&6; }
+    case "$am_cv_func_iconv_works" in
+      *no) am_func_iconv=no am_cv_lib_iconv=no ;;
+      *)   am_func_iconv=yes ;;
+    esac
+  else
+    am_func_iconv=no am_cv_lib_iconv=no
+  fi
+  if test "$am_func_iconv" = yes; then
 
 $as_echo "#define HAVE_ICONV 1" >>confdefs.h
 
@@ -6394,6 +6701,11 @@
 
 
 
+
+
+
+
+
     use_additional=yes
 
   acl_save_prefix="$prefix"
@@ -6429,7 +6741,11 @@
 
       else
         additional_includedir="$withval/include"
-        additional_libdir="$withval/lib"
+        additional_libdir="$withval/$acl_libdirstem"
+        if test "$acl_libdirstem2" != "$acl_libdirstem" \
+           && ! test -d "$withval/$acl_libdirstem"; then
+          additional_libdir="$withval/$acl_libdirstem2"
+        fi
       fi
     fi
 
@@ -6438,6 +6754,8 @@
       LIBINTL=
   LTLIBINTL=
   INCINTL=
+  LIBINTL_PREFIX=
+      HAVE_LIBINTL=
   rpathdirs=
   ltrpathdirs=
   names_already_handled=
@@ -6471,22 +6789,52 @@
           found_la=
           found_so=
           found_a=
+          eval libname=\"$acl_libname_spec\"    # typically: libname=lib$name
+          if test -n "$acl_shlibext"; then
+            shrext=".$acl_shlibext"             # typically: shrext=.so
+          else
+            shrext=
+          fi
           if test $use_additional = yes; then
-            if test -n "$shlibext" && test -f "$additional_libdir/lib$name.$shlibext"; then
-              found_dir="$additional_libdir"
-              found_so="$additional_libdir/lib$name.$shlibext"
-              if test -f "$additional_libdir/lib$name.la"; then
-                found_la="$additional_libdir/lib$name.la"
-              fi
-            else
-              if test -f "$additional_libdir/lib$name.$libext"; then
-                found_dir="$additional_libdir"
-                found_a="$additional_libdir/lib$name.$libext"
-                if test -f "$additional_libdir/lib$name.la"; then
-                  found_la="$additional_libdir/lib$name.la"
+            dir="$additional_libdir"
+                                    if test -n "$acl_shlibext"; then
+              if test -f "$dir/$libname$shrext"; then
+                found_dir="$dir"
+                found_so="$dir/$libname$shrext"
+              else
+                if test "$acl_library_names_spec" = '$libname$shrext$versuffix'; then
+                  ver=`(cd "$dir" && \
+                        for f in "$libname$shrext".*; do echo "$f"; done \
+                        | sed -e "s,^$libname$shrext\\\\.,," \
+                        | sort -t '.' -n -r -k1,1 -k2,2 -k3,3 -k4,4 -k5,5 \
+                        | sed 1q ) 2>/dev/null`
+                  if test -n "$ver" && test -f "$dir/$libname$shrext.$ver"; then
+                    found_dir="$dir"
+                    found_so="$dir/$libname$shrext.$ver"
+                  fi
+                else
+                  eval library_names=\"$acl_library_names_spec\"
+                  for f in $library_names; do
+                    if test -f "$dir/$f"; then
+                      found_dir="$dir"
+                      found_so="$dir/$f"
+                      break
+                    fi
+                  done
                 fi
               fi
             fi
+                        if test "X$found_dir" = "X"; then
+              if test -f "$dir/$libname.$acl_libext"; then
+                found_dir="$dir"
+                found_a="$dir/$libname.$acl_libext"
+              fi
+            fi
+            if test "X$found_dir" != "X"; then
+              if test -f "$dir/$libname.la"; then
+                found_la="$dir/$libname.la"
+              fi
+            fi
           fi
           if test "X$found_dir" = "X"; then
             for x in $LDFLAGS $LTLIBINTL; do
@@ -6502,21 +6850,44 @@
               case "$x" in
                 -L*)
                   dir=`echo "X$x" | sed -e 's/^X-L//'`
-                  if test -n "$shlibext" && test -f "$dir/lib$name.$shlibext"; then
-                    found_dir="$dir"
-                    found_so="$dir/lib$name.$shlibext"
-                    if test -f "$dir/lib$name.la"; then
-                      found_la="$dir/lib$name.la"
-                    fi
-                  else
-                    if test -f "$dir/lib$name.$libext"; then
+                                    if test -n "$acl_shlibext"; then
+                    if test -f "$dir/$libname$shrext"; then
                       found_dir="$dir"
-                      found_a="$dir/lib$name.$libext"
-                      if test -f "$dir/lib$name.la"; then
-                        found_la="$dir/lib$name.la"
+                      found_so="$dir/$libname$shrext"
+                    else
+                      if test "$acl_library_names_spec" = '$libname$shrext$versuffix'; then
+                        ver=`(cd "$dir" && \
+                              for f in "$libname$shrext".*; do echo "$f"; done \
+                              | sed -e "s,^$libname$shrext\\\\.,," \
+                              | sort -t '.' -n -r -k1,1 -k2,2 -k3,3 -k4,4 -k5,5 \
+                              | sed 1q ) 2>/dev/null`
+                        if test -n "$ver" && test -f "$dir/$libname$shrext.$ver"; then
+                          found_dir="$dir"
+                          found_so="$dir/$libname$shrext.$ver"
+                        fi
+                      else
+                        eval library_names=\"$acl_library_names_spec\"
+                        for f in $library_names; do
+                          if test -f "$dir/$f"; then
+                            found_dir="$dir"
+                            found_so="$dir/$f"
+                            break
+                          fi
+                        done
                       fi
                     fi
                   fi
+                                    if test "X$found_dir" = "X"; then
+                    if test -f "$dir/$libname.$acl_libext"; then
+                      found_dir="$dir"
+                      found_a="$dir/$libname.$acl_libext"
+                    fi
+                  fi
+                  if test "X$found_dir" != "X"; then
+                    if test -f "$dir/$libname.la"; then
+                      found_la="$dir/$libname.la"
+                    fi
+                  fi
                   ;;
               esac
               if test "X$found_dir" != "X"; then
@@ -6527,7 +6898,9 @@
           if test "X$found_dir" != "X"; then
                         LTLIBINTL="${LTLIBINTL}${LTLIBINTL:+ }-L$found_dir -l$name"
             if test "X$found_so" != "X"; then
-                                                        if test "$enable_rpath" = no || test "X$found_dir" = "X/usr/lib"; then
+                                                        if test "$enable_rpath" = no \
+                 || test "X$found_dir" = "X/usr/$acl_libdirstem" \
+                 || test "X$found_dir" = "X/usr/$acl_libdirstem2"; then
                                 LIBINTL="${LIBINTL}${LIBINTL:+ }$found_so"
               else
                                                                                 haveit=
@@ -6540,10 +6913,10 @@
                 if test -z "$haveit"; then
                   ltrpathdirs="$ltrpathdirs $found_dir"
                 fi
-                                if test "$hardcode_direct" = yes; then
+                                if test "$acl_hardcode_direct" = yes; then
                                                       LIBINTL="${LIBINTL}${LIBINTL:+ }$found_so"
                 else
-                  if test -n "$hardcode_libdir_flag_spec" && test "$hardcode_minus_L" = no; then
+                  if test -n "$acl_hardcode_libdir_flag_spec" && test "$acl_hardcode_minus_L" = no; then
                                                             LIBINTL="${LIBINTL}${LIBINTL:+ }$found_so"
                                                             haveit=
                     for x in $rpathdirs; do
@@ -6575,7 +6948,7 @@
                     if test -z "$haveit"; then
                       LIBINTL="${LIBINTL}${LIBINTL:+ }-L$found_dir"
                     fi
-                    if test "$hardcode_minus_L" != no; then
+                    if test "$acl_hardcode_minus_L" != no; then
                                                                                         LIBINTL="${LIBINTL}${LIBINTL:+ }$found_so"
                     else
                                                                                                                                                                                 LIBINTL="${LIBINTL}${LIBINTL:+ }-l$name"
@@ -6592,8 +6965,18 @@
             fi
                         additional_includedir=
             case "$found_dir" in
-              */lib | */lib/)
-                basedir=`echo "X$found_dir" | sed -e 's,^X,,' -e 's,/lib/*$,,'`
+              */$acl_libdirstem | */$acl_libdirstem/)
+                basedir=`echo "X$found_dir" | sed -e 's,^X,,' -e "s,/$acl_libdirstem/"'*$,,'`
+                if test "$name" = 'intl'; then
+                  LIBINTL_PREFIX="$basedir"
+                fi
+                additional_includedir="$basedir/include"
+                ;;
+              */$acl_libdirstem2 | */$acl_libdirstem2/)
+                basedir=`echo "X$found_dir" | sed -e 's,^X,,' -e "s,/$acl_libdirstem2/"'*$,,'`
+                if test "$name" = 'intl'; then
+                  LIBINTL_PREFIX="$basedir"
+                fi
                 additional_includedir="$basedir/include"
                 ;;
             esac
@@ -6603,7 +6986,7 @@
                 if test "X$additional_includedir" = "X/usr/local/include"; then
                   if test -n "$GCC"; then
                     case $host_os in
-                      linux*) haveit=yes;;
+                      linux* | gnu* | k*bsd*-gnu) haveit=yes;;
                     esac
                   fi
                 fi
@@ -6642,12 +7025,14 @@
                 case "$dep" in
                   -L*)
                     additional_libdir=`echo "X$dep" | sed -e 's/^X-L//'`
-                                                                                                                                                                if test "X$additional_libdir" != "X/usr/lib"; then
+                                                                                                                                                                if test "X$additional_libdir" != "X/usr/$acl_libdirstem" \
+                       && test "X$additional_libdir" != "X/usr/$acl_libdirstem2"; then
                       haveit=
-                      if test "X$additional_libdir" = "X/usr/local/lib"; then
+                      if test "X$additional_libdir" = "X/usr/local/$acl_libdirstem" \
+                         || test "X$additional_libdir" = "X/usr/local/$acl_libdirstem2"; then
                         if test -n "$GCC"; then
                           case $host_os in
-                            linux*) haveit=yes;;
+                            linux* | gnu* | k*bsd*-gnu) haveit=yes;;
                           esac
                         fi
                       fi
@@ -6744,21 +7129,21 @@
     done
   done
   if test "X$rpathdirs" != "X"; then
-    if test -n "$hardcode_libdir_separator"; then
+    if test -n "$acl_hardcode_libdir_separator"; then
                         alldirs=
       for found_dir in $rpathdirs; do
-        alldirs="${alldirs}${alldirs:+$hardcode_libdir_separator}$found_dir"
+        alldirs="${alldirs}${alldirs:+$acl_hardcode_libdir_separator}$found_dir"
       done
             acl_save_libdir="$libdir"
       libdir="$alldirs"
-      eval flag=\"$hardcode_libdir_flag_spec\"
+      eval flag=\"$acl_hardcode_libdir_flag_spec\"
       libdir="$acl_save_libdir"
       LIBINTL="${LIBINTL}${LIBINTL:+ }$flag"
     else
             for found_dir in $rpathdirs; do
         acl_save_libdir="$libdir"
         libdir="$found_dir"
-        eval flag=\"$hardcode_libdir_flag_spec\"
+        eval flag=\"$acl_hardcode_libdir_flag_spec\"
         libdir="$acl_save_libdir"
         LIBINTL="${LIBINTL}${LIBINTL:+ }$flag"
       done
@@ -6770,9 +7155,14 @@
     done
   fi
 
+
+
+
+
+
           { $as_echo "$as_me:${as_lineno-$LINENO}: checking for GNU gettext in libintl" >&5
 $as_echo_n "checking for GNU gettext in libintl... " >&6; }
-if test "${gt_cv_func_gnugettext1_libintl+set}" = set; then :
+if eval "test \"\${$gt_func_gnugettext_libintl+set}\"" = set; then :
   $as_echo_n "(cached) " >&6
 else
   gt_save_CPPFLAGS="$CPPFLAGS"
@@ -6782,44 +7172,46 @@
                         cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <libintl.h>
+$gt_revision_test_code
 extern int _nl_msg_cat_cntr;
 extern
 #ifdef __cplusplus
 "C"
 #endif
-const char *_nl_expand_alias ();
+const char *_nl_expand_alias (const char *);
 int
 main ()
 {
 bindtextdomain ("", "");
-return (int) gettext ("") + _nl_msg_cat_cntr + *_nl_expand_alias (0)
+return * gettext ("")$gt_expression_test_code + _nl_msg_cat_cntr + *_nl_expand_alias ("")
   ;
   return 0;
 }
 _ACEOF
 if ac_fn_c_try_link "$LINENO"; then :
-  gt_cv_func_gnugettext1_libintl=yes
+  eval "$gt_func_gnugettext_libintl=yes"
 else
-  gt_cv_func_gnugettext1_libintl=no
+  eval "$gt_func_gnugettext_libintl=no"
 fi
 rm -f core conftest.err conftest.$ac_objext \
     conftest$ac_exeext conftest.$ac_ext
-                        if test "$gt_cv_func_gnugettext1_libintl" != yes && test -n "$LIBICONV"; then
+                        if { eval "gt_val=\$$gt_func_gnugettext_libintl"; test "$gt_val" != yes; } && test -n "$LIBICONV"; then
               LIBS="$LIBS $LIBICONV"
               cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <libintl.h>
+$gt_revision_test_code
 extern int _nl_msg_cat_cntr;
 extern
 #ifdef __cplusplus
 "C"
 #endif
-const char *_nl_expand_alias ();
+const char *_nl_expand_alias (const char *);
 int
 main ()
 {
 bindtextdomain ("", "");
-return (int) gettext ("") + _nl_msg_cat_cntr + *_nl_expand_alias (0)
+return * gettext ("")$gt_expression_test_code + _nl_msg_cat_cntr + *_nl_expand_alias ("")
   ;
   return 0;
 }
@@ -6827,7 +7219,7 @@
 if ac_fn_c_try_link "$LINENO"; then :
   LIBINTL="$LIBINTL $LIBICONV"
                 LTLIBINTL="$LTLIBINTL $LTLIBICONV"
-                gt_cv_func_gnugettext1_libintl=yes
+                eval "$gt_func_gnugettext_libintl=yes"
 
 fi
 rm -f core conftest.err conftest.$ac_objext \
@@ -6836,12 +7228,13 @@
             CPPFLAGS="$gt_save_CPPFLAGS"
             LIBS="$gt_save_LIBS"
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $gt_cv_func_gnugettext1_libintl" >&5
-$as_echo "$gt_cv_func_gnugettext1_libintl" >&6; }
+eval ac_res=\$$gt_func_gnugettext_libintl
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
         fi
 
-                                        if test "$gt_cv_func_gnugettext1_libc" = "yes" \
-           || { test "$gt_cv_func_gnugettext1_libintl" = "yes" \
+                                        if { eval "gt_val=\$$gt_func_gnugettext_libc"; test "$gt_val" = "yes"; } \
+           || { { eval "gt_val=\$$gt_func_gnugettext_libintl"; test "$gt_val" = "yes"; } \
                 && test "$PACKAGE" != gettext-runtime \
                 && test "$PACKAGE" != gettext-tools; }; then
           gt_use_preinstalled_gnugettext=yes
@@ -6853,6 +7246,14 @@
 
 
 
+    if test -n "$INTL_MACOSX_LIBS"; then
+      if test "$gt_use_preinstalled_gnugettext" = "yes" \
+         || test "$nls_cv_use_gnu_gettext" = "yes"; then
+                LIBINTL="$LIBINTL $INTL_MACOSX_LIBS"
+        LTLIBINTL="$LTLIBINTL $INTL_MACOSX_LIBS"
+      fi
+    fi
+
     if test "$gt_use_preinstalled_gnugettext" = "yes" \
        || test "$nls_cv_use_gnu_gettext" = "yes"; then
 
@@ -6871,7 +7272,7 @@
     { $as_echo "$as_me:${as_lineno-$LINENO}: checking where the gettext function comes from" >&5
 $as_echo_n "checking where the gettext function comes from... " >&6; }
     if test "$gt_use_preinstalled_gnugettext" = "yes"; then
-      if test "$gt_cv_func_gnugettext1_libintl" = "yes"; then
+      if { eval "gt_val=\$$gt_func_gnugettext_libintl"; test "$gt_val" = "yes"; }; then
         gt_source="external libintl"
       else
         gt_source="libc"
@@ -6886,7 +7287,7 @@
   if test "$USE_NLS" = "yes"; then
 
     if test "$gt_use_preinstalled_gnugettext" = "yes"; then
-      if test "$gt_cv_func_gnugettext1_libintl" = "yes"; then
+      if { eval "gt_val=\$$gt_func_gnugettext_libintl"; test "$gt_val" = "yes"; }; then
         { $as_echo "$as_me:${as_lineno-$LINENO}: checking how to link with libintl" >&5
 $as_echo_n "checking how to link with libintl... " >&6; }
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: $LIBINTL" >&5
@@ -6977,7 +7378,7 @@
 
 
 
-INPUT_PLUGINS="tonegen console psf xsf metronom vtx"
+INPUT_PLUGINS="tonegen console xsf metronom vtx"
 OUTPUT_PLUGINS="null"
 EFFECT_PLUGINS="compressor crossfade crystalizer ladspa sndstretch stereo_plugin voice_removal echo_plugin"
 GENERAL_PLUGINS="song_change alarm skins gtkui lyricwiki"
@@ -6988,6 +7389,10 @@
 
 
 
+
+
+
+
 if test "x$ac_cv_env_PKG_CONFIG_set" != "xset"; then
 	if test -n "$ac_tool_prefix"; then
   # Extract the first word of "${ac_tool_prefix}pkg-config", so it can be a program name with args.
@@ -7088,69 +7493,86 @@
 fi
 
 fi
-if test "x$PKG_CONFIG" != "x"; then
+if test -n "$PKG_CONFIG"; then
 	_pkg_min_version=0.9.0
 	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking pkg-config is at least version $_pkg_min_version" >&5
 $as_echo_n "checking pkg-config is at least version $_pkg_min_version... " >&6; }
-	if $PKG_CONFIG --atleast-pkgconfig-version $_pkg_min_version ; then
+	if $PKG_CONFIG --atleast-pkgconfig-version $_pkg_min_version; then
 		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
-		if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
-		        _pkg_short_errors_supported=yes
-		else
-		        _pkg_short_errors_supported=no
-		fi
 	else
 		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 		PKG_CONFIG=""
 	fi
-
 fi
+
 pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for AUDACIOUS" >&5
 $as_echo_n "checking for AUDACIOUS... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"audacious >= 2.4\""; } >&5
+
+if test -n "$AUDACIOUS_CFLAGS"; then
+    pkg_cv_AUDACIOUS_CFLAGS="$AUDACIOUS_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"audacious >= 2.4\""; } >&5
   ($PKG_CONFIG --exists --print-errors "audacious >= 2.4") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${AUDACIOUS_CFLAGS}" != "x"; then
-            pkg_cv_AUDACIOUS_CFLAGS="${AUDACIOUS_CFLAGS}"
-        else
-            pkg_cv_AUDACIOUS_CFLAGS=`$PKG_CONFIG --cflags "audacious >= 2.4" 2>/dev/null`
-        fi
-        if test "x${AUDACIOUS_LIBS}" != "x"; then
-            pkg_cv_AUDACIOUS_LIBS="${AUDACIOUS_LIBS}"
-        else
-            pkg_cv_AUDACIOUS_LIBS=`$PKG_CONFIG --libs "audacious >= 2.4" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_AUDACIOUS_CFLAGS=`$PKG_CONFIG --cflags "audacious >= 2.4" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$AUDACIOUS_LIBS"; then
+    pkg_cv_AUDACIOUS_LIBS="$AUDACIOUS_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"audacious >= 2.4\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "audacious >= 2.4") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_AUDACIOUS_LIBS=`$PKG_CONFIG --libs "audacious >= 2.4" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        AUDACIOUS_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "audacious >= 2.4" 2>&1`
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        AUDACIOUS_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "audacious >= 2.4" 2>&1`
         else
-	        AUDACIOUS_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "audacious >= 2.4" 2>&1`
+	        AUDACIOUS_PKG_ERRORS=`$PKG_CONFIG --print-errors "audacious >= 2.4" 2>&1`
         fi
-		echo "$AUDACIOUS_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-                as_fn_error "Cannot find Audacious 2.4 or later, have you installed audacious yet?" "$LINENO" 5
+	# Put the nasty error message in config.log where it belongs
+	echo "$AUDACIOUS_PKG_ERRORS" >&5
 
-elif test "x$pkg_failed" = "xuntried"; then
-	as_fn_error "Cannot find Audacious 2.4 or later, have you installed audacious yet?" "$LINENO" 5
+	as_fn_error $? "Cannot find Audacious 2.4 or later, have you installed audacious yet?" "$LINENO" 5
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	as_fn_error $? "Cannot find Audacious 2.4 or later, have you installed audacious yet?" "$LINENO" 5
 
 else
-	AUDACIOUS_CFLAGS="$pkg_cv_AUDACIOUS_CFLAGS"
-	AUDACIOUS_LIBS="$pkg_cv_AUDACIOUS_LIBS"
+	AUDACIOUS_CFLAGS=$pkg_cv_AUDACIOUS_CFLAGS
+	AUDACIOUS_LIBS=$pkg_cv_AUDACIOUS_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 
@@ -7168,50 +7590,73 @@
 LIBS="$LIBS $AUDACIOUS_LIBS"
 
 
+
 pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for GLIB" >&5
 $as_echo_n "checking for GLIB... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"glib-2.0 >= 2.12.0 gthread-2.0\""; } >&5
+
+if test -n "$GLIB_CFLAGS"; then
+    pkg_cv_GLIB_CFLAGS="$GLIB_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"glib-2.0 >= 2.12.0 gthread-2.0\""; } >&5
   ($PKG_CONFIG --exists --print-errors "glib-2.0 >= 2.12.0 gthread-2.0") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${GLIB_CFLAGS}" != "x"; then
-            pkg_cv_GLIB_CFLAGS="${GLIB_CFLAGS}"
-        else
-            pkg_cv_GLIB_CFLAGS=`$PKG_CONFIG --cflags "glib-2.0 >= 2.12.0 gthread-2.0" 2>/dev/null`
-        fi
-        if test "x${GLIB_LIBS}" != "x"; then
-            pkg_cv_GLIB_LIBS="${GLIB_LIBS}"
-        else
-            pkg_cv_GLIB_LIBS=`$PKG_CONFIG --libs "glib-2.0 >= 2.12.0 gthread-2.0" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_GLIB_CFLAGS=`$PKG_CONFIG --cflags "glib-2.0 >= 2.12.0 gthread-2.0" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$GLIB_LIBS"; then
+    pkg_cv_GLIB_LIBS="$GLIB_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"glib-2.0 >= 2.12.0 gthread-2.0\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "glib-2.0 >= 2.12.0 gthread-2.0") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_GLIB_LIBS=`$PKG_CONFIG --libs "glib-2.0 >= 2.12.0 gthread-2.0" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        GLIB_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "glib-2.0 >= 2.12.0 gthread-2.0" 2>&1`
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        GLIB_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "glib-2.0 >= 2.12.0 gthread-2.0" 2>&1`
         else
-	        GLIB_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "glib-2.0 >= 2.12.0 gthread-2.0" 2>&1`
+	        GLIB_PKG_ERRORS=`$PKG_CONFIG --print-errors "glib-2.0 >= 2.12.0 gthread-2.0" 2>&1`
         fi
-		echo "$GLIB_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-                as_fn_error "Cannot find Glib2 >= 2.12.0" "$LINENO" 5
+	# Put the nasty error message in config.log where it belongs
+	echo "$GLIB_PKG_ERRORS" >&5
 
-elif test "x$pkg_failed" = "xuntried"; then
-	as_fn_error "Cannot find Glib2 >= 2.12.0" "$LINENO" 5
+	as_fn_error $? "Cannot find Glib2 >= 2.12.0" "$LINENO" 5
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	as_fn_error $? "Cannot find Glib2 >= 2.12.0" "$LINENO" 5
 
 else
-	GLIB_CFLAGS="$pkg_cv_GLIB_CFLAGS"
-	GLIB_LIBS="$pkg_cv_GLIB_LIBS"
+	GLIB_CFLAGS=$pkg_cv_GLIB_CFLAGS
+	GLIB_LIBS=$pkg_cv_GLIB_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 
@@ -7224,50 +7669,73 @@
 
 fi
 
+
 pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for GTK" >&5
 $as_echo_n "checking for GTK... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"gtk+-2.0 >= 2.8.0\""; } >&5
+
+if test -n "$GTK_CFLAGS"; then
+    pkg_cv_GTK_CFLAGS="$GTK_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"gtk+-2.0 >= 2.8.0\""; } >&5
   ($PKG_CONFIG --exists --print-errors "gtk+-2.0 >= 2.8.0") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${GTK_CFLAGS}" != "x"; then
-            pkg_cv_GTK_CFLAGS="${GTK_CFLAGS}"
-        else
-            pkg_cv_GTK_CFLAGS=`$PKG_CONFIG --cflags "gtk+-2.0 >= 2.8.0" 2>/dev/null`
-        fi
-        if test "x${GTK_LIBS}" != "x"; then
-            pkg_cv_GTK_LIBS="${GTK_LIBS}"
-        else
-            pkg_cv_GTK_LIBS=`$PKG_CONFIG --libs "gtk+-2.0 >= 2.8.0" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_GTK_CFLAGS=`$PKG_CONFIG --cflags "gtk+-2.0 >= 2.8.0" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$GTK_LIBS"; then
+    pkg_cv_GTK_LIBS="$GTK_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"gtk+-2.0 >= 2.8.0\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "gtk+-2.0 >= 2.8.0") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_GTK_LIBS=`$PKG_CONFIG --libs "gtk+-2.0 >= 2.8.0" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        GTK_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "gtk+-2.0 >= 2.8.0" 2>&1`
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        GTK_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "gtk+-2.0 >= 2.8.0" 2>&1`
         else
-	        GTK_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "gtk+-2.0 >= 2.8.0" 2>&1`
+	        GTK_PKG_ERRORS=`$PKG_CONFIG --print-errors "gtk+-2.0 >= 2.8.0" 2>&1`
         fi
-		echo "$GTK_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-                as_fn_error "Cannot find Gtk+2 >= 2.8.0" "$LINENO" 5
+	# Put the nasty error message in config.log where it belongs
+	echo "$GTK_PKG_ERRORS" >&5
 
-elif test "x$pkg_failed" = "xuntried"; then
-	as_fn_error "Cannot find Gtk+2 >= 2.8.0" "$LINENO" 5
+	as_fn_error $? "Cannot find Gtk+2 >= 2.8.0" "$LINENO" 5
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	as_fn_error $? "Cannot find Gtk+2 >= 2.8.0" "$LINENO" 5
 
 else
-	GTK_CFLAGS="$pkg_cv_GTK_CFLAGS"
-	GTK_LIBS="$pkg_cv_GTK_LIBS"
+	GTK_CFLAGS=$pkg_cv_GTK_CFLAGS
+	GTK_LIBS=$pkg_cv_GTK_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 
@@ -7289,48 +7757,71 @@
 
 
 if test "x$enable_gio" = "xyes"; then
-    pkg_failed=no
+
+pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for GIO" >&5
 $as_echo_n "checking for GIO... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"gio-2.0 >= 2.0\""; } >&5
+
+if test -n "$GIO_CFLAGS"; then
+    pkg_cv_GIO_CFLAGS="$GIO_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"gio-2.0 >= 2.0\""; } >&5
   ($PKG_CONFIG --exists --print-errors "gio-2.0 >= 2.0") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${GIO_CFLAGS}" != "x"; then
-            pkg_cv_GIO_CFLAGS="${GIO_CFLAGS}"
-        else
-            pkg_cv_GIO_CFLAGS=`$PKG_CONFIG --cflags "gio-2.0 >= 2.0" 2>/dev/null`
-        fi
-        if test "x${GIO_LIBS}" != "x"; then
-            pkg_cv_GIO_LIBS="${GIO_LIBS}"
-        else
-            pkg_cv_GIO_LIBS=`$PKG_CONFIG --libs "gio-2.0 >= 2.0" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_GIO_CFLAGS=`$PKG_CONFIG --cflags "gio-2.0 >= 2.0" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$GIO_LIBS"; then
+    pkg_cv_GIO_LIBS="$GIO_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"gio-2.0 >= 2.0\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "gio-2.0 >= 2.0") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_GIO_LIBS=`$PKG_CONFIG --libs "gio-2.0 >= 2.0" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
-
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        GIO_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "gio-2.0 >= 2.0" 2>&1`
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        GIO_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "gio-2.0 >= 2.0" 2>&1`
         else
-	        GIO_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "gio-2.0 >= 2.0" 2>&1`
+	        GIO_PKG_ERRORS=`$PKG_CONFIG --print-errors "gio-2.0 >= 2.0" 2>&1`
         fi
-		echo "$GIO_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+	# Put the nasty error message in config.log where it belongs
+	echo "$GIO_PKG_ERRORS" >&5
+
+	enable_gio=no
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-                enable_gio=no
-elif test "x$pkg_failed" = "xuntried"; then
 	enable_gio=no
 else
-	GIO_CFLAGS="$pkg_cv_GIO_CFLAGS"
-	GIO_LIBS="$pkg_cv_GIO_LIBS"
+	GIO_CFLAGS=$pkg_cv_GIO_CFLAGS
+	GIO_LIBS=$pkg_cv_GIO_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 
@@ -7348,50 +7839,73 @@
     TRANSPORT_PLUGINS="$TRANSPORT_PLUGINS gio"
 fi
 
+
 pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for PANGO" >&5
 $as_echo_n "checking for PANGO... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"pango >= 1.8.0\""; } >&5
+
+if test -n "$PANGO_CFLAGS"; then
+    pkg_cv_PANGO_CFLAGS="$PANGO_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"pango >= 1.8.0\""; } >&5
   ($PKG_CONFIG --exists --print-errors "pango >= 1.8.0") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${PANGO_CFLAGS}" != "x"; then
-            pkg_cv_PANGO_CFLAGS="${PANGO_CFLAGS}"
-        else
-            pkg_cv_PANGO_CFLAGS=`$PKG_CONFIG --cflags "pango >= 1.8.0" 2>/dev/null`
-        fi
-        if test "x${PANGO_LIBS}" != "x"; then
-            pkg_cv_PANGO_LIBS="${PANGO_LIBS}"
-        else
-            pkg_cv_PANGO_LIBS=`$PKG_CONFIG --libs "pango >= 1.8.0" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_PANGO_CFLAGS=`$PKG_CONFIG --cflags "pango >= 1.8.0" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$PANGO_LIBS"; then
+    pkg_cv_PANGO_LIBS="$PANGO_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"pango >= 1.8.0\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "pango >= 1.8.0") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_PANGO_LIBS=`$PKG_CONFIG --libs "pango >= 1.8.0" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        PANGO_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "pango >= 1.8.0" 2>&1`
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        PANGO_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "pango >= 1.8.0" 2>&1`
         else
-	        PANGO_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "pango >= 1.8.0" 2>&1`
+	        PANGO_PKG_ERRORS=`$PKG_CONFIG --print-errors "pango >= 1.8.0" 2>&1`
         fi
-		echo "$PANGO_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-                as_fn_error "Cannot find Pango >= 1.8.0" "$LINENO" 5
+	# Put the nasty error message in config.log where it belongs
+	echo "$PANGO_PKG_ERRORS" >&5
 
-elif test "x$pkg_failed" = "xuntried"; then
-	as_fn_error "Cannot find Pango >= 1.8.0" "$LINENO" 5
+	as_fn_error $? "Cannot find Pango >= 1.8.0" "$LINENO" 5
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	as_fn_error $? "Cannot find Pango >= 1.8.0" "$LINENO" 5
 
 else
-	PANGO_CFLAGS="$pkg_cv_PANGO_CFLAGS"
-	PANGO_LIBS="$pkg_cv_PANGO_LIBS"
+	PANGO_CFLAGS=$pkg_cv_PANGO_CFLAGS
+	PANGO_LIBS=$pkg_cv_PANGO_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 
@@ -7412,50 +7926,73 @@
 fi
 
 if test "x$enable_dbus" = "xyes"; then
-	pkg_failed=no
+
+pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for DBUS" >&5
 $as_echo_n "checking for DBUS... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"dbus-1 >= 0.60 dbus-glib-1 >= 0.60\""; } >&5
+
+if test -n "$DBUS_CFLAGS"; then
+    pkg_cv_DBUS_CFLAGS="$DBUS_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"dbus-1 >= 0.60 dbus-glib-1 >= 0.60\""; } >&5
   ($PKG_CONFIG --exists --print-errors "dbus-1 >= 0.60 dbus-glib-1 >= 0.60") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${DBUS_CFLAGS}" != "x"; then
-            pkg_cv_DBUS_CFLAGS="${DBUS_CFLAGS}"
-        else
-            pkg_cv_DBUS_CFLAGS=`$PKG_CONFIG --cflags "dbus-1 >= 0.60 dbus-glib-1 >= 0.60" 2>/dev/null`
-        fi
-        if test "x${DBUS_LIBS}" != "x"; then
-            pkg_cv_DBUS_LIBS="${DBUS_LIBS}"
-        else
-            pkg_cv_DBUS_LIBS=`$PKG_CONFIG --libs "dbus-1 >= 0.60 dbus-glib-1 >= 0.60" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_DBUS_CFLAGS=`$PKG_CONFIG --cflags "dbus-1 >= 0.60 dbus-glib-1 >= 0.60" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$DBUS_LIBS"; then
+    pkg_cv_DBUS_LIBS="$DBUS_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"dbus-1 >= 0.60 dbus-glib-1 >= 0.60\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "dbus-1 >= 0.60 dbus-glib-1 >= 0.60") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_DBUS_LIBS=`$PKG_CONFIG --libs "dbus-1 >= 0.60 dbus-glib-1 >= 0.60" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
 fi
+ else
+    pkg_failed=untried
+fi
+
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        DBUS_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "dbus-1 >= 0.60 dbus-glib-1 >= 0.60" 2>&1`
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        DBUS_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "dbus-1 >= 0.60 dbus-glib-1 >= 0.60" 2>&1`
         else
-	        DBUS_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "dbus-1 >= 0.60 dbus-glib-1 >= 0.60" 2>&1`
+	        DBUS_PKG_ERRORS=`$PKG_CONFIG --print-errors "dbus-1 >= 0.60 dbus-glib-1 >= 0.60" 2>&1`
         fi
-		echo "$DBUS_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-                as_fn_error "Cannot find dbus-glib >= 0.60" "$LINENO" 5
+	# Put the nasty error message in config.log where it belongs
+	echo "$DBUS_PKG_ERRORS" >&5
+
+	as_fn_error $? "Cannot find dbus-glib >= 0.60" "$LINENO" 5
 	]
-elif test "x$pkg_failed" = "xuntried"; then
-	as_fn_error "Cannot find dbus-glib >= 0.60" "$LINENO" 5
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	as_fn_error $? "Cannot find dbus-glib >= 0.60" "$LINENO" 5
 	]
 else
-	DBUS_CFLAGS="$pkg_cv_DBUS_CFLAGS"
-	DBUS_LIBS="$pkg_cv_DBUS_LIBS"
+	DBUS_CFLAGS=$pkg_cv_DBUS_CFLAGS
+	DBUS_LIBS=$pkg_cv_DBUS_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 
@@ -7474,50 +8011,73 @@
 
 
 
+
 pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for MOWGLI" >&5
 $as_echo_n "checking for MOWGLI... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libmowgli >= 0.4.0\""; } >&5
+
+if test -n "$MOWGLI_CFLAGS"; then
+    pkg_cv_MOWGLI_CFLAGS="$MOWGLI_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libmowgli >= 0.4.0\""; } >&5
   ($PKG_CONFIG --exists --print-errors "libmowgli >= 0.4.0") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${MOWGLI_CFLAGS}" != "x"; then
-            pkg_cv_MOWGLI_CFLAGS="${MOWGLI_CFLAGS}"
-        else
-            pkg_cv_MOWGLI_CFLAGS=`$PKG_CONFIG --cflags "libmowgli >= 0.4.0" 2>/dev/null`
-        fi
-        if test "x${MOWGLI_LIBS}" != "x"; then
-            pkg_cv_MOWGLI_LIBS="${MOWGLI_LIBS}"
-        else
-            pkg_cv_MOWGLI_LIBS=`$PKG_CONFIG --libs "libmowgli >= 0.4.0" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_MOWGLI_CFLAGS=`$PKG_CONFIG --cflags "libmowgli >= 0.4.0" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$MOWGLI_LIBS"; then
+    pkg_cv_MOWGLI_LIBS="$MOWGLI_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libmowgli >= 0.4.0\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "libmowgli >= 0.4.0") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_MOWGLI_LIBS=`$PKG_CONFIG --libs "libmowgli >= 0.4.0" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
 fi
+ else
+    pkg_failed=untried
+fi
+
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        MOWGLI_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "libmowgli >= 0.4.0" 2>&1`
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        MOWGLI_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "libmowgli >= 0.4.0" 2>&1`
         else
-	        MOWGLI_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "libmowgli >= 0.4.0" 2>&1`
+	        MOWGLI_PKG_ERRORS=`$PKG_CONFIG --print-errors "libmowgli >= 0.4.0" 2>&1`
         fi
-		echo "$MOWGLI_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-                as_fn_error "Cannot find libmowgli >= 0.4.0, try http://www.atheme.org/projects/mowgli.shtml" "$LINENO" 5
+	# Put the nasty error message in config.log where it belongs
+	echo "$MOWGLI_PKG_ERRORS" >&5
+
+	as_fn_error $? "Cannot find libmowgli >= 0.4.0, try http://www.atheme.org/projects/mowgli.shtml" "$LINENO" 5
 
-elif test "x$pkg_failed" = "xuntried"; then
-	as_fn_error "Cannot find libmowgli >= 0.4.0, try http://www.atheme.org/projects/mowgli.shtml" "$LINENO" 5
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	as_fn_error $? "Cannot find libmowgli >= 0.4.0, try http://www.atheme.org/projects/mowgli.shtml" "$LINENO" 5
 
 else
-	MOWGLI_CFLAGS="$pkg_cv_MOWGLI_CFLAGS"
-	MOWGLI_LIBS="$pkg_cv_MOWGLI_LIBS"
+	MOWGLI_CFLAGS=$pkg_cv_MOWGLI_CFLAGS
+	MOWGLI_LIBS=$pkg_cv_MOWGLI_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 
@@ -7575,134 +8135,8 @@
 
 
 
-
-
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for shared library system" >&5
-$as_echo_n "checking for shared library system... " >&6; }
-	case "$host_os" in
-		darwin*)
-			{ $as_echo "$as_me:${as_lineno-$LINENO}: result: Darwin" >&5
-$as_echo "Darwin" >&6; }
-			LIB_CPPFLAGS='-DPIC'
-			LIB_CFLAGS='-fPIC'
-			LIB_LDFLAGS='-dynamiclib -flat_namespace'
-			LIB_PREFIX='lib'
-			LIB_SUFFIX='.dylib'
-			LDFLAGS_RPATH='-Wl,-rpath,${libdir}'
-			PLUGIN_CPPFLAGS='-DPIC'
-			PLUGIN_CFLAGS='-fPIC'
-			PLUGIN_LDFLAGS='-bundle -flat_namespace -undefined suppress'
-			PLUGIN_SUFFIX='.impl'
-			INSTALL_LIB='${INSTALL} -m 755 $$i ${DESTDIR}${libdir}/$${i%.dylib}.${LIB_MAJOR}.${LIB_MINOR}.dylib && ${LN_S} -f $${i%.dylib}.${LIB_MAJOR}.${LIB_MINOR}.dylib ${DESTDIR}${libdir}/$${i%.dylib}.${LIB_MAJOR}.dylib && ${LN_S} -f $${i%.dylib}.${LIB_MAJOR}.${LIB_MINOR}.dylib ${DESTDIR}${libdir}/$$i'
-			UNINSTALL_LIB='rm -f ${DESTDIR}${libdir}/$$i ${DESTDIR}${libdir}/$${i%.dylib}.${LIB_MAJOR}.dylib ${DESTDIR}${libdir}/$${i%.dylib}.${LIB_MAJOR}.${LIB_MINOR}.dylib'
-			CLEAN_LIB=''
-			;;
-		solaris*)
-			{ $as_echo "$as_me:${as_lineno-$LINENO}: result: Solaris" >&5
-$as_echo "Solaris" >&6; }
-			LIB_CPPFLAGS='-DPIC'
-			LIB_CFLAGS='-fPIC'
-			LIB_LDFLAGS='-shared -fPIC -Wl,-soname=${LIB}.${LIB_MAJOR}.${LIB_MINOR}'
-			LIB_PREFIX='lib'
-			LIB_SUFFIX='.so'
-			LDFLAGS_RPATH='-Wl,-rpath,${libdir}'
-			PLUGIN_CPPFLAGS='-DPIC'
-			PLUGIN_CFLAGS='-fPIC'
-			PLUGIN_LDFLAGS='-shared -fPIC'
-			PLUGIN_SUFFIX='.so'
-			INSTALL_LIB='${INSTALL} -m 755 $$i ${DESTDIR}${libdir}/$$i.${LIB_MAJOR}.${LIB_MINOR} && rm -f ${DESTDIR}${libdir}/$$i && ${LN_S} $$i.${LIB_MAJOR}.${LIB_MINOR} ${DESTDIR}${libdir}/$$i'
-			UNINSTALL_LIB='rm -f ${DESTDIR}${libdir}/$$i ${DESTDIR}${libdir}/$$i.${LIB_MAJOR}.${LIB_MINOR}'
-			CLEAN_LIB=''
-			;;
-		openbsd* | mirbsd*)
-			{ $as_echo "$as_me:${as_lineno-$LINENO}: result: OpenBSD" >&5
-$as_echo "OpenBSD" >&6; }
-			LIB_CPPFLAGS='-DPIC'
-			LIB_CFLAGS='-fPIC'
-			LIB_LDFLAGS='-shared -fPIC'
-			LIB_PREFIX='lib'
-			LIB_SUFFIX='.so.${LIB_MAJOR}.${LIB_MINOR}'
-			LDFLAGS_RPATH='-Wl,-rpath,${libdir}'
-			PLUGIN_CPPFLAGS='-DPIC'
-			PLUGIN_CFLAGS='-fPIC'
-			PLUGIN_LDFLAGS='-shared -fPIC'
-			PLUGIN_SUFFIX='.so'
-			INSTALL_LIB='${INSTALL} -m 755 $$i ${DESTDIR}${libdir}/$$i'
-			UNINSTALL_LIB='rm -f ${DESTDIR}${libdir}/$$i'
-			CLEAN_LIB=''
-			;;
-		cygwin* | mingw*)
-			{ $as_echo "$as_me:${as_lineno-$LINENO}: result: Win32" >&5
-$as_echo "Win32" >&6; }
-			LIB_CPPFLAGS='-DPIC'
-			LIB_CFLAGS=''
-			LIB_LDFLAGS='-shared -Wl,--out-implib,${LIB}.a'
-			LIB_PREFIX='lib'
-			LIB_SUFFIX='.dll'
-			LDFLAGS_RPATH='-Wl,-rpath,${libdir}'
-			PLUGIN_CPPFLAGS=''
-			PLUGIN_CFLAGS=''
-			PLUGIN_LDFLAGS='-shared'
-			PLUGIN_SUFFIX='.dll'
-			INSTALL_LIB='${MKDIR_P} ${DESTDIR}${bindir} && ${INSTALL} -m 755 $$i ${DESTDIR}${bindir}/$$i && ${INSTALL} -m 755 $$i.a ${DESTDIR}${libdir}/$$i.a'
-			UNINSTALL_LIB='rm -f ${DESTDIR}${bindir}/$$i ${DESTDIR}${libdir}/$$i.a'
-			CLEAN_LIB='${LIB}.a'
-			;;
-		*)
-			{ $as_echo "$as_me:${as_lineno-$LINENO}: result: GNU" >&5
-$as_echo "GNU" >&6; }
-			LIB_CPPFLAGS='-DPIC'
-			LIB_CFLAGS='-fPIC'
-			LIB_LDFLAGS='-shared -fPIC -Wl,-soname=${LIB}.${LIB_MAJOR}'
-			LIB_PREFIX='lib'
-			LIB_SUFFIX='.so'
-			LDFLAGS_RPATH='-Wl,-rpath,${libdir}'
-			PLUGIN_CPPFLAGS='-DPIC'
-			PLUGIN_CFLAGS='-fPIC'
-			PLUGIN_LDFLAGS='-shared -fPIC'
-			PLUGIN_SUFFIX='.so'
-			INSTALL_LIB='${INSTALL} -m 755 $$i ${DESTDIR}${libdir}/$$i.${LIB_MAJOR}.${LIB_MINOR}.0 && ${LN_S} -f $$i.${LIB_MAJOR}.${LIB_MINOR}.0 ${DESTDIR}${libdir}/$$i.${LIB_MAJOR} && ${LN_S} -f $$i.${LIB_MAJOR}.${LIB_MINOR}.0 ${DESTDIR}${libdir}/$$i'
-			UNINSTALL_LIB='rm -f ${DESTDIR}${libdir}/$$i ${DESTDIR}${libdir}/$$i.${LIB_MAJOR} ${DESTDIR}${libdir}/$$i.${LIB_MAJOR}.${LIB_MINOR}.0'
-			CLEAN_LIB=''
-			;;
-	esac
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we need an implib" >&5
-$as_echo_n "checking whether we need an implib... " >&6; }
-	case "$host_os" in
-		cygwin* | mingw*)
-			{ $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
-$as_echo "yes" >&6; }
-			PROG_IMPLIB_NEEDED='yes'
-			PROG_IMPLIB_LDFLAGS='-Wl,-export-all-symbols,--out-implib,lib${PROG}.a'
-			;;
-		*)
-			{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-			PROG_IMPLIB_NEEDED='no'
-			PROG_IMPLIB_LDFLAGS=''
-			;;
-	esac
-
-
-
-
+BUILDSYS_SHARED_LIB
+BUILDSYS_PROG_IMPLIB
 test "x$PROG_IMPLIB_NEEDED" = "xyes" && LIBS="$LIBS -L\${libdir} -laudacious.exe"
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking if you are running Apple-GCC" >&5
@@ -7730,50 +8164,73 @@
 
 
 if test "x$enable_pulse" = "xyes"; then
-    pkg_failed=no
+
+pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for PULSE" >&5
 $as_echo_n "checking for PULSE... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libpulse >= 0.9.9\""; } >&5
+
+if test -n "$PULSE_CFLAGS"; then
+    pkg_cv_PULSE_CFLAGS="$PULSE_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libpulse >= 0.9.9\""; } >&5
   ($PKG_CONFIG --exists --print-errors "libpulse >= 0.9.9") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${PULSE_CFLAGS}" != "x"; then
-            pkg_cv_PULSE_CFLAGS="${PULSE_CFLAGS}"
-        else
-            pkg_cv_PULSE_CFLAGS=`$PKG_CONFIG --cflags "libpulse >= 0.9.9" 2>/dev/null`
-        fi
-        if test "x${PULSE_LIBS}" != "x"; then
-            pkg_cv_PULSE_LIBS="${PULSE_LIBS}"
-        else
-            pkg_cv_PULSE_LIBS=`$PKG_CONFIG --libs "libpulse >= 0.9.9" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_PULSE_CFLAGS=`$PKG_CONFIG --cflags "libpulse >= 0.9.9" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$PULSE_LIBS"; then
+    pkg_cv_PULSE_LIBS="$PULSE_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libpulse >= 0.9.9\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "libpulse >= 0.9.9") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_PULSE_LIBS=`$PKG_CONFIG --libs "libpulse >= 0.9.9" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
 fi
+ else
+    pkg_failed=untried
+fi
+
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        PULSE_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "libpulse >= 0.9.9" 2>&1`
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        PULSE_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "libpulse >= 0.9.9" 2>&1`
         else
-	        PULSE_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "libpulse >= 0.9.9" 2>&1`
+	        PULSE_PKG_ERRORS=`$PKG_CONFIG --print-errors "libpulse >= 0.9.9" 2>&1`
         fi
-		echo "$PULSE_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-                have_pulse=no
+	# Put the nasty error message in config.log where it belongs
+	echo "$PULSE_PKG_ERRORS" >&5
+
+	have_pulse=no
 
-elif test "x$pkg_failed" = "xuntried"; then
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 	have_pulse=no
 
 else
-	PULSE_CFLAGS="$pkg_cv_PULSE_CFLAGS"
-	PULSE_LIBS="$pkg_cv_PULSE_LIBS"
+	PULSE_CFLAGS=$pkg_cv_PULSE_CFLAGS
+	PULSE_LIBS=$pkg_cv_PULSE_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 	have_pulse=yes
@@ -7796,50 +8253,73 @@
 
 
 if test "x$enable_roar" = "xyes"; then
-    pkg_failed=no
+
+pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for LIBROAR" >&5
 $as_echo_n "checking for LIBROAR... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libroar\""; } >&5
+
+if test -n "$LIBROAR_CFLAGS"; then
+    pkg_cv_LIBROAR_CFLAGS="$LIBROAR_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libroar\""; } >&5
   ($PKG_CONFIG --exists --print-errors "libroar") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${LIBROAR_CFLAGS}" != "x"; then
-            pkg_cv_LIBROAR_CFLAGS="${LIBROAR_CFLAGS}"
-        else
-            pkg_cv_LIBROAR_CFLAGS=`$PKG_CONFIG --cflags "libroar" 2>/dev/null`
-        fi
-        if test "x${LIBROAR_LIBS}" != "x"; then
-            pkg_cv_LIBROAR_LIBS="${LIBROAR_LIBS}"
-        else
-            pkg_cv_LIBROAR_LIBS=`$PKG_CONFIG --libs "libroar" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_LIBROAR_CFLAGS=`$PKG_CONFIG --cflags "libroar" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LIBROAR_LIBS"; then
+    pkg_cv_LIBROAR_LIBS="$LIBROAR_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libroar\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "libroar") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LIBROAR_LIBS=`$PKG_CONFIG --libs "libroar" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
 fi
+ else
+    pkg_failed=untried
+fi
+
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        LIBROAR_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "libroar" 2>&1`
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LIBROAR_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "libroar" 2>&1`
         else
-	        LIBROAR_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "libroar" 2>&1`
+	        LIBROAR_PKG_ERRORS=`$PKG_CONFIG --print-errors "libroar" 2>&1`
         fi
-		echo "$LIBROAR_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-                have_roar=no
+	# Put the nasty error message in config.log where it belongs
+	echo "$LIBROAR_PKG_ERRORS" >&5
+
+	have_roar=no
 
-elif test "x$pkg_failed" = "xuntried"; then
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 	have_roar=no
 
 else
-	LIBROAR_CFLAGS="$pkg_cv_LIBROAR_CFLAGS"
-	LIBROAR_LIBS="$pkg_cv_LIBROAR_LIBS"
+	LIBROAR_CFLAGS=$pkg_cv_LIBROAR_CFLAGS
+	LIBROAR_LIBS=$pkg_cv_LIBROAR_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 	have_roar=yes
@@ -7971,8 +8451,8 @@
   if test "$cross_compiling" = yes; then :
   { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-as_fn_error "cannot run test program while cross compiling
-See \`config.log' for more details." "$LINENO" 5; }
+as_fn_error $? "cannot run test program while cross compiling
+See \`config.log' for more details" "$LINENO" 5 ; }
 else
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
@@ -8006,6 +8486,21 @@
 CFLAGS="$ac_save_CFLAGS"
 
 
+
+# Check whether --enable-psf was given.
+if test "${enable_psf+set}" = set; then :
+  enableval=$enable_psf; enable_psf=$enableval
+else
+  enable_psf=yes
+fi
+
+
+if test "$enable_psf" = "yes"; then
+    INPUT_PLUGINS="$INPUT_PLUGINS psf"
+fi
+
+
+
 # Check whether --enable-usf was given.
 if test "${enable_usf+set}" = set; then :
   enableval=$enable_usf; enable_usf=$enableval
@@ -8186,51 +8681,74 @@
 
 if test "x$enable_hotkey" = "xyes"; then
     have_hotkey="yes"
-    pkg_failed=no
+
+pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for GDKX11" >&5
 $as_echo_n "checking for GDKX11... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"gdk-x11-2.0 >= 2.6.0\""; } >&5
+
+if test -n "$GDKX11_CFLAGS"; then
+    pkg_cv_GDKX11_CFLAGS="$GDKX11_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"gdk-x11-2.0 >= 2.6.0\""; } >&5
   ($PKG_CONFIG --exists --print-errors "gdk-x11-2.0 >= 2.6.0") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${GDKX11_CFLAGS}" != "x"; then
-            pkg_cv_GDKX11_CFLAGS="${GDKX11_CFLAGS}"
-        else
-            pkg_cv_GDKX11_CFLAGS=`$PKG_CONFIG --cflags "gdk-x11-2.0 >= 2.6.0" 2>/dev/null`
-        fi
-        if test "x${GDKX11_LIBS}" != "x"; then
-            pkg_cv_GDKX11_LIBS="${GDKX11_LIBS}"
-        else
-            pkg_cv_GDKX11_LIBS=`$PKG_CONFIG --libs "gdk-x11-2.0 >= 2.6.0" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_GDKX11_CFLAGS=`$PKG_CONFIG --cflags "gdk-x11-2.0 >= 2.6.0" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$GDKX11_LIBS"; then
+    pkg_cv_GDKX11_LIBS="$GDKX11_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"gdk-x11-2.0 >= 2.6.0\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "gdk-x11-2.0 >= 2.6.0") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_GDKX11_LIBS=`$PKG_CONFIG --libs "gdk-x11-2.0 >= 2.6.0" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        GDKX11_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "gdk-x11-2.0 >= 2.6.0" 2>&1`
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        GDKX11_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "gdk-x11-2.0 >= 2.6.0" 2>&1`
         else
-	        GDKX11_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "gdk-x11-2.0 >= 2.6.0" 2>&1`
+	        GDKX11_PKG_ERRORS=`$PKG_CONFIG --print-errors "gdk-x11-2.0 >= 2.6.0" 2>&1`
         fi
-		echo "$GDKX11_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+	# Put the nasty error message in config.log where it belongs
+	echo "$GDKX11_PKG_ERRORS" >&5
+
+	have_hotkey="no"
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-                have_hotkey="no"
-elif test "x$pkg_failed" = "xuntried"; then
 	have_hotkey="no"
 else
-	GDKX11_CFLAGS="$pkg_cv_GDKX11_CFLAGS"
-	GDKX11_LIBS="$pkg_cv_GDKX11_LIBS"
+	GDKX11_CFLAGS=$pkg_cv_GDKX11_CFLAGS
+	GDKX11_LIBS=$pkg_cv_GDKX11_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
-	:
+
 fi
 else
     { $as_echo "$as_me:${as_lineno-$LINENO}: result: *** X11 Global Hotkey plugin disabled per user request ***" >&5
@@ -8254,51 +8772,74 @@
 
 if test "x$enable_gnomeshortcuts" = "xyes"; then
     have_gnomeshortcuts="yes"
-    pkg_failed=no
+
+pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for DBUS" >&5
 $as_echo_n "checking for DBUS... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"dbus-1 >= 0.60 dbus-glib-1 >= 0.60\""; } >&5
+
+if test -n "$DBUS_CFLAGS"; then
+    pkg_cv_DBUS_CFLAGS="$DBUS_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"dbus-1 >= 0.60 dbus-glib-1 >= 0.60\""; } >&5
   ($PKG_CONFIG --exists --print-errors "dbus-1 >= 0.60 dbus-glib-1 >= 0.60") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${DBUS_CFLAGS}" != "x"; then
-            pkg_cv_DBUS_CFLAGS="${DBUS_CFLAGS}"
-        else
-            pkg_cv_DBUS_CFLAGS=`$PKG_CONFIG --cflags "dbus-1 >= 0.60 dbus-glib-1 >= 0.60" 2>/dev/null`
-        fi
-        if test "x${DBUS_LIBS}" != "x"; then
-            pkg_cv_DBUS_LIBS="${DBUS_LIBS}"
-        else
-            pkg_cv_DBUS_LIBS=`$PKG_CONFIG --libs "dbus-1 >= 0.60 dbus-glib-1 >= 0.60" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_DBUS_CFLAGS=`$PKG_CONFIG --cflags "dbus-1 >= 0.60 dbus-glib-1 >= 0.60" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$DBUS_LIBS"; then
+    pkg_cv_DBUS_LIBS="$DBUS_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"dbus-1 >= 0.60 dbus-glib-1 >= 0.60\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "dbus-1 >= 0.60 dbus-glib-1 >= 0.60") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_DBUS_LIBS=`$PKG_CONFIG --libs "dbus-1 >= 0.60 dbus-glib-1 >= 0.60" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
 fi
+ else
+    pkg_failed=untried
+fi
+
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        DBUS_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "dbus-1 >= 0.60 dbus-glib-1 >= 0.60" 2>&1`
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        DBUS_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "dbus-1 >= 0.60 dbus-glib-1 >= 0.60" 2>&1`
         else
-	        DBUS_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "dbus-1 >= 0.60 dbus-glib-1 >= 0.60" 2>&1`
+	        DBUS_PKG_ERRORS=`$PKG_CONFIG --print-errors "dbus-1 >= 0.60 dbus-glib-1 >= 0.60" 2>&1`
         fi
-		echo "$DBUS_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+	# Put the nasty error message in config.log where it belongs
+	echo "$DBUS_PKG_ERRORS" >&5
+
+	as_fn_error $? "Cannot find dbus-glib >= 0.60 for gnomeshortcuts plugin" "$LINENO" 5
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-                as_fn_error "Cannot find dbus-glib >= 0.60 for gnomeshortcuts plugin" "$LINENO" 5
-elif test "x$pkg_failed" = "xuntried"; then
-	as_fn_error "Cannot find dbus-glib >= 0.60 for gnomeshortcuts plugin" "$LINENO" 5
+	as_fn_error $? "Cannot find dbus-glib >= 0.60 for gnomeshortcuts plugin" "$LINENO" 5
 else
-	DBUS_CFLAGS="$pkg_cv_DBUS_CFLAGS"
-	DBUS_LIBS="$pkg_cv_DBUS_LIBS"
+	DBUS_CFLAGS=$pkg_cv_DBUS_CFLAGS
+	DBUS_LIBS=$pkg_cv_DBUS_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
-	:
+
 fi
 else
     { $as_echo "$as_me:${as_lineno-$LINENO}: result: *** Gnome Shortcuts Plugin disabled per user request ***" >&5
@@ -8321,48 +8862,71 @@
 
 
 if test "x$enable_statusicon" = "xyes"; then
-    pkg_failed=no
+
+pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for GTK" >&5
 $as_echo_n "checking for GTK... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"gtk+-2.0 >= 2.16.0\""; } >&5
+
+if test -n "$GTK_CFLAGS"; then
+    pkg_cv_GTK_CFLAGS="$GTK_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"gtk+-2.0 >= 2.16.0\""; } >&5
   ($PKG_CONFIG --exists --print-errors "gtk+-2.0 >= 2.16.0") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${GTK_CFLAGS}" != "x"; then
-            pkg_cv_GTK_CFLAGS="${GTK_CFLAGS}"
-        else
-            pkg_cv_GTK_CFLAGS=`$PKG_CONFIG --cflags "gtk+-2.0 >= 2.16.0" 2>/dev/null`
-        fi
-        if test "x${GTK_LIBS}" != "x"; then
-            pkg_cv_GTK_LIBS="${GTK_LIBS}"
-        else
-            pkg_cv_GTK_LIBS=`$PKG_CONFIG --libs "gtk+-2.0 >= 2.16.0" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_GTK_CFLAGS=`$PKG_CONFIG --cflags "gtk+-2.0 >= 2.16.0" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$GTK_LIBS"; then
+    pkg_cv_GTK_LIBS="$GTK_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"gtk+-2.0 >= 2.16.0\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "gtk+-2.0 >= 2.16.0") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_GTK_LIBS=`$PKG_CONFIG --libs "gtk+-2.0 >= 2.16.0" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
 fi
+ else
+    pkg_failed=untried
+fi
+
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        GTK_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "gtk+-2.0 >= 2.16.0" 2>&1`
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        GTK_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "gtk+-2.0 >= 2.16.0" 2>&1`
         else
-	        GTK_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "gtk+-2.0 >= 2.16.0" 2>&1`
+	        GTK_PKG_ERRORS=`$PKG_CONFIG --print-errors "gtk+-2.0 >= 2.16.0" 2>&1`
         fi
-		echo "$GTK_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+	# Put the nasty error message in config.log where it belongs
+	echo "$GTK_PKG_ERRORS" >&5
+
+	have_statusicon=no
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-                have_statusicon=no
-elif test "x$pkg_failed" = "xuntried"; then
 	have_statusicon=no
 else
-	GTK_CFLAGS="$pkg_cv_GTK_CFLAGS"
-	GTK_LIBS="$pkg_cv_GTK_LIBS"
+	GTK_CFLAGS=$pkg_cv_GTK_CFLAGS
+	GTK_LIBS=$pkg_cv_GTK_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 	have_statusicon=yes
@@ -8398,264 +8962,379 @@
 
 if test "x$enable_aosd" = "xguess"; then
     have_aosd="yes"
-    pkg_failed=no
+
+pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for PANGO" >&5
 $as_echo_n "checking for PANGO... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"pango >= 1.14.7\""; } >&5
+
+if test -n "$PANGO_CFLAGS"; then
+    pkg_cv_PANGO_CFLAGS="$PANGO_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"pango >= 1.14.7\""; } >&5
   ($PKG_CONFIG --exists --print-errors "pango >= 1.14.7") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${PANGO_CFLAGS}" != "x"; then
-            pkg_cv_PANGO_CFLAGS="${PANGO_CFLAGS}"
-        else
-            pkg_cv_PANGO_CFLAGS=`$PKG_CONFIG --cflags "pango >= 1.14.7" 2>/dev/null`
-        fi
-        if test "x${PANGO_LIBS}" != "x"; then
-            pkg_cv_PANGO_LIBS="${PANGO_LIBS}"
-        else
-            pkg_cv_PANGO_LIBS=`$PKG_CONFIG --libs "pango >= 1.14.7" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_PANGO_CFLAGS=`$PKG_CONFIG --cflags "pango >= 1.14.7" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$PANGO_LIBS"; then
+    pkg_cv_PANGO_LIBS="$PANGO_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"pango >= 1.14.7\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "pango >= 1.14.7") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_PANGO_LIBS=`$PKG_CONFIG --libs "pango >= 1.14.7" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
 fi
+ else
+    pkg_failed=untried
+fi
+
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        PANGO_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "pango >= 1.14.7" 2>&1`
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        PANGO_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "pango >= 1.14.7" 2>&1`
         else
-	        PANGO_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "pango >= 1.14.7" 2>&1`
+	        PANGO_PKG_ERRORS=`$PKG_CONFIG --print-errors "pango >= 1.14.7" 2>&1`
         fi
-		echo "$PANGO_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-                have_aosd="no"
+	# Put the nasty error message in config.log where it belongs
+	echo "$PANGO_PKG_ERRORS" >&5
+
+	have_aosd="no"
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: *** pango >= 1.14.7 is required for Audacious OSD plugin ***" >&5
 $as_echo "*** pango >= 1.14.7 is required for Audacious OSD plugin ***" >&6; }
 
-elif test "x$pkg_failed" = "xuntried"; then
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 	have_aosd="no"
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: *** pango >= 1.14.7 is required for Audacious OSD plugin ***" >&5
 $as_echo "*** pango >= 1.14.7 is required for Audacious OSD plugin ***" >&6; }
 
 else
-	PANGO_CFLAGS="$pkg_cv_PANGO_CFLAGS"
-	PANGO_LIBS="$pkg_cv_PANGO_LIBS"
+	PANGO_CFLAGS=$pkg_cv_PANGO_CFLAGS
+	PANGO_LIBS=$pkg_cv_PANGO_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
-	:
+
 fi
-    pkg_failed=no
+
+pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for CAIRO" >&5
 $as_echo_n "checking for CAIRO... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"cairo >= 1.2.6\""; } >&5
+
+if test -n "$CAIRO_CFLAGS"; then
+    pkg_cv_CAIRO_CFLAGS="$CAIRO_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"cairo >= 1.2.6\""; } >&5
   ($PKG_CONFIG --exists --print-errors "cairo >= 1.2.6") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${CAIRO_CFLAGS}" != "x"; then
-            pkg_cv_CAIRO_CFLAGS="${CAIRO_CFLAGS}"
-        else
-            pkg_cv_CAIRO_CFLAGS=`$PKG_CONFIG --cflags "cairo >= 1.2.6" 2>/dev/null`
-        fi
-        if test "x${CAIRO_LIBS}" != "x"; then
-            pkg_cv_CAIRO_LIBS="${CAIRO_LIBS}"
-        else
-            pkg_cv_CAIRO_LIBS=`$PKG_CONFIG --libs "cairo >= 1.2.6" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_CAIRO_CFLAGS=`$PKG_CONFIG --cflags "cairo >= 1.2.6" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$CAIRO_LIBS"; then
+    pkg_cv_CAIRO_LIBS="$CAIRO_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"cairo >= 1.2.6\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "cairo >= 1.2.6") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_CAIRO_LIBS=`$PKG_CONFIG --libs "cairo >= 1.2.6" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        CAIRO_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "cairo >= 1.2.6" 2>&1`
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        CAIRO_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "cairo >= 1.2.6" 2>&1`
         else
-	        CAIRO_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "cairo >= 1.2.6" 2>&1`
+	        CAIRO_PKG_ERRORS=`$PKG_CONFIG --print-errors "cairo >= 1.2.6" 2>&1`
         fi
-		echo "$CAIRO_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-                have_aosd="no"
+	# Put the nasty error message in config.log where it belongs
+	echo "$CAIRO_PKG_ERRORS" >&5
+
+	have_aosd="no"
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: *** cairo >= 1.2.6 is required for Audacious OSD plugin ***" >&5
 $as_echo "*** cairo >= 1.2.6 is required for Audacious OSD plugin ***" >&6; }
 
-elif test "x$pkg_failed" = "xuntried"; then
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 	have_aosd="no"
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: *** cairo >= 1.2.6 is required for Audacious OSD plugin ***" >&5
 $as_echo "*** cairo >= 1.2.6 is required for Audacious OSD plugin ***" >&6; }
 
 else
-	CAIRO_CFLAGS="$pkg_cv_CAIRO_CFLAGS"
-	CAIRO_LIBS="$pkg_cv_CAIRO_LIBS"
+	CAIRO_CFLAGS=$pkg_cv_CAIRO_CFLAGS
+	CAIRO_LIBS=$pkg_cv_CAIRO_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
-	:
+
 fi
-    pkg_failed=no
+
+pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for PANGOCAIRO" >&5
 $as_echo_n "checking for PANGOCAIRO... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"pangocairo >= 1.14.7\""; } >&5
+
+if test -n "$PANGOCAIRO_CFLAGS"; then
+    pkg_cv_PANGOCAIRO_CFLAGS="$PANGOCAIRO_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"pangocairo >= 1.14.7\""; } >&5
   ($PKG_CONFIG --exists --print-errors "pangocairo >= 1.14.7") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${PANGOCAIRO_CFLAGS}" != "x"; then
-            pkg_cv_PANGOCAIRO_CFLAGS="${PANGOCAIRO_CFLAGS}"
-        else
-            pkg_cv_PANGOCAIRO_CFLAGS=`$PKG_CONFIG --cflags "pangocairo >= 1.14.7" 2>/dev/null`
-        fi
-        if test "x${PANGOCAIRO_LIBS}" != "x"; then
-            pkg_cv_PANGOCAIRO_LIBS="${PANGOCAIRO_LIBS}"
-        else
-            pkg_cv_PANGOCAIRO_LIBS=`$PKG_CONFIG --libs "pangocairo >= 1.14.7" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_PANGOCAIRO_CFLAGS=`$PKG_CONFIG --cflags "pangocairo >= 1.14.7" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$PANGOCAIRO_LIBS"; then
+    pkg_cv_PANGOCAIRO_LIBS="$PANGOCAIRO_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"pangocairo >= 1.14.7\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "pangocairo >= 1.14.7") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_PANGOCAIRO_LIBS=`$PKG_CONFIG --libs "pangocairo >= 1.14.7" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
 fi
+ else
+    pkg_failed=untried
+fi
+
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        PANGOCAIRO_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "pangocairo >= 1.14.7" 2>&1`
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        PANGOCAIRO_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "pangocairo >= 1.14.7" 2>&1`
         else
-	        PANGOCAIRO_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "pangocairo >= 1.14.7" 2>&1`
+	        PANGOCAIRO_PKG_ERRORS=`$PKG_CONFIG --print-errors "pangocairo >= 1.14.7" 2>&1`
         fi
-		echo "$PANGOCAIRO_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-                have_aosd="no"
+	# Put the nasty error message in config.log where it belongs
+	echo "$PANGOCAIRO_PKG_ERRORS" >&5
+
+	have_aosd="no"
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: *** pangocairo >= 1.14.7 is required for Audacious OSD plugin ***" >&5
 $as_echo "*** pangocairo >= 1.14.7 is required for Audacious OSD plugin ***" >&6; }
 
-elif test "x$pkg_failed" = "xuntried"; then
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 	have_aosd="no"
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: *** pangocairo >= 1.14.7 is required for Audacious OSD plugin ***" >&5
 $as_echo "*** pangocairo >= 1.14.7 is required for Audacious OSD plugin ***" >&6; }
 
 else
-	PANGOCAIRO_CFLAGS="$pkg_cv_PANGOCAIRO_CFLAGS"
-	PANGOCAIRO_LIBS="$pkg_cv_PANGOCAIRO_LIBS"
+	PANGOCAIRO_CFLAGS=$pkg_cv_PANGOCAIRO_CFLAGS
+	PANGOCAIRO_LIBS=$pkg_cv_PANGOCAIRO_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
-	:
+
 fi
-    pkg_failed=no
+
+pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for XRENDER" >&5
 $as_echo_n "checking for XRENDER... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"xrender\""; } >&5
+
+if test -n "$XRENDER_CFLAGS"; then
+    pkg_cv_XRENDER_CFLAGS="$XRENDER_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"xrender\""; } >&5
   ($PKG_CONFIG --exists --print-errors "xrender") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${XRENDER_CFLAGS}" != "x"; then
-            pkg_cv_XRENDER_CFLAGS="${XRENDER_CFLAGS}"
-        else
-            pkg_cv_XRENDER_CFLAGS=`$PKG_CONFIG --cflags "xrender" 2>/dev/null`
-        fi
-        if test "x${XRENDER_LIBS}" != "x"; then
-            pkg_cv_XRENDER_LIBS="${XRENDER_LIBS}"
-        else
-            pkg_cv_XRENDER_LIBS=`$PKG_CONFIG --libs "xrender" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_XRENDER_CFLAGS=`$PKG_CONFIG --cflags "xrender" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$XRENDER_LIBS"; then
+    pkg_cv_XRENDER_LIBS="$XRENDER_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"xrender\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "xrender") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_XRENDER_LIBS=`$PKG_CONFIG --libs "xrender" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        XRENDER_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "xrender" 2>&1`
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        XRENDER_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "xrender" 2>&1`
         else
-	        XRENDER_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "xrender" 2>&1`
+	        XRENDER_PKG_ERRORS=`$PKG_CONFIG --print-errors "xrender" 2>&1`
         fi
-		echo "$XRENDER_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-                have_aosd="no"
+	# Put the nasty error message in config.log where it belongs
+	echo "$XRENDER_PKG_ERRORS" >&5
+
+	have_aosd="no"
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: *** X Render extension is required for Audacious OSD plugin ***" >&5
 $as_echo "*** X Render extension is required for Audacious OSD plugin ***" >&6; }
 
-elif test "x$pkg_failed" = "xuntried"; then
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 	have_aosd="no"
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: *** X Render extension is required for Audacious OSD plugin ***" >&5
 $as_echo "*** X Render extension is required for Audacious OSD plugin ***" >&6; }
 
 else
-	XRENDER_CFLAGS="$pkg_cv_XRENDER_CFLAGS"
-	XRENDER_LIBS="$pkg_cv_XRENDER_LIBS"
+	XRENDER_CFLAGS=$pkg_cv_XRENDER_CFLAGS
+	XRENDER_LIBS=$pkg_cv_XRENDER_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
-	:
+
 fi
     if test "x$enable_aosd_xcomp" = "xyes"; then
         have_aosd_xcomp="yes"
-        pkg_failed=no
+
+pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for XCOMPOSITE" >&5
 $as_echo_n "checking for XCOMPOSITE... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"xcomposite\""; } >&5
+
+if test -n "$XCOMPOSITE_CFLAGS"; then
+    pkg_cv_XCOMPOSITE_CFLAGS="$XCOMPOSITE_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"xcomposite\""; } >&5
   ($PKG_CONFIG --exists --print-errors "xcomposite") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${XCOMPOSITE_CFLAGS}" != "x"; then
-            pkg_cv_XCOMPOSITE_CFLAGS="${XCOMPOSITE_CFLAGS}"
-        else
-            pkg_cv_XCOMPOSITE_CFLAGS=`$PKG_CONFIG --cflags "xcomposite" 2>/dev/null`
-        fi
-        if test "x${XCOMPOSITE_LIBS}" != "x"; then
-            pkg_cv_XCOMPOSITE_LIBS="${XCOMPOSITE_LIBS}"
-        else
-            pkg_cv_XCOMPOSITE_LIBS=`$PKG_CONFIG --libs "xcomposite" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_XCOMPOSITE_CFLAGS=`$PKG_CONFIG --cflags "xcomposite" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$XCOMPOSITE_LIBS"; then
+    pkg_cv_XCOMPOSITE_LIBS="$XCOMPOSITE_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"xcomposite\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "xcomposite") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_XCOMPOSITE_LIBS=`$PKG_CONFIG --libs "xcomposite" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
 fi
+ else
+    pkg_failed=untried
+fi
+
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        XCOMPOSITE_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "xcomposite" 2>&1`
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        XCOMPOSITE_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "xcomposite" 2>&1`
         else
-	        XCOMPOSITE_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "xcomposite" 2>&1`
+	        XCOMPOSITE_PKG_ERRORS=`$PKG_CONFIG --print-errors "xcomposite" 2>&1`
         fi
-		echo "$XCOMPOSITE_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-                have_aosd_xcomp="no"
+	# Put the nasty error message in config.log where it belongs
+	echo "$XCOMPOSITE_PKG_ERRORS" >&5
+
+	have_aosd_xcomp="no"
             { $as_echo "$as_me:${as_lineno-$LINENO}: result: *** X Composite extension not found, composite support for Audacious OSD will not be compiled ***" >&5
 $as_echo "*** X Composite extension not found, composite support for Audacious OSD will not be compiled ***" >&6; }
 
-elif test "x$pkg_failed" = "xuntried"; then
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 	have_aosd_xcomp="no"
             { $as_echo "$as_me:${as_lineno-$LINENO}: result: *** X Composite extension not found, composite support for Audacious OSD will not be compiled ***" >&5
 $as_echo "*** X Composite extension not found, composite support for Audacious OSD will not be compiled ***" >&6; }
 
 else
-	XCOMPOSITE_CFLAGS="$pkg_cv_XCOMPOSITE_CFLAGS"
-	XCOMPOSITE_LIBS="$pkg_cv_XCOMPOSITE_LIBS"
+	XCOMPOSITE_CFLAGS=$pkg_cv_XCOMPOSITE_CFLAGS
+	XCOMPOSITE_LIBS=$pkg_cv_XCOMPOSITE_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 
@@ -8674,54 +9353,77 @@
         have_aosd="yes"
         if test "x$enable_aosd_xcomp" = "xyes"; then
             have_aosd_xcomp="yes"
-            pkg_failed=no
+
+pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for XCOMPOSITE" >&5
 $as_echo_n "checking for XCOMPOSITE... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"xcomposite\""; } >&5
+
+if test -n "$XCOMPOSITE_CFLAGS"; then
+    pkg_cv_XCOMPOSITE_CFLAGS="$XCOMPOSITE_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"xcomposite\""; } >&5
   ($PKG_CONFIG --exists --print-errors "xcomposite") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${XCOMPOSITE_CFLAGS}" != "x"; then
-            pkg_cv_XCOMPOSITE_CFLAGS="${XCOMPOSITE_CFLAGS}"
-        else
-            pkg_cv_XCOMPOSITE_CFLAGS=`$PKG_CONFIG --cflags "xcomposite" 2>/dev/null`
-        fi
-        if test "x${XCOMPOSITE_LIBS}" != "x"; then
-            pkg_cv_XCOMPOSITE_LIBS="${XCOMPOSITE_LIBS}"
-        else
-            pkg_cv_XCOMPOSITE_LIBS=`$PKG_CONFIG --libs "xcomposite" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_XCOMPOSITE_CFLAGS=`$PKG_CONFIG --cflags "xcomposite" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$XCOMPOSITE_LIBS"; then
+    pkg_cv_XCOMPOSITE_LIBS="$XCOMPOSITE_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"xcomposite\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "xcomposite") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_XCOMPOSITE_LIBS=`$PKG_CONFIG --libs "xcomposite" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
 fi
+ else
+    pkg_failed=untried
+fi
+
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        XCOMPOSITE_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "xcomposite" 2>&1`
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        XCOMPOSITE_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "xcomposite" 2>&1`
         else
-	        XCOMPOSITE_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "xcomposite" 2>&1`
+	        XCOMPOSITE_PKG_ERRORS=`$PKG_CONFIG --print-errors "xcomposite" 2>&1`
         fi
-		echo "$XCOMPOSITE_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-                have_aosd_xcomp="no"
+	# Put the nasty error message in config.log where it belongs
+	echo "$XCOMPOSITE_PKG_ERRORS" >&5
+
+	have_aosd_xcomp="no"
                 { $as_echo "$as_me:${as_lineno-$LINENO}: result: *** X Composite extension not found, composite support for Audacious OSD will not be compiled ***" >&5
 $as_echo "*** X Composite extension not found, composite support for Audacious OSD will not be compiled ***" >&6; }
 
-elif test "x$pkg_failed" = "xuntried"; then
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 	have_aosd_xcomp="no"
                 { $as_echo "$as_me:${as_lineno-$LINENO}: result: *** X Composite extension not found, composite support for Audacious OSD will not be compiled ***" >&5
 $as_echo "*** X Composite extension not found, composite support for Audacious OSD will not be compiled ***" >&6; }
 
 else
-	XCOMPOSITE_CFLAGS="$pkg_cv_XCOMPOSITE_CFLAGS"
-	XCOMPOSITE_LIBS="$pkg_cv_XCOMPOSITE_LIBS"
+	XCOMPOSITE_CFLAGS=$pkg_cv_XCOMPOSITE_CFLAGS
+	XCOMPOSITE_LIBS=$pkg_cv_XCOMPOSITE_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 
@@ -8755,48 +9457,71 @@
 
 
 if test "x$enable_notify" = "xyes"; then
-    pkg_failed=no
+
+pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for NOTIFY" >&5
 $as_echo_n "checking for NOTIFY... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libnotify\""; } >&5
+
+if test -n "$NOTIFY_CFLAGS"; then
+    pkg_cv_NOTIFY_CFLAGS="$NOTIFY_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libnotify\""; } >&5
   ($PKG_CONFIG --exists --print-errors "libnotify") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${NOTIFY_CFLAGS}" != "x"; then
-            pkg_cv_NOTIFY_CFLAGS="${NOTIFY_CFLAGS}"
-        else
-            pkg_cv_NOTIFY_CFLAGS=`$PKG_CONFIG --cflags "libnotify" 2>/dev/null`
-        fi
-        if test "x${NOTIFY_LIBS}" != "x"; then
-            pkg_cv_NOTIFY_LIBS="${NOTIFY_LIBS}"
-        else
-            pkg_cv_NOTIFY_LIBS=`$PKG_CONFIG --libs "libnotify" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_NOTIFY_CFLAGS=`$PKG_CONFIG --cflags "libnotify" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$NOTIFY_LIBS"; then
+    pkg_cv_NOTIFY_LIBS="$NOTIFY_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libnotify\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "libnotify") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_NOTIFY_LIBS=`$PKG_CONFIG --libs "libnotify" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
 fi
+ else
+    pkg_failed=untried
+fi
+
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        NOTIFY_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "libnotify" 2>&1`
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        NOTIFY_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "libnotify" 2>&1`
         else
-	        NOTIFY_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "libnotify" 2>&1`
+	        NOTIFY_PKG_ERRORS=`$PKG_CONFIG --print-errors "libnotify" 2>&1`
         fi
-		echo "$NOTIFY_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+	# Put the nasty error message in config.log where it belongs
+	echo "$NOTIFY_PKG_ERRORS" >&5
+
+	have_notify="no"
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-                have_notify="no"
-elif test "x$pkg_failed" = "xuntried"; then
 	have_notify="no"
 else
-	NOTIFY_CFLAGS="$pkg_cv_NOTIFY_CFLAGS"
-	NOTIFY_LIBS="$pkg_cv_NOTIFY_LIBS"
+	NOTIFY_CFLAGS=$pkg_cv_NOTIFY_CFLAGS
+	NOTIFY_LIBS=$pkg_cv_NOTIFY_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 	have_notify="yes"
@@ -8822,51 +9547,74 @@
 
 if test "x$enable_adplug" = "xyes"; then
     have_adplug="yes"
-    pkg_failed=no
+
+pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for BINIO" >&5
 $as_echo_n "checking for BINIO... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libbinio >= 1.4\""; } >&5
+
+if test -n "$BINIO_CFLAGS"; then
+    pkg_cv_BINIO_CFLAGS="$BINIO_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libbinio >= 1.4\""; } >&5
   ($PKG_CONFIG --exists --print-errors "libbinio >= 1.4") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${BINIO_CFLAGS}" != "x"; then
-            pkg_cv_BINIO_CFLAGS="${BINIO_CFLAGS}"
-        else
-            pkg_cv_BINIO_CFLAGS=`$PKG_CONFIG --cflags "libbinio >= 1.4" 2>/dev/null`
-        fi
-        if test "x${BINIO_LIBS}" != "x"; then
-            pkg_cv_BINIO_LIBS="${BINIO_LIBS}"
-        else
-            pkg_cv_BINIO_LIBS=`$PKG_CONFIG --libs "libbinio >= 1.4" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_BINIO_CFLAGS=`$PKG_CONFIG --cflags "libbinio >= 1.4" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$BINIO_LIBS"; then
+    pkg_cv_BINIO_LIBS="$BINIO_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libbinio >= 1.4\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "libbinio >= 1.4") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_BINIO_LIBS=`$PKG_CONFIG --libs "libbinio >= 1.4" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
 fi
+ else
+    pkg_failed=untried
+fi
+
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        BINIO_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "libbinio >= 1.4" 2>&1`
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        BINIO_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "libbinio >= 1.4" 2>&1`
         else
-	        BINIO_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "libbinio >= 1.4" 2>&1`
+	        BINIO_PKG_ERRORS=`$PKG_CONFIG --print-errors "libbinio >= 1.4" 2>&1`
         fi
-		echo "$BINIO_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+	# Put the nasty error message in config.log where it belongs
+	echo "$BINIO_PKG_ERRORS" >&5
+
+	have_adplug=no
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-                have_adplug=no
-elif test "x$pkg_failed" = "xuntried"; then
 	have_adplug=no
 else
-	BINIO_CFLAGS="$pkg_cv_BINIO_CFLAGS"
-	BINIO_LIBS="$pkg_cv_BINIO_LIBS"
+	BINIO_CFLAGS=$pkg_cv_BINIO_CFLAGS
+	BINIO_LIBS=$pkg_cv_BINIO_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
-	:
+
 fi
 else
     { $as_echo "$as_me:${as_lineno-$LINENO}: result: *** AdPlug plugin disabled per user request ***" >&5
@@ -8890,54 +9638,77 @@
 
 
 if test "x$enable_vorbis" = "xyes"; then
-    pkg_failed=no
+
+pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for OGG_VORBIS" >&5
 $as_echo_n "checking for OGG_VORBIS... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"ogg >= 1.0 vorbis >= 1.1 vorbisfile >= 1.1\""; } >&5
+
+if test -n "$OGG_VORBIS_CFLAGS"; then
+    pkg_cv_OGG_VORBIS_CFLAGS="$OGG_VORBIS_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"ogg >= 1.0 vorbis >= 1.1 vorbisfile >= 1.1\""; } >&5
   ($PKG_CONFIG --exists --print-errors "ogg >= 1.0 vorbis >= 1.1 vorbisfile >= 1.1") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${OGG_VORBIS_CFLAGS}" != "x"; then
-            pkg_cv_OGG_VORBIS_CFLAGS="${OGG_VORBIS_CFLAGS}"
-        else
-            pkg_cv_OGG_VORBIS_CFLAGS=`$PKG_CONFIG --cflags "ogg >= 1.0 vorbis >= 1.1 vorbisfile >= 1.1" 2>/dev/null`
-        fi
-        if test "x${OGG_VORBIS_LIBS}" != "x"; then
-            pkg_cv_OGG_VORBIS_LIBS="${OGG_VORBIS_LIBS}"
-        else
-            pkg_cv_OGG_VORBIS_LIBS=`$PKG_CONFIG --libs "ogg >= 1.0 vorbis >= 1.1 vorbisfile >= 1.1" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_OGG_VORBIS_CFLAGS=`$PKG_CONFIG --cflags "ogg >= 1.0 vorbis >= 1.1 vorbisfile >= 1.1" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$OGG_VORBIS_LIBS"; then
+    pkg_cv_OGG_VORBIS_LIBS="$OGG_VORBIS_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"ogg >= 1.0 vorbis >= 1.1 vorbisfile >= 1.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "ogg >= 1.0 vorbis >= 1.1 vorbisfile >= 1.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_OGG_VORBIS_LIBS=`$PKG_CONFIG --libs "ogg >= 1.0 vorbis >= 1.1 vorbisfile >= 1.1" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        OGG_VORBIS_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "ogg >= 1.0 vorbis >= 1.1 vorbisfile >= 1.1" 2>&1`
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        OGG_VORBIS_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "ogg >= 1.0 vorbis >= 1.1 vorbisfile >= 1.1" 2>&1`
         else
-	        OGG_VORBIS_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "ogg >= 1.0 vorbis >= 1.1 vorbisfile >= 1.1" 2>&1`
+	        OGG_VORBIS_PKG_ERRORS=`$PKG_CONFIG --print-errors "ogg >= 1.0 vorbis >= 1.1 vorbisfile >= 1.1" 2>&1`
         fi
-		echo "$OGG_VORBIS_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-                { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: *** Cannot find libogg/libvorbis, Ogg Vorbis support will not be built ***" >&5
+	# Put the nasty error message in config.log where it belongs
+	echo "$OGG_VORBIS_PKG_ERRORS" >&5
+
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: *** Cannot find libogg/libvorbis, Ogg Vorbis support will not be built ***" >&5
 $as_echo "$as_me: WARNING: *** Cannot find libogg/libvorbis, Ogg Vorbis support will not be built ***" >&2;}
          have_oggvorbis=no
 
-elif test "x$pkg_failed" = "xuntried"; then
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 	{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: *** Cannot find libogg/libvorbis, Ogg Vorbis support will not be built ***" >&5
 $as_echo "$as_me: WARNING: *** Cannot find libogg/libvorbis, Ogg Vorbis support will not be built ***" >&2;}
          have_oggvorbis=no
 
 else
-	OGG_VORBIS_CFLAGS="$pkg_cv_OGG_VORBIS_CFLAGS"
-	OGG_VORBIS_LIBS="$pkg_cv_OGG_VORBIS_LIBS"
+	OGG_VORBIS_CFLAGS=$pkg_cv_OGG_VORBIS_CFLAGS
+	OGG_VORBIS_LIBS=$pkg_cv_OGG_VORBIS_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 	have_oggvorbis=yes
@@ -8997,24 +9768,28 @@
 
   if test "x$libFLAC_libraries" != "x" ; then
     LIBFLAC_LIBS="-L$libFLAC_libraries"
+  elif test "x$libFLAC_prefix" = "xno" || test "x$libFLAC_prefix" = "xyes" ; then
+    LIBFLAC_LIBS=""
   elif test "x$libFLAC_prefix" != "x" ; then
     LIBFLAC_LIBS="-L$libFLAC_prefix/lib"
-  elif test "x$prefix" != "xNONE" ; then
-    LIBFLAC_LIBS="-L$libdir"
+  elif test "x$prefix" != "xNONE"; then
+    LIBFLAC_LIBS="-L$prefix/lib"
   fi
 
-  LIBFLAC_LIBS="$LIBFLAC_LIBS -lFLAC -lm"
+  if test "x$libFLAC_prefix" != "xno" ; then
+    LIBFLAC_LIBS="$LIBFLAC_LIBS -lFLAC $OGG_LIBS -lm"
+  fi
 
   if test "x$libFLAC_includes" != "x" ; then
     LIBFLAC_CFLAGS="-I$libFLAC_includes"
   elif test "x$libFLAC_prefix" != "x" ; then
     LIBFLAC_CFLAGS="-I$libFLAC_prefix/include"
-  elif test "x$prefix" != "xNONE"; then
-    LIBFLAC_CFLAGS="-I$prefix/include"
+  elif test "$prefix" != "xNONE"; then
+    LIBFLAC_CFLAGS=""
   fi
 
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for libFLAC >= 1.1.2" >&5
-$as_echo_n "checking for libFLAC >= 1.1.2... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for libFLAC" >&5
+$as_echo_n "checking for libFLAC... " >&6; }
   no_libFLAC=""
 
 
@@ -9022,9 +9797,11 @@
     ac_save_CFLAGS="$CFLAGS"
     ac_save_CXXFLAGS="$CXXFLAGS"
     ac_save_LIBS="$LIBS"
+    ac_save_LD_LIBRARY_PATH="$LD_LIBRARY_PATH"
     CFLAGS="$CFLAGS $LIBFLAC_CFLAGS"
     CXXFLAGS="$CXXFLAGS $LIBFLAC_CFLAGS"
     LIBS="$LIBS $LIBFLAC_LIBS"
+    LD_LIBRARY_PATH="$LIBFLAC_LIBDIR:$LD_LIBRARY_PATH"
       rm -f conf.libFLACtest
       if test "$cross_compiling" = yes; then :
   echo $ac_n "cross compiling; assumed OK... $ac_c"
@@ -9035,11 +9812,10 @@
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
-#include <FLAC/all.h>
+#include <FLAC/format.h>
 
 int main ()
 {
-FLAC__format_vorbiscomment_entry_name_is_legal("foo");
   system("touch conf.libFLACtest");
   return 0;
 }
@@ -9056,7 +9832,9 @@
 fi
 
        CFLAGS="$ac_save_CFLAGS"
+       CXXFLAGS="$ac_save_CXXFLAGS"
        LIBS="$ac_save_LIBS"
+       LD_LIBRARY_PATH="$ac_save_LD_LIBRARY_PATH"
   fi
 
   if test "x$no_libFLAC" = "x" ; then
@@ -9071,7 +9849,9 @@
      else
        echo "*** Could not run libFLAC test program, checking why..."
        CFLAGS="$CFLAGS $LIBFLAC_CFLAGS"
+       CXXFLAGS="$CXXFLAGS $LIBFLAC_CFLAGS"
        LIBS="$LIBS $LIBFLAC_LIBS"
+       LD_LIBRARY_PATH="$LIBFLAC_LIBDIR:$LD_LIBRARY_PATH"
        cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
@@ -9105,9 +9885,12 @@
 rm -f core conftest.err conftest.$ac_objext \
     conftest$ac_exeext conftest.$ac_ext
        CFLAGS="$ac_save_CFLAGS"
+       CXXFLAGS="$ac_save_CXXFLAGS"
        LIBS="$ac_save_LIBS"
+       LD_LIBRARY_PATH="$ac_save_LD_LIBRARY_PATH"
      fi
      LIBFLAC_CFLAGS=""
+     LIBFLAC_LIBDIR=""
      LIBFLAC_LIBS=""
      { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: *** Cannot find libFLAC, FLACng will not be built ***" >&5
 $as_echo "$as_me: WARNING: *** Cannot find libFLAC, FLACng will not be built ***" >&2;}
@@ -9116,6 +9899,7 @@
   fi
 
 
+
   rm -f conf.libFLACtest
 
 else
@@ -9139,54 +9923,77 @@
 
 
 if test "x$enable_wavpack" = "xyes"; then
-    pkg_failed=no
+
+pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for WAVPACK" >&5
 $as_echo_n "checking for WAVPACK... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"wavpack >= 4.31\""; } >&5
+
+if test -n "$WAVPACK_CFLAGS"; then
+    pkg_cv_WAVPACK_CFLAGS="$WAVPACK_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"wavpack >= 4.31\""; } >&5
   ($PKG_CONFIG --exists --print-errors "wavpack >= 4.31") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${WAVPACK_CFLAGS}" != "x"; then
-            pkg_cv_WAVPACK_CFLAGS="${WAVPACK_CFLAGS}"
-        else
-            pkg_cv_WAVPACK_CFLAGS=`$PKG_CONFIG --cflags "wavpack >= 4.31" 2>/dev/null`
-        fi
-        if test "x${WAVPACK_LIBS}" != "x"; then
-            pkg_cv_WAVPACK_LIBS="${WAVPACK_LIBS}"
-        else
-            pkg_cv_WAVPACK_LIBS=`$PKG_CONFIG --libs "wavpack >= 4.31" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_WAVPACK_CFLAGS=`$PKG_CONFIG --cflags "wavpack >= 4.31" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$WAVPACK_LIBS"; then
+    pkg_cv_WAVPACK_LIBS="$WAVPACK_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"wavpack >= 4.31\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "wavpack >= 4.31") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_WAVPACK_LIBS=`$PKG_CONFIG --libs "wavpack >= 4.31" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        WAVPACK_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "wavpack >= 4.31" 2>&1`
-        else
-	        WAVPACK_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "wavpack >= 4.31" 2>&1`
-        fi
-		echo "$WAVPACK_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-                { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: *** Cannot find WavPack 4.31+, WavPack support will not be built ***" >&5
-$as_echo "$as_me: WARNING: *** Cannot find WavPack 4.31+, WavPack support will not be built ***" >&2;}
-         have_wavpack=no
 
-elif test "x$pkg_failed" = "xuntried"; then
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: *** Cannot find WavPack 4.31+, WavPack support will not be built ***" >&5
-$as_echo "$as_me: WARNING: *** Cannot find WavPack 4.31+, WavPack support will not be built ***" >&2;}
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        WAVPACK_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "wavpack >= 4.31" 2>&1`
+        else
+	        WAVPACK_PKG_ERRORS=`$PKG_CONFIG --print-errors "wavpack >= 4.31" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$WAVPACK_PKG_ERRORS" >&5
+
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: *** Cannot find WavPack 4.31+, WavPack support will not be built ***" >&5
+$as_echo "$as_me: WARNING: *** Cannot find WavPack 4.31+, WavPack support will not be built ***" >&2;}
+         have_wavpack=no
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: *** Cannot find WavPack 4.31+, WavPack support will not be built ***" >&5
+$as_echo "$as_me: WARNING: *** Cannot find WavPack 4.31+, WavPack support will not be built ***" >&2;}
          have_wavpack=no
 
 else
-	WAVPACK_CFLAGS="$pkg_cv_WAVPACK_CFLAGS"
-	WAVPACK_LIBS="$pkg_cv_WAVPACK_LIBS"
+	WAVPACK_CFLAGS=$pkg_cv_WAVPACK_CFLAGS
+	WAVPACK_LIBS=$pkg_cv_WAVPACK_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 	have_wavpack=yes
@@ -9306,1570 +10113,223 @@
 
 
 if test "x$enable_sndfile" = "xyes"; then
-    pkg_failed=no
+
+pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for SNDFILE" >&5
 $as_echo_n "checking for SNDFILE... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"sndfile >= 0.19\""; } >&5
+
+if test -n "$SNDFILE_CFLAGS"; then
+    pkg_cv_SNDFILE_CFLAGS="$SNDFILE_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"sndfile >= 0.19\""; } >&5
   ($PKG_CONFIG --exists --print-errors "sndfile >= 0.19") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${SNDFILE_CFLAGS}" != "x"; then
-            pkg_cv_SNDFILE_CFLAGS="${SNDFILE_CFLAGS}"
-        else
-            pkg_cv_SNDFILE_CFLAGS=`$PKG_CONFIG --cflags "sndfile >= 0.19" 2>/dev/null`
-        fi
-        if test "x${SNDFILE_LIBS}" != "x"; then
-            pkg_cv_SNDFILE_LIBS="${SNDFILE_LIBS}"
-        else
-            pkg_cv_SNDFILE_LIBS=`$PKG_CONFIG --libs "sndfile >= 0.19" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
-else
-	pkg_failed="untried"
-fi
-
-
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        SNDFILE_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "sndfile >= 0.19" 2>&1`
-        else
-	        SNDFILE_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "sndfile >= 0.19" 2>&1`
-        fi
-		echo "$SNDFILE_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-                enable_sndfile=no
-
-elif test "x$pkg_failed" = "xuntried"; then
-	enable_sndfile=no
-
-else
-	SNDFILE_CFLAGS="$pkg_cv_SNDFILE_CFLAGS"
-	SNDFILE_LIBS="$pkg_cv_SNDFILE_LIBS"
-        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
-$as_echo "yes" >&6; }
-	enable_sndfile=yes
-fi
-else
-    { $as_echo "$as_me:${as_lineno-$LINENO}: result: *** libsndfile extensions disabled per user request ***" >&5
-$as_echo "*** libsndfile extensions disabled per user request ***" >&6; }
-    enable_sndfile=no
-fi
-
-if test "x$enable_sndfile" = "xyes"; then
-	INPUT_PLUGINS="$INPUT_PLUGINS sndfile"
-fi
-
-
-# Check whether --enable-modplug was given.
-if test "${enable_modplug+set}" = set; then :
-  enableval=$enable_modplug; enable_modplug=$enableval
-else
-  enable_modplug="yes"
-
-fi
-
-
-if test "x$enable_modplug" = "xyes"; then
-    INPUT_PLUGINS="$INPUT_PLUGINS modplug"
-    have_modplug="yes"
+  pkg_cv_SNDFILE_CFLAGS=`$PKG_CONFIG --cflags "sndfile >= 0.19" 2>/dev/null`
 else
-    { $as_echo "$as_me:${as_lineno-$LINENO}: result: *** ModPlug plugin disabled per user request ***" >&5
-$as_echo "*** ModPlug plugin disabled per user request ***" >&6; }
-    have_modplug="no"
+  pkg_failed=yes
 fi
-
-
-have_ffaudio="no"
-# Check whether --enable-ffaudio was given.
-if test "${enable_ffaudio+set}" = set; then :
-  enableval=$enable_ffaudio; enable_ffaudio=$enableval
-else
-  enable_ffaudio="yes"
-
+ else
+    pkg_failed=untried
 fi
-
-
-if test "x$enable_ffaudio" = "xyes"; then
-    pkg_failed=no
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for FFMPEG" >&5
-$as_echo_n "checking for FFMPEG... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libavformat >= 52.31.0  libavcodec >= 52.20.0  libavutil >= 49.15.0\""; } >&5
-  ($PKG_CONFIG --exists --print-errors "libavformat >= 52.31.0  libavcodec >= 52.20.0  libavutil >= 49.15.0") 2>&5
+if test -n "$SNDFILE_LIBS"; then
+    pkg_cv_SNDFILE_LIBS="$SNDFILE_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"sndfile >= 0.19\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "sndfile >= 0.19") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${FFMPEG_CFLAGS}" != "x"; then
-            pkg_cv_FFMPEG_CFLAGS="${FFMPEG_CFLAGS}"
-        else
-            pkg_cv_FFMPEG_CFLAGS=`$PKG_CONFIG --cflags "libavformat >= 52.31.0  libavcodec >= 52.20.0  libavutil >= 49.15.0" 2>/dev/null`
-        fi
-        if test "x${FFMPEG_LIBS}" != "x"; then
-            pkg_cv_FFMPEG_LIBS="${FFMPEG_LIBS}"
-        else
-            pkg_cv_FFMPEG_LIBS=`$PKG_CONFIG --libs "libavformat >= 52.31.0  libavcodec >= 52.20.0  libavutil >= 49.15.0" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
-else
-	pkg_failed="untried"
-fi
-
-
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        FFMPEG_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "libavformat >= 52.31.0  libavcodec >= 52.20.0  libavutil >= 49.15.0" 2>&1`
-        else
-	        FFMPEG_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "libavformat >= 52.31.0  libavcodec >= 52.20.0  libavutil >= 49.15.0" 2>&1`
-        fi
-		echo "$FFMPEG_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-                have_ffaudio="no"
-elif test "x$pkg_failed" = "xuntried"; then
-	have_ffaudio="no"
+  pkg_cv_SNDFILE_LIBS=`$PKG_CONFIG --libs "sndfile >= 0.19" 2>/dev/null`
 else
-	FFMPEG_CFLAGS="$pkg_cv_FFMPEG_CFLAGS"
-	FFMPEG_LIBS="$pkg_cv_FFMPEG_LIBS"
-        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
-$as_echo "yes" >&6; }
-	have_ffaudio="yes"
-fi
+  pkg_failed=yes
 fi
-
-if test "x$have_ffaudio" = "xyes"; then
-    INPUT_PLUGINS="$INPUT_PLUGINS ffaudio"
-fi
-
-# Check whether --enable-jack was given.
-if test "${enable_jack+set}" = set; then :
-  enableval=$enable_jack; enable_jack=$enableval
-else
-  enable_jack="yes"
+ else
+    pkg_failed=untried
 fi
 
 
-if test "x$enable_jack" = "xyes"; then
-        pkg_failed=no
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for JACK" >&5
-$as_echo_n "checking for JACK... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"jack >= 0.100.0\""; } >&5
-  ($PKG_CONFIG --exists --print-errors "jack >= 0.100.0") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
-  test $ac_status = 0; }; then
-        if test "x${JACK_CFLAGS}" != "x"; then
-            pkg_cv_JACK_CFLAGS="${JACK_CFLAGS}"
-        else
-            pkg_cv_JACK_CFLAGS=`$PKG_CONFIG --cflags "jack >= 0.100.0" 2>/dev/null`
-        fi
-        if test "x${JACK_LIBS}" != "x"; then
-            pkg_cv_JACK_LIBS="${JACK_LIBS}"
-        else
-            pkg_cv_JACK_LIBS=`$PKG_CONFIG --libs "jack >= 0.100.0" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
-else
-	pkg_failed="untried"
-fi
-
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        JACK_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "jack >= 0.100.0" 2>&1`
-        else
-	        JACK_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "jack >= 0.100.0" 2>&1`
-        fi
-		echo "$JACK_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-                have_jack=no
-elif test "x$pkg_failed" = "xuntried"; then
-	have_jack=no
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-	JACK_CFLAGS="$pkg_cv_JACK_CFLAGS"
-	JACK_LIBS="$pkg_cv_JACK_LIBS"
-        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
-$as_echo "yes" >&6; }
-	have_jack=yes
+        _pkg_short_errors_supported=no
 fi
-
-pkg_failed=no
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for SAMPLERATE" >&5
-$as_echo_n "checking for SAMPLERATE... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"samplerate >= 0.0.15\""; } >&5
-  ($PKG_CONFIG --exists --print-errors "samplerate >= 0.0.15") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
-  test $ac_status = 0; }; then
-        if test "x${SAMPLERATE_CFLAGS}" != "x"; then
-            pkg_cv_SAMPLERATE_CFLAGS="${SAMPLERATE_CFLAGS}"
-        else
-            pkg_cv_SAMPLERATE_CFLAGS=`$PKG_CONFIG --cflags "samplerate >= 0.0.15" 2>/dev/null`
-        fi
-        if test "x${SAMPLERATE_LIBS}" != "x"; then
-            pkg_cv_SAMPLERATE_LIBS="${SAMPLERATE_LIBS}"
+        if test $_pkg_short_errors_supported = yes; then
+	        SNDFILE_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "sndfile >= 0.19" 2>&1`
         else
-            pkg_cv_SAMPLERATE_LIBS=`$PKG_CONFIG --libs "samplerate >= 0.0.15" 2>/dev/null`
+	        SNDFILE_PKG_ERRORS=`$PKG_CONFIG --print-errors "sndfile >= 0.19" 2>&1`
         fi
-    else
-        pkg_failed="yes"
-    fi
-else
-	pkg_failed="untried"
-fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$SNDFILE_PKG_ERRORS" >&5
 
+	enable_sndfile=no
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        SAMPLERATE_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "samplerate >= 0.0.15" 2>&1`
-        else
-	        SAMPLERATE_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "samplerate >= 0.0.15" 2>&1`
-        fi
-		echo "$SAMPLERATE_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-                ac_cv_samplerate=0
-elif test "x$pkg_failed" = "xuntried"; then
-	ac_cv_samplerate=0
+	enable_sndfile=no
+
 else
-	SAMPLERATE_CFLAGS="$pkg_cv_SAMPLERATE_CFLAGS"
-	SAMPLERATE_LIBS="$pkg_cv_SAMPLERATE_LIBS"
+	SNDFILE_CFLAGS=$pkg_cv_SNDFILE_CFLAGS
+	SNDFILE_LIBS=$pkg_cv_SNDFILE_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
-	ac_cv_samplerate=1
-fi
-
-
-cat >>confdefs.h <<_ACEOF
-#define HAVE_SAMPLERATE ${ac_cv_samplerate}
-_ACEOF
-
-
-if test "x${ac_cv_samplerate}" = "x0"; then
-    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: Could not find libsamplerate, necessary for jack output plugin." >&5
-$as_echo "$as_me: WARNING: Could not find libsamplerate, necessary for jack output plugin." >&2;}
-    have_jack=no
-fi
-
-
-if test "x$have_jack" = "xno"; then
-  have_jack=no
-else
-  have_jack=yes
-fi
-
-
-else
-        { $as_echo "$as_me:${as_lineno-$LINENO}: result: *** jack plugin disabled per user request ***" >&5
-$as_echo "*** jack plugin disabled per user request ***" >&6; }
-        have_jack=no
-fi
-
-if test "x$have_jack" = "xyes"; then
-	OUTPUT_PLUGINS="$OUTPUT_PLUGINS jack"
-fi
-
-# Check whether --enable-sid was given.
-if test "${enable_sid+set}" = set; then :
-  enableval=$enable_sid;
-else
-  enable_sid="yes"
-fi
-
-
-if test "x$enable_sid" = "xyes"; then
-
-
-    # Extract the first word of "pkg-config", so it can be a program name with args.
-set dummy pkg-config; ac_word=$2
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if test "${ac_cv_path_PKG_CONFIG+set}" = set; then :
-  $as_echo_n "(cached) " >&6
-else
-  case $PKG_CONFIG in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_PKG_CONFIG="$PKG_CONFIG" # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-    for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
-    ac_cv_path_PKG_CONFIG="$as_dir/$ac_word$ac_exec_ext"
-    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-  done
-IFS=$as_save_IFS
-
-  ;;
-esac
-fi
-PKG_CONFIG=$ac_cv_path_PKG_CONFIG
-if test -n "$PKG_CONFIG"; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $PKG_CONFIG" >&5
-$as_echo "$PKG_CONFIG" >&6; }
-else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
+	enable_sndfile=yes
 fi
-
-
-ac_ext=cpp
-ac_cpp='$CXXCPP $CPPFLAGS'
-ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking how to run the C++ preprocessor" >&5
-$as_echo_n "checking how to run the C++ preprocessor... " >&6; }
-if test -z "$CXXCPP"; then
-  if test "${ac_cv_prog_CXXCPP+set}" = set; then :
-  $as_echo_n "(cached) " >&6
-else
-      # Double quotes because CXXCPP needs to be expanded
-    for CXXCPP in "$CXX -E" "/lib/cpp"
-    do
-      ac_preproc_ok=false
-for ac_cxx_preproc_warn_flag in '' yes
-do
-  # Use a header file that comes with gcc, so configuring glibc
-  # with a fresh cross-compiler works.
-  # Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
-  # <limits.h> exists even on freestanding compilers.
-  # On the NeXT, cc -E runs the code through the compiler's parser,
-  # not just through cpp. "Syntax error" is here to catch this case.
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#ifdef __STDC__
-# include <limits.h>
-#else
-# include <assert.h>
-#endif
-		     Syntax error
-_ACEOF
-if ac_fn_cxx_try_cpp "$LINENO"; then :
-
 else
-  # Broken: fails on valid input.
-continue
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: *** libsndfile extensions disabled per user request ***" >&5
+$as_echo "*** libsndfile extensions disabled per user request ***" >&6; }
+    enable_sndfile=no
 fi
-rm -f conftest.err conftest.$ac_ext
-
-  # OK, works on sane cases.  Now check whether nonexistent headers
-  # can be detected and how.
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#include <ac_nonexistent.h>
-_ACEOF
-if ac_fn_cxx_try_cpp "$LINENO"; then :
-  # Broken: success on invalid input.
-continue
-else
-  # Passes both tests.
-ac_preproc_ok=:
-break
-fi
-rm -f conftest.err conftest.$ac_ext
-
-done
-# Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
-rm -f conftest.err conftest.$ac_ext
-if $ac_preproc_ok; then :
-  break
-fi
-
-    done
-    ac_cv_prog_CXXCPP=$CXXCPP
-
-fi
-  CXXCPP=$ac_cv_prog_CXXCPP
-else
-  ac_cv_prog_CXXCPP=$CXXCPP
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $CXXCPP" >&5
-$as_echo "$CXXCPP" >&6; }
-ac_preproc_ok=false
-for ac_cxx_preproc_warn_flag in '' yes
-do
-  # Use a header file that comes with gcc, so configuring glibc
-  # with a fresh cross-compiler works.
-  # Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
-  # <limits.h> exists even on freestanding compilers.
-  # On the NeXT, cc -E runs the code through the compiler's parser,
-  # not just through cpp. "Syntax error" is here to catch this case.
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#ifdef __STDC__
-# include <limits.h>
-#else
-# include <assert.h>
-#endif
-		     Syntax error
-_ACEOF
-if ac_fn_cxx_try_cpp "$LINENO"; then :
-
-else
-  # Broken: fails on valid input.
-continue
-fi
-rm -f conftest.err conftest.$ac_ext
-
-  # OK, works on sane cases.  Now check whether nonexistent headers
-  # can be detected and how.
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#include <ac_nonexistent.h>
-_ACEOF
-if ac_fn_cxx_try_cpp "$LINENO"; then :
-  # Broken: success on invalid input.
-continue
-else
-  # Passes both tests.
-ac_preproc_ok=:
-break
-fi
-rm -f conftest.err conftest.$ac_ext
-
-done
-# Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
-rm -f conftest.err conftest.$ac_ext
-if $ac_preproc_ok; then :
-
-else
-  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-as_fn_error "C++ preprocessor \"$CXXCPP\" fails sanity check
-See \`config.log' for more details." "$LINENO" 5; }
-fi
-
-ac_ext=cpp
-ac_cpp='$CXXCPP $CPPFLAGS'
-ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
-
-
-
-# xs_arg_with ( sidplay1:libSIDPlay1:XS_PATH_LIBSIDPLAY1 )
-
-# Check whether --with-sidplay1 was given.
-if test "${with_sidplay1+set}" = set; then :
-  withval=$with_sidplay1;         if test "x$withval" = "xyes"; then
-            xs_use_sidplay1="yes"
-            xs_sidplay1_library=""
-            xs_sidplay1_includes=""
-        else
-            if test "x$withval" = "xno"; then
-                xs_use_sidplay1="no"
-            else
-                xs_use_sidplay1="yes"
-                xs_sidplay1_includes="$withval/include"
-                xs_sidplay1_library="$withval/lib"
-            fi
-        fi
-
-else
-          xs_use_sidplay1="try"
-        xs_sidplay1_library=""
-        xs_sidplay1_includes=""
-
-fi
-
-# Check whether --with-sidplay1-inc was given.
-if test "${with_sidplay1_inc+set}" = set; then :
-  withval=$with_sidplay1_inc; xs_sidplay1_includes="$withval"
-fi
-
-# Check whether --with-sidplay1-lib was given.
-if test "${with_sidplay1_lib+set}" = set; then :
-  withval=$with_sidplay1_lib; xs_sidplay1_library="$withval"
-fi
-
-        xs_have_sidplay1="no"
-    if test "x$xs_use_sidplay1" = "xtry"; then
-
-    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for working SIDPlay1 library and headers" >&5
-$as_echo_n "checking for working SIDPlay1 library and headers... " >&6; }
-
-    ac_ext=cpp
-ac_cpp='$CXXCPP $CPPFLAGS'
-ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
-
-
-        if test "x$xs_sidplay1_includes" != "x"; then
-        xs_sidplay1_cxxflags="-I$xs_sidplay1_includes"
-    else
-        xs_sidplay1_cxxflags=""
-    fi
-
-        if test "x$xs_sidplay1_library" != "x"; then
-        xs_sidplay1_ldflags="-L$xs_sidplay1_library"
-    else
-        xs_sidplay1_ldflags=""
-    fi
-
-    if test "${xs_cv_have_sidplay1+set}" = set; then :
-  $as_echo_n "(cached) " >&6
-else
-
-
-
-# xs_try_library ( sidplay1:$xs_sidplay1_cxxflags:$xs_sidplay1_ldflags:sidplay:sidplay/sidtune.h:sidTune* myTest = new sidTune(0); )
-
-    xs_cxxflags_save="$CXXFLAGS"
-    CXXFLAGS="$CXXFLAGS $xs_sidplay1_cxxflags"
-    xs_ldflags_save="$LDFLAGS"
-    LDFLAGS="$LDFLAGS $xs_sidplay1_ldflags"
-    xs_libs_save="$LIBS"
-    LIBS="$LIBS -lsidplay"
-    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-        #include <sidplay/sidtune.h>
-int
-main ()
-{
-sidTune* myTest = new sidTune(0);
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_cxx_try_link "$LINENO"; then :
-  xs_sidplay1_works="yes"
-else
-  xs_sidplay1_works="no"
-
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-    CXXFLAGS="$xs_cxxflags_save"
-    LDFLAGS="$xs_ldflags_save"
-    LIBS="$xs_libs_save"
-
-
-        if test "x$xs_sidplay1_works" = "xyes"; then
-          xs_cv_have_sidplay1="xs_have_sidplay1=yes  \
-            xs_sidplay1_cxxflags=\"$xs_sidplay1_cxxflags\"  \
-            xs_sidplay1_ldflags=\"$xs_sidplay1_ldflags\"  "
-        else
-
-
-    xs_sidplay1_includes=""
-    for i in $xs_sidplay1_includes /usr/include /usr/local/include /usr/lib/sidplay/include /usr/local/lib/sidplay/include /opt/sfw/include /opt/csw/include; do
-        for j in sidplay/sidtune.h; do
-            if test -r "$i/$j"; then
-                xs_sidplay1_includes="$i"
-                break 2
-            fi
-        done
-    done
-
-
-
-    xs_sidplay1_library=""
-    for i in $xs_sidplay1_library /usr/lib /usr/lib/sidplay /usr/local/lib/sidplay /opt/sfw/lib /opt/csw/lib; do
-        for j in libsidplay.a libsidplay.so libsidplay.so.1 libsidplay.so.1.36 libsidplay.so.1.37; do
-            if test -r "$i/$j"; then
-                xs_sidplay1_library="$i"
-                break 2
-            fi
-        done
-    done
-
-
-    if test "x$xs_sidplay1_includes" = "x" || test "x$xs_sidplay1_library" = "x"; then
-        xs_cv_have_sidplay1="xs_have_sidplay1=no  \
-          xs_sidplay1_ldflags=\"\" xs_sidplay1_cxxflags=\"\"  "
-    else
-                xs_sidplay1_ldflags="-L$xs_sidplay1_library"
-        xs_sidplay1_cxxflags="-I$xs_sidplay1_includes"
-
-
-# xs_try_library ( sidplay1:$xs_sidplay1_cxxflags:$xs_sidplay1_ldflags:sidplay:sidplay/sidtune.h:sidTune* myTest = new sidTune(0); )
-
-    xs_cxxflags_save="$CXXFLAGS"
-    CXXFLAGS="$CXXFLAGS $xs_sidplay1_cxxflags"
-    xs_ldflags_save="$LDFLAGS"
-    LDFLAGS="$LDFLAGS $xs_sidplay1_ldflags"
-    xs_libs_save="$LIBS"
-    LIBS="$LIBS -lsidplay"
-    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-        #include <sidplay/sidtune.h>
-int
-main ()
-{
-sidTune* myTest = new sidTune(0);
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_cxx_try_link "$LINENO"; then :
-  xs_sidplay1_works="yes"
-else
-  xs_sidplay1_works="no"
-
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-    CXXFLAGS="$xs_cxxflags_save"
-    LDFLAGS="$xs_ldflags_save"
-    LIBS="$xs_libs_save"
-
-
-        xs_cv_have_sidplay1="xs_have_sidplay1=$xs_sidplay1_works  \
-          xs_sidplay1_ldflags=\"$xs_sidplay1_ldflags\"  \
-          xs_sidplay1_cxxflags=\"$xs_sidplay1_cxxflags\"  "
-    fi
-
-        fi
-
-fi
-
-    eval "$xs_cv_have_sidplay1"
-
-# xs_lib_result ( sidplay1:-lsidplay: )
-        if test "x$xs_have_sidplay1" = "xyes"; then
-        if test "x$xs_sidplay1_cxxflags" != "x" || test "x$xs_sidplay1_ldflags" != "x"; then
-            { $as_echo "$as_me:${as_lineno-$LINENO}: result: $xs_sidplay1_cxxflags -lsidplay $xs_sidplay1_ldflags " >&5
-$as_echo "$xs_sidplay1_cxxflags -lsidplay $xs_sidplay1_ldflags " >&6; }
-        else
-            { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
-$as_echo "yes" >&6; }
-        fi
-
-        SIDPLAY1_LIBS="$xs_sidplay1_ldflags -lsidplay"
-        SIDPLAY1_CFLAGS="$xs_sidplay1_cxxflags "
-                    else
-        { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-    fi
-
-    ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
-
-
-    elif test "x$xs_use_sidplay1" = "xyes"; then
-
-    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for working SIDPlay1 library and headers" >&5
-$as_echo_n "checking for working SIDPlay1 library and headers... " >&6; }
-
-    ac_ext=cpp
-ac_cpp='$CXXCPP $CPPFLAGS'
-ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
-
-
-        if test "x$xs_sidplay1_includes" != "x"; then
-        xs_sidplay1_cxxflags="-I$xs_sidplay1_includes"
-    else
-        xs_sidplay1_cxxflags=""
-    fi
-
-        if test "x$xs_sidplay1_library" != "x"; then
-        xs_sidplay1_ldflags="-L$xs_sidplay1_library"
-    else
-        xs_sidplay1_ldflags=""
-    fi
-
-    if test "${xs_cv_have_sidplay1+set}" = set; then :
-  $as_echo_n "(cached) " >&6
-else
-
-
-
-# xs_try_library ( sidplay1:$xs_sidplay1_cxxflags:$xs_sidplay1_ldflags:sidplay:sidplay/sidtune.h:sidTune* myTest = new sidTune(0); )
-
-    xs_cxxflags_save="$CXXFLAGS"
-    CXXFLAGS="$CXXFLAGS $xs_sidplay1_cxxflags"
-    xs_ldflags_save="$LDFLAGS"
-    LDFLAGS="$LDFLAGS $xs_sidplay1_ldflags"
-    xs_libs_save="$LIBS"
-    LIBS="$LIBS -lsidplay"
-    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-        #include <sidplay/sidtune.h>
-int
-main ()
-{
-sidTune* myTest = new sidTune(0);
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_cxx_try_link "$LINENO"; then :
-  xs_sidplay1_works="yes"
-else
-  xs_sidplay1_works="no"
-
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-    CXXFLAGS="$xs_cxxflags_save"
-    LDFLAGS="$xs_ldflags_save"
-    LIBS="$xs_libs_save"
-
-
-        if test "x$xs_sidplay1_works" = "xyes"; then
-          xs_cv_have_sidplay1="xs_have_sidplay1=yes  \
-            xs_sidplay1_cxxflags=\"$xs_sidplay1_cxxflags\"  \
-            xs_sidplay1_ldflags=\"$xs_sidplay1_ldflags\"  "
-        else
-
-
-    xs_sidplay1_includes=""
-    for i in $xs_sidplay1_includes /usr/include /usr/local/include /usr/lib/sidplay/include /usr/local/lib/sidplay/include /opt/sfw/include /opt/csw/include; do
-        for j in sidplay/sidtune.h; do
-            if test -r "$i/$j"; then
-                xs_sidplay1_includes="$i"
-                break 2
-            fi
-        done
-    done
-
-
-
-    xs_sidplay1_library=""
-    for i in $xs_sidplay1_library /usr/lib /usr/lib/sidplay /usr/local/lib/sidplay /opt/sfw/lib /opt/csw/lib; do
-        for j in libsidplay.a libsidplay.so libsidplay.so.1 libsidplay.so.1.36 libsidplay.so.1.37; do
-            if test -r "$i/$j"; then
-                xs_sidplay1_library="$i"
-                break 2
-            fi
-        done
-    done
-
-
-    if test "x$xs_sidplay1_includes" = "x" || test "x$xs_sidplay1_library" = "x"; then
-        xs_cv_have_sidplay1="xs_have_sidplay1=no  \
-          xs_sidplay1_ldflags=\"\" xs_sidplay1_cxxflags=\"\"  "
-    else
-                xs_sidplay1_ldflags="-L$xs_sidplay1_library"
-        xs_sidplay1_cxxflags="-I$xs_sidplay1_includes"
-
-
-# xs_try_library ( sidplay1:$xs_sidplay1_cxxflags:$xs_sidplay1_ldflags:sidplay:sidplay/sidtune.h:sidTune* myTest = new sidTune(0); )
-
-    xs_cxxflags_save="$CXXFLAGS"
-    CXXFLAGS="$CXXFLAGS $xs_sidplay1_cxxflags"
-    xs_ldflags_save="$LDFLAGS"
-    LDFLAGS="$LDFLAGS $xs_sidplay1_ldflags"
-    xs_libs_save="$LIBS"
-    LIBS="$LIBS -lsidplay"
-    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-        #include <sidplay/sidtune.h>
-int
-main ()
-{
-sidTune* myTest = new sidTune(0);
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_cxx_try_link "$LINENO"; then :
-  xs_sidplay1_works="yes"
-else
-  xs_sidplay1_works="no"
-
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-    CXXFLAGS="$xs_cxxflags_save"
-    LDFLAGS="$xs_ldflags_save"
-    LIBS="$xs_libs_save"
-
-
-        xs_cv_have_sidplay1="xs_have_sidplay1=$xs_sidplay1_works  \
-          xs_sidplay1_ldflags=\"$xs_sidplay1_ldflags\"  \
-          xs_sidplay1_cxxflags=\"$xs_sidplay1_cxxflags\"  "
-    fi
-
-        fi
-
-fi
-
-    eval "$xs_cv_have_sidplay1"
-
-# xs_lib_result ( sidplay1:-lsidplay: )
-        if test "x$xs_have_sidplay1" = "xyes"; then
-        if test "x$xs_sidplay1_cxxflags" != "x" || test "x$xs_sidplay1_ldflags" != "x"; then
-            { $as_echo "$as_me:${as_lineno-$LINENO}: result: $xs_sidplay1_cxxflags -lsidplay $xs_sidplay1_ldflags " >&5
-$as_echo "$xs_sidplay1_cxxflags -lsidplay $xs_sidplay1_ldflags " >&6; }
-        else
-            { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
-$as_echo "yes" >&6; }
-        fi
-
-        SIDPLAY1_LIBS="$xs_sidplay1_ldflags -lsidplay"
-        SIDPLAY1_CFLAGS="$xs_sidplay1_cxxflags "
-                    else
-        { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-    fi
-
-    ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
-
-
-        if test "x$xs_have_sidplay1" = "xno"; then
-            as_fn_error "libSIDPlay1 library and/or headers were not found!" "$LINENO" 5
-        fi
-    fi
-
-if test "x$xs_have_sidplay1" = "xyes"; then
-	$as_echo "#define HAVE_SIDPLAY1 1" >>confdefs.h
-
-fi
-
-# xs_arg_with ( sidplay2:libSIDPlay2:XS_PATH_LIBSIDPLAY2 )
-
-# Check whether --with-sidplay2 was given.
-if test "${with_sidplay2+set}" = set; then :
-  withval=$with_sidplay2;         if test "x$withval" = "xyes"; then
-            xs_use_sidplay2="yes"
-            xs_sidplay2_library=""
-            xs_sidplay2_includes=""
-        else
-            if test "x$withval" = "xno"; then
-                xs_use_sidplay2="no"
-            else
-                xs_use_sidplay2="yes"
-                xs_sidplay2_includes="$withval/include"
-                xs_sidplay2_library="$withval/lib"
-            fi
-        fi
-
-else
-          xs_use_sidplay2="try"
-        xs_sidplay2_library=""
-        xs_sidplay2_includes=""
-
-fi
-
-# Check whether --with-sidplay2-inc was given.
-if test "${with_sidplay2_inc+set}" = set; then :
-  withval=$with_sidplay2_inc; xs_sidplay2_includes="$withval"
-fi
-
-# Check whether --with-sidplay2-lib was given.
-if test "${with_sidplay2_lib+set}" = set; then :
-  withval=$with_sidplay2_lib; xs_sidplay2_library="$withval"
-fi
-
-        xs_have_sidplay2="no"
-    if test "x$xs_use_sidplay2" = "xtry"; then
-
-    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for working SIDPlay2 library and headers" >&5
-$as_echo_n "checking for working SIDPlay2 library and headers... " >&6; }
-
-    ac_ext=cpp
-ac_cpp='$CXXCPP $CPPFLAGS'
-ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
-
-
-
-    if test "x$PKG_CONFIG" != "x" && $PKG_CONFIG --atleast-version 2.1.0 libsidplay2; then
-        xs_pkgcfg_knows="yes"
-    else
-        xs_pkgcfg_knows="no"
-    fi
-
-        if test "x$xs_sidplay2_library" != "x"; then
-        xs_sidplay2_builders="$xs_sidplay2_library/sidplay/builders"
-    elif test "x$xs_pkgcfg_knows" = "xyes" ; then
-        xs_sidplay2_builders=`$PKG_CONFIG --variable=builders libsidplay2`
-    fi
-
-    if test "${xs_cv_have_sidplay2+set}" = set; then :
-  $as_echo_n "(cached) " >&6
-else
-
-                        xs_sidplay2_ldflags="-lsidplay2"
-
-
-# xs_try_library ( sidplay2:$xs_sidplay2_cxxflags -DHAVE_UNIX:$xs_sidplay2_ldflags:sidplay2:sidplay/sidplay2.h:sidplay2 *myEngine; )
-
-    xs_cxxflags_save="$CXXFLAGS"
-    CXXFLAGS="$CXXFLAGS $xs_sidplay2_cxxflags -DHAVE_UNIX"
-    xs_ldflags_save="$LDFLAGS"
-    LDFLAGS="$LDFLAGS $xs_sidplay2_ldflags"
-    xs_libs_save="$LIBS"
-    LIBS="$LIBS -lsidplay2"
-    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-        #include <sidplay/sidplay2.h>
-int
-main ()
-{
-sidplay2 *myEngine;
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_cxx_try_link "$LINENO"; then :
-  xs_sidplay2_works="yes"
-else
-  xs_sidplay2_works="no"
-
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-    CXXFLAGS="$xs_cxxflags_save"
-    LDFLAGS="$xs_ldflags_save"
-    LIBS="$xs_libs_save"
-
-
-        if test "x$xs_sidplay2_works" = "xyes"; then
-          xs_cv_have_sidplay2="xs_have_sidplay2=yes  \
-            xs_sidplay2_cxxflags=\"$xs_sidplay2_cxxflags\"  \
-            xs_sidplay2_ldflags=\"$xs_sidplay2_ldflags\"  \
-            xs_sidplay2_builders=\"$xs_sidplay2_builders\"  "
-        else
-
-        if test "x$xs_sidplay2_includes" = "x"; then
-        if test "x$xs_pkgcfg_knows" = "xyes" ; then
-            xs_sidplay2_includes=`$PKG_CONFIG --variable=includedir libsidplay2`
-            xs_sidplay2_cxxflags=`$PKG_CONFIG --cflags libsidplay2`
-        else
-
-    xs_sidplay2_includes=""
-    for i in $xs_sidplay2_includes $xs_sidplay2_includes/include /usr/include /usr/local/include /usr/lib/sidplay/include /usr/local/lib/sidplay/include /opt/sfw/include /opt/csw/include; do
-        for j in sidplay/sidplay2.h; do
-            if test -r "$i/$j"; then
-                xs_sidplay2_includes="$i"
-                break 2
-            fi
-        done
-    done
-
-            xs_sidplay2_cxxflags="-I$xs_sidplay2_includes"
-        fi
-    else
-        xs_sidplay2_cxxflags="-I$xs_sidplay2_includes"
-    fi
-    if test "x$xs_sidplay2_library" = "x"; then
-        if test "x$xs_pkgcfg_knows" = "xyes" ; then
-            xs_sidplay2_library=`$PKG_CONFIG --variable=libdir libsidplay2`
-            xs_sidplay2_ldflags=`$PKG_CONFIG --libs libsidplay2`
-            xs_sidplay2_builders=`$PKG_CONFIG --variable=builders libsidplay2`
-        else
-
-    xs_sidplay2_library=""
-    for i in $xs_sidplay2_library $xs_sidplay2_library/lib $xs_sidplay2_library/src /usr/lib /usr/lib/sidplay /usr/local/lib/sidplay /opt/sfw/lib /opt/csw/lib; do
-        for j in libsidplay2.la; do
-            if test -r "$i/$j"; then
-                xs_sidplay2_library="$i"
-                break 2
-            fi
-        done
-    done
-
-            xs_sidplay2_ldflags="-L$xs_sidplay2_library -lsidplay2"
-            xs_sidplay2_builders="$xs_sidplay2_library/sidplay/builders"
-        fi
-    else
-        xs_sidplay2_ldflags="-L$xs_sidplay2_library -lsidplay2"
-    fi
-    if test "x$xs_sidplay2_includes" = "x" || test "x$xs_sidplay2_library" = "x"; then
-        xs_cv_have_sidplay2="xs_have_sidplay2=no \
-          xs_sidplay2_ldflags=\"\" xs_sidplay2_cxxflags=\"\" \
-          xs_sidplay2_builders=\"\" "
-    else
-                xs_sidplay2_ldflags="-L$xs_sidplay2_library -lsidplay2"
-        xs_sidplay2_cxxflags="-I$xs_sidplay2_includes"
-
-
-# xs_try_library ( sidplay2:$xs_sidplay2_cxxflags -DHAVE_UNIX:$xs_sidplay2_ldflags:sidplay2:sidplay/sidplay2.h:sidplay2 *myEngine; )
-
-    xs_cxxflags_save="$CXXFLAGS"
-    CXXFLAGS="$CXXFLAGS $xs_sidplay2_cxxflags -DHAVE_UNIX"
-    xs_ldflags_save="$LDFLAGS"
-    LDFLAGS="$LDFLAGS $xs_sidplay2_ldflags"
-    xs_libs_save="$LIBS"
-    LIBS="$LIBS -lsidplay2"
-    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-        #include <sidplay/sidplay2.h>
-int
-main ()
-{
-sidplay2 *myEngine;
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_cxx_try_link "$LINENO"; then :
-  xs_sidplay2_works="yes"
-else
-  xs_sidplay2_works="no"
-
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-    CXXFLAGS="$xs_cxxflags_save"
-    LDFLAGS="$xs_ldflags_save"
-    LIBS="$xs_libs_save"
-
-
-        xs_cv_have_sidplay2="xs_have_sidplay2=$xs_sidplay2_works \
-          xs_sidplay2_ldflags=\"$xs_sidplay2_ldflags\" \
-          xs_sidplay2_cxxflags=\"$xs_sidplay2_cxxflags\" \
-          xs_sidplay2_builders=\"$xs_sidplay2_builders\" "
-    fi
-
-        fi
-
-fi
-
-    eval "$xs_cv_have_sidplay2"
-
-# xs_lib_result ( sidplay2:: )
-        if test "x$xs_have_sidplay2" = "xyes"; then
-        if test "x$xs_sidplay2_cxxflags" != "x" || test "x$xs_sidplay2_ldflags" != "x"; then
-            { $as_echo "$as_me:${as_lineno-$LINENO}: result: $xs_sidplay2_cxxflags  $xs_sidplay2_ldflags " >&5
-$as_echo "$xs_sidplay2_cxxflags  $xs_sidplay2_ldflags " >&6; }
-        else
-            { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
-$as_echo "yes" >&6; }
-        fi
-
-        SIDPLAY2_LIBS="$xs_sidplay2_ldflags "
-        SIDPLAY2_CFLAGS="$xs_sidplay2_cxxflags "
-                    else
-        { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-    fi
-
-    ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
-
-
-    elif test "x$xs_use_sidplay2" = "xyes"; then
-
-    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for working SIDPlay2 library and headers" >&5
-$as_echo_n "checking for working SIDPlay2 library and headers... " >&6; }
-
-    ac_ext=cpp
-ac_cpp='$CXXCPP $CPPFLAGS'
-ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
-
-
-
-    if test "x$PKG_CONFIG" != "x" && $PKG_CONFIG --atleast-version 2.1.0 libsidplay2; then
-        xs_pkgcfg_knows="yes"
-    else
-        xs_pkgcfg_knows="no"
-    fi
-
-        if test "x$xs_sidplay2_library" != "x"; then
-        xs_sidplay2_builders="$xs_sidplay2_library/sidplay/builders"
-    elif test "x$xs_pkgcfg_knows" = "xyes" ; then
-        xs_sidplay2_builders=`$PKG_CONFIG --variable=builders libsidplay2`
-    fi
-
-    if test "${xs_cv_have_sidplay2+set}" = set; then :
-  $as_echo_n "(cached) " >&6
-else
-
-                        xs_sidplay2_ldflags="-lsidplay2"
-
-
-# xs_try_library ( sidplay2:$xs_sidplay2_cxxflags -DHAVE_UNIX:$xs_sidplay2_ldflags:sidplay2:sidplay/sidplay2.h:sidplay2 *myEngine; )
-
-    xs_cxxflags_save="$CXXFLAGS"
-    CXXFLAGS="$CXXFLAGS $xs_sidplay2_cxxflags -DHAVE_UNIX"
-    xs_ldflags_save="$LDFLAGS"
-    LDFLAGS="$LDFLAGS $xs_sidplay2_ldflags"
-    xs_libs_save="$LIBS"
-    LIBS="$LIBS -lsidplay2"
-    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-        #include <sidplay/sidplay2.h>
-int
-main ()
-{
-sidplay2 *myEngine;
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_cxx_try_link "$LINENO"; then :
-  xs_sidplay2_works="yes"
-else
-  xs_sidplay2_works="no"
-
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-    CXXFLAGS="$xs_cxxflags_save"
-    LDFLAGS="$xs_ldflags_save"
-    LIBS="$xs_libs_save"
-
-
-        if test "x$xs_sidplay2_works" = "xyes"; then
-          xs_cv_have_sidplay2="xs_have_sidplay2=yes  \
-            xs_sidplay2_cxxflags=\"$xs_sidplay2_cxxflags\"  \
-            xs_sidplay2_ldflags=\"$xs_sidplay2_ldflags\"  \
-            xs_sidplay2_builders=\"$xs_sidplay2_builders\"  "
-        else
-
-        if test "x$xs_sidplay2_includes" = "x"; then
-        if test "x$xs_pkgcfg_knows" = "xyes" ; then
-            xs_sidplay2_includes=`$PKG_CONFIG --variable=includedir libsidplay2`
-            xs_sidplay2_cxxflags=`$PKG_CONFIG --cflags libsidplay2`
-        else
-
-    xs_sidplay2_includes=""
-    for i in $xs_sidplay2_includes $xs_sidplay2_includes/include /usr/include /usr/local/include /usr/lib/sidplay/include /usr/local/lib/sidplay/include /opt/sfw/include /opt/csw/include; do
-        for j in sidplay/sidplay2.h; do
-            if test -r "$i/$j"; then
-                xs_sidplay2_includes="$i"
-                break 2
-            fi
-        done
-    done
-
-            xs_sidplay2_cxxflags="-I$xs_sidplay2_includes"
-        fi
-    else
-        xs_sidplay2_cxxflags="-I$xs_sidplay2_includes"
-    fi
-    if test "x$xs_sidplay2_library" = "x"; then
-        if test "x$xs_pkgcfg_knows" = "xyes" ; then
-            xs_sidplay2_library=`$PKG_CONFIG --variable=libdir libsidplay2`
-            xs_sidplay2_ldflags=`$PKG_CONFIG --libs libsidplay2`
-            xs_sidplay2_builders=`$PKG_CONFIG --variable=builders libsidplay2`
-        else
-
-    xs_sidplay2_library=""
-    for i in $xs_sidplay2_library $xs_sidplay2_library/lib $xs_sidplay2_library/src /usr/lib /usr/lib/sidplay /usr/local/lib/sidplay /opt/sfw/lib /opt/csw/lib; do
-        for j in libsidplay2.la; do
-            if test -r "$i/$j"; then
-                xs_sidplay2_library="$i"
-                break 2
-            fi
-        done
-    done
-
-            xs_sidplay2_ldflags="-L$xs_sidplay2_library -lsidplay2"
-            xs_sidplay2_builders="$xs_sidplay2_library/sidplay/builders"
-        fi
-    else
-        xs_sidplay2_ldflags="-L$xs_sidplay2_library -lsidplay2"
-    fi
-    if test "x$xs_sidplay2_includes" = "x" || test "x$xs_sidplay2_library" = "x"; then
-        xs_cv_have_sidplay2="xs_have_sidplay2=no \
-          xs_sidplay2_ldflags=\"\" xs_sidplay2_cxxflags=\"\" \
-          xs_sidplay2_builders=\"\" "
-    else
-                xs_sidplay2_ldflags="-L$xs_sidplay2_library -lsidplay2"
-        xs_sidplay2_cxxflags="-I$xs_sidplay2_includes"
-
-
-# xs_try_library ( sidplay2:$xs_sidplay2_cxxflags -DHAVE_UNIX:$xs_sidplay2_ldflags:sidplay2:sidplay/sidplay2.h:sidplay2 *myEngine; )
-
-    xs_cxxflags_save="$CXXFLAGS"
-    CXXFLAGS="$CXXFLAGS $xs_sidplay2_cxxflags -DHAVE_UNIX"
-    xs_ldflags_save="$LDFLAGS"
-    LDFLAGS="$LDFLAGS $xs_sidplay2_ldflags"
-    xs_libs_save="$LIBS"
-    LIBS="$LIBS -lsidplay2"
-    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-        #include <sidplay/sidplay2.h>
-int
-main ()
-{
-sidplay2 *myEngine;
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_cxx_try_link "$LINENO"; then :
-  xs_sidplay2_works="yes"
-else
-  xs_sidplay2_works="no"
-
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-    CXXFLAGS="$xs_cxxflags_save"
-    LDFLAGS="$xs_ldflags_save"
-    LIBS="$xs_libs_save"
-
-
-        xs_cv_have_sidplay2="xs_have_sidplay2=$xs_sidplay2_works \
-          xs_sidplay2_ldflags=\"$xs_sidplay2_ldflags\" \
-          xs_sidplay2_cxxflags=\"$xs_sidplay2_cxxflags\" \
-          xs_sidplay2_builders=\"$xs_sidplay2_builders\" "
-    fi
-
-        fi
-
-fi
-
-    eval "$xs_cv_have_sidplay2"
-
-# xs_lib_result ( sidplay2:: )
-        if test "x$xs_have_sidplay2" = "xyes"; then
-        if test "x$xs_sidplay2_cxxflags" != "x" || test "x$xs_sidplay2_ldflags" != "x"; then
-            { $as_echo "$as_me:${as_lineno-$LINENO}: result: $xs_sidplay2_cxxflags  $xs_sidplay2_ldflags " >&5
-$as_echo "$xs_sidplay2_cxxflags  $xs_sidplay2_ldflags " >&6; }
-        else
-            { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
-$as_echo "yes" >&6; }
-        fi
-
-        SIDPLAY2_LIBS="$xs_sidplay2_ldflags "
-        SIDPLAY2_CFLAGS="$xs_sidplay2_cxxflags "
-                    else
-        { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-    fi
-
-    ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
-
-
-        if test "x$xs_have_sidplay2" = "xno"; then
-            as_fn_error "libSIDPlay2 library and/or headers were not found!" "$LINENO" 5
-        fi
-    fi
-
-if test "x$xs_have_sidplay2" = "xyes"; then
-	$as_echo "#define HAVE_SIDPLAY2 1" >>confdefs.h
-
-	ac_ext=cpp
-ac_cpp='$CXXCPP $CPPFLAGS'
-ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
-
-
-
-    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for SIDPlay2 builders directory" >&5
-$as_echo_n "checking for SIDPlay2 builders directory... " >&6; }
-
-
-
-        builders_includedir="$xs_sidplay2_includes"
-    builders_libdir="$xs_sidplay2_builders"
-
-                                if test "x$builders_libdir" = "x"; then
-        eval "builders_libdir=$libdir/sidplay/builders"
-    fi
-
-
-# Check whether --with-sidbuilders was given.
-if test "${with_sidbuilders+set}" = set; then :
-  withval=$with_sidbuilders; builders_includedir="$withval/include"
-         builders_libdir="$withval/lib/sidplay/builders"
-fi
-
-
-
-# Check whether --with-builders-inc was given.
-if test "${with_builders_inc+set}" = set; then :
-  withval=$with_builders_inc; builders_includedir="$withval"
-fi
-
-
-
-# Check whether --with-builders-lib was given.
-if test "${with_builders_lib+set}" = set; then :
-  withval=$with_builders_lib; builders_libdir="$withval"
-fi
-
-
-    if test "x$builders_includedir" != "x"; then
-        BUILDERS_CFLAGS="-I$builders_includedir"
-    fi
-
-    if test "x$builders_libdir" != "x"; then
-        BUILDERS_LDFLAGS="-L$builders_libdir"
-    fi
-
-    if test -d "$builders_libdir"; then
-        xs_have_sidbuilders_dir="yes"
-        { $as_echo "$as_me:${as_lineno-$LINENO}: result: $builders_libdir" >&5
-$as_echo "$builders_libdir" >&6; }
-    else
-        xs_have_sidbuilders_dir="no"
-        { $as_echo "$as_me:${as_lineno-$LINENO}: result: $xs_have_sidbuilders_dir" >&5
-$as_echo "$xs_have_sidbuilders_dir" >&6; }
-        as_fn_error "$builders_libdir not found!
-Check --help on how to specify SIDPlay2 and/or builders library and
-header path, or set --exec-prefix to the same prefix as your installation
-of libsidplay2.
-        " "$LINENO" 5
-    fi
-
-
-
-
-        xs_builders_available="no"
-
-    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for reSID builder module" >&5
-$as_echo_n "checking for reSID builder module... " >&6; }
-
-# xs_try_library ( builders:$BUILDERS_CFLAGS:$BUILDERS_LDFLAGS:resid-builder:sidplay/builders/resid.h:ReSIDBuilder *sid; )
-
-    xs_cxxflags_save="$CXXFLAGS"
-    CXXFLAGS="$CXXFLAGS $BUILDERS_CFLAGS"
-    xs_ldflags_save="$LDFLAGS"
-    LDFLAGS="$LDFLAGS $BUILDERS_LDFLAGS"
-    xs_libs_save="$LIBS"
-    LIBS="$LIBS -lresid-builder"
-    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-        #include <sidplay/builders/resid.h>
-int
-main ()
-{
-ReSIDBuilder *sid;
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_cxx_try_link "$LINENO"; then :
-  xs_builders_works="yes"
-else
-  xs_builders_works="no"
-
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-    CXXFLAGS="$xs_cxxflags_save"
-    LDFLAGS="$xs_ldflags_save"
-    LIBS="$xs_libs_save"
-
-    if test "x$xs_builders_works" = "xyes"; then
-        xs_builders_available="yes"
-        xs_builders="reSID $xs_builders"
-        $as_echo "#define HAVE_RESID_BUILDER 1" >>confdefs.h
-
-        BUILDERS_LIBS="$BUILDERS_LIBS -lresid-builder"
-    fi
-    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $xs_builders_works" >&5
-$as_echo "$xs_builders_works" >&6; }
-
-
-
-    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for HardSID builder module" >&5
-$as_echo_n "checking for HardSID builder module... " >&6; }
-
-# xs_try_library ( builders:$BUILDERS_CFLAGS:$BUILDERS_LDFLAGS:hardsid-builder:sidplay/builders/hardsid.h:HardSID *sid; )
-
-    xs_cxxflags_save="$CXXFLAGS"
-    CXXFLAGS="$CXXFLAGS $BUILDERS_CFLAGS"
-    xs_ldflags_save="$LDFLAGS"
-    LDFLAGS="$LDFLAGS $BUILDERS_LDFLAGS"
-    xs_libs_save="$LIBS"
-    LIBS="$LIBS -lhardsid-builder"
-    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-        #include <sidplay/builders/hardsid.h>
-int
-main ()
-{
-HardSID *sid;
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_cxx_try_link "$LINENO"; then :
-  xs_builders_works="yes"
-else
-  xs_builders_works="no"
-
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-    CXXFLAGS="$xs_cxxflags_save"
-    LDFLAGS="$xs_ldflags_save"
-    LIBS="$xs_libs_save"
-
-    if test "x$xs_builders_works" = "xyes"; then
-        xs_builders_available="yes"
-        xs_builders="HardSID $xs_builders"
-        $as_echo "#define HAVE_HARDSID_BUILDER 1" >>confdefs.h
-
-        BUILDERS_LIBS="$BUILDERS_LIBS -lhardsid-builder"
-    fi
-    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $xs_builders_works" >&5
-$as_echo "$xs_builders_works" >&6; }
-
-
-	if test "x$xs_builders_available" = "xno"; then
-		{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: No builder modules were found in the sidbuilders directory!" >&5
-$as_echo "$as_me: WARNING: No builder modules were found in the sidbuilders directory!" >&2;};
-		xs_have_sidplay2=no
-	fi
-fi
-
-if test "x$xs_have_sidplay2" = "xyes"; then
-		{ $as_echo "$as_me:${as_lineno-$LINENO}: checking libSIDPlay2 API style" >&5
-$as_echo_n "checking libSIDPlay2 API style... " >&6; }
-	tmp_CPPFLAGS="$CPPFLAGS"
-	if test -d "$xs_sidplay2_includes"; then
-		CPPFLAGS="$CPPFLAGS -I${xs_sidplay2_includes}"
-	fi
-	cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#include <sidplay/sidplay2.h>
-
-_ACEOF
-if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
-  $EGREP "::Iid" >/dev/null 2>&1; then :
-  xs_have_sidplay2_api="yes"
-else
-
-		cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#include <sidplay/sidplay2.h>
-
-_ACEOF
-if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
-  $EGREP "SIDIID" >/dev/null 2>&1; then :
-  xs_have_sidplay2_api="yes"
-else
-  xs_have_sidplay2_api="(old style API)"
-fi
-rm -f conftest*
-
-
 
+if test "x$enable_sndfile" = "xyes"; then
+	INPUT_PLUGINS="$INPUT_PLUGINS sndfile"
 fi
-rm -f conftest*
 
-	if test "x$xs_have_sidplay2_api" = "xyes"; then
-	cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
 
-		#include <sidplay/sidunknown.h>
-int
-main ()
-{
-ISidUnknown *i;
-  ;
-  return 0;
-}
+# Check whether --enable-modplug was given.
+if test "${enable_modplug+set}" = set; then :
+  enableval=$enable_modplug; enable_modplug=$enableval
+else
+  enable_modplug="yes"
 
-_ACEOF
-if ac_fn_cxx_try_link "$LINENO"; then :
+fi
 
-		xs_have_sidplay2_api="(new COMI style API)"
 
-$as_echo "#define HAVE_SIDPLAY2_COMI 1" >>confdefs.h
+if test "x$enable_modplug" = "xyes"; then
+    INPUT_PLUGINS="$INPUT_PLUGINS modplug"
+    have_modplug="yes"
+else
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: *** ModPlug plugin disabled per user request ***" >&5
+$as_echo "*** ModPlug plugin disabled per user request ***" >&6; }
+    have_modplug="no"
+fi
 
 
+have_ffaudio="no"
+# Check whether --enable-ffaudio was given.
+if test "${enable_ffaudio+set}" = set; then :
+  enableval=$enable_ffaudio; enable_ffaudio=$enableval
 else
-
-		xs_have_sidplay2_api="(broken version!)"
+  enable_ffaudio="yes"
 
 fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-	fi
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $xs_have_sidplay2_api" >&5
-$as_echo "$xs_have_sidplay2_api" >&6; }
 
-	ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
+if test "x$enable_ffaudio" = "xyes"; then
 
-		{ $as_echo "$as_me:${as_lineno-$LINENO}: checking libSIDPlay2+reSID distortion patch" >&5
-$as_echo_n "checking libSIDPlay2+reSID distortion patch... " >&6; }
-	cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#include <sidplay/sidtypes.h>
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for FFMPEG" >&5
+$as_echo_n "checking for FFMPEG... " >&6; }
 
-_ACEOF
-if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
-  $EGREP "minimumfetresistance" >/dev/null 2>&1; then :
+if test -n "$FFMPEG_CFLAGS"; then
+    pkg_cv_FFMPEG_CFLAGS="$FFMPEG_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libavformat >= 52.31.0  libavcodec >= 52.20.0  libavutil >= 49.15.0\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "libavformat >= 52.31.0  libavcodec >= 52.20.0  libavutil >= 49.15.0") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_FFMPEG_CFLAGS=`$PKG_CONFIG --cflags "libavformat >= 52.31.0  libavcodec >= 52.20.0  libavutil >= 49.15.0" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$FFMPEG_LIBS"; then
+    pkg_cv_FFMPEG_LIBS="$FFMPEG_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libavformat >= 52.31.0  libavcodec >= 52.20.0  libavutil >= 49.15.0\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "libavformat >= 52.31.0  libavcodec >= 52.20.0  libavutil >= 49.15.0") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_FFMPEG_LIBS=`$PKG_CONFIG --libs "libavformat >= 52.31.0  libavcodec >= 52.20.0  libavutil >= 49.15.0" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
 
-		xs_have_distortion="yes"
 
-$as_echo "#define HAVE_SIDPLAY2_DISTORTION 1" >>confdefs.h
 
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        FFMPEG_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "libavformat >= 52.31.0  libavcodec >= 52.20.0  libavutil >= 49.15.0" 2>&1`
+        else
+	        FFMPEG_PKG_ERRORS=`$PKG_CONFIG --print-errors "libavformat >= 52.31.0  libavcodec >= 52.20.0  libavutil >= 49.15.0" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$FFMPEG_PKG_ERRORS" >&5
 
-		xs_have_distortion="no"
+	have_ffaudio="no"
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	have_ffaudio="no"
+else
+	FFMPEG_CFLAGS=$pkg_cv_FFMPEG_CFLAGS
+	FFMPEG_LIBS=$pkg_cv_FFMPEG_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	have_ffaudio="yes"
+fi
+fi
 
+if test "x$have_ffaudio" = "xyes"; then
+    INPUT_PLUGINS="$INPUT_PLUGINS ffaudio"
 fi
-rm -f conftest*
 
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $xs_have_distortion" >&5
-$as_echo "$xs_have_distortion" >&6; }
-	CPPFLAGS="$tmp_CPPFLAGS"
+# Check whether --enable-jack was given.
+if test "${enable_jack+set}" = set; then :
+  enableval=$enable_jack; enable_jack=$enableval
+else
+  enable_jack="yes"
 fi
 
-if test "x$xs_have_sidplay1" = "xyes" || test "x$xs_have_sidplay2" = "xyes"; then
-	have_sidplay=yes
 
-	else have_sidplay=no
+if test "x$enable_jack" = "xyes"; then
+        AM_PATH_JACK(have_jack=yes, have_jack=no)
+else
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: *** jack plugin disabled per user request ***" >&5
+$as_echo "*** jack plugin disabled per user request ***" >&6; }
+        have_jack=no
+fi
+
+if test "x$have_jack" = "xyes"; then
+	OUTPUT_PLUGINS="$OUTPUT_PLUGINS jack"
+fi
 
+# Check whether --enable-sid was given.
+if test "${enable_sid+set}" = set; then :
+  enableval=$enable_sid;
+else
+  enable_sid="yes"
 fi
 
+
+if test "x$enable_sid" = "xyes"; then
+        AM_PATH_SIDPLAY(have_sidplay=yes, have_sidplay=no)
 else
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: *** SID plugin disabled per user request ***" >&5
 $as_echo "*** SID plugin disabled per user request ***" >&6; }
@@ -11150,48 +10610,71 @@
 
 
 if test "x$enable_alsa" = "xyes"; then
-    pkg_failed=no
+
+pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for ALSA" >&5
 $as_echo_n "checking for ALSA... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"alsa >= 1.0\""; } >&5
+
+if test -n "$ALSA_CFLAGS"; then
+    pkg_cv_ALSA_CFLAGS="$ALSA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"alsa >= 1.0\""; } >&5
   ($PKG_CONFIG --exists --print-errors "alsa >= 1.0") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${ALSA_CFLAGS}" != "x"; then
-            pkg_cv_ALSA_CFLAGS="${ALSA_CFLAGS}"
-        else
-            pkg_cv_ALSA_CFLAGS=`$PKG_CONFIG --cflags "alsa >= 1.0" 2>/dev/null`
-        fi
-        if test "x${ALSA_LIBS}" != "x"; then
-            pkg_cv_ALSA_LIBS="${ALSA_LIBS}"
-        else
-            pkg_cv_ALSA_LIBS=`$PKG_CONFIG --libs "alsa >= 1.0" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_ALSA_CFLAGS=`$PKG_CONFIG --cflags "alsa >= 1.0" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$ALSA_LIBS"; then
+    pkg_cv_ALSA_LIBS="$ALSA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"alsa >= 1.0\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "alsa >= 1.0") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_ALSA_LIBS=`$PKG_CONFIG --libs "alsa >= 1.0" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        ALSA_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "alsa >= 1.0" 2>&1`
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        ALSA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "alsa >= 1.0" 2>&1`
         else
-	        ALSA_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "alsa >= 1.0" 2>&1`
+	        ALSA_PKG_ERRORS=`$PKG_CONFIG --print-errors "alsa >= 1.0" 2>&1`
         fi
-		echo "$ALSA_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+	# Put the nasty error message in config.log where it belongs
+	echo "$ALSA_PKG_ERRORS" >&5
+
+	have_alsa=no
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-                have_alsa=no
-elif test "x$pkg_failed" = "xuntried"; then
 	have_alsa=no
 else
-	ALSA_CFLAGS="$pkg_cv_ALSA_CFLAGS"
-	ALSA_LIBS="$pkg_cv_ALSA_LIBS"
+	ALSA_CFLAGS=$pkg_cv_ALSA_CFLAGS
+	ALSA_LIBS=$pkg_cv_ALSA_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 	have_alsa=yes
@@ -11285,48 +10768,71 @@
   if test "x$alsalib_midi" = "xyes"; then
     enable_amidiplug=yes
   else
-    pkg_failed=no
+
+pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for FLUIDSYNTH" >&5
 $as_echo_n "checking for FLUIDSYNTH... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"fluidsynth >= 1.0.6\""; } >&5
+
+if test -n "$FLUIDSYNTH_CFLAGS"; then
+    pkg_cv_FLUIDSYNTH_CFLAGS="$FLUIDSYNTH_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"fluidsynth >= 1.0.6\""; } >&5
   ($PKG_CONFIG --exists --print-errors "fluidsynth >= 1.0.6") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${FLUIDSYNTH_CFLAGS}" != "x"; then
-            pkg_cv_FLUIDSYNTH_CFLAGS="${FLUIDSYNTH_CFLAGS}"
-        else
-            pkg_cv_FLUIDSYNTH_CFLAGS=`$PKG_CONFIG --cflags "fluidsynth >= 1.0.6" 2>/dev/null`
-        fi
-        if test "x${FLUIDSYNTH_LIBS}" != "x"; then
-            pkg_cv_FLUIDSYNTH_LIBS="${FLUIDSYNTH_LIBS}"
-        else
-            pkg_cv_FLUIDSYNTH_LIBS=`$PKG_CONFIG --libs "fluidsynth >= 1.0.6" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_FLUIDSYNTH_CFLAGS=`$PKG_CONFIG --cflags "fluidsynth >= 1.0.6" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$FLUIDSYNTH_LIBS"; then
+    pkg_cv_FLUIDSYNTH_LIBS="$FLUIDSYNTH_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"fluidsynth >= 1.0.6\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "fluidsynth >= 1.0.6") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_FLUIDSYNTH_LIBS=`$PKG_CONFIG --libs "fluidsynth >= 1.0.6" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        FLUIDSYNTH_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "fluidsynth >= 1.0.6" 2>&1`
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        FLUIDSYNTH_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "fluidsynth >= 1.0.6" 2>&1`
         else
-	        FLUIDSYNTH_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "fluidsynth >= 1.0.6" 2>&1`
+	        FLUIDSYNTH_PKG_ERRORS=`$PKG_CONFIG --print-errors "fluidsynth >= 1.0.6" 2>&1`
         fi
-		echo "$FLUIDSYNTH_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+	# Put the nasty error message in config.log where it belongs
+	echo "$FLUIDSYNTH_PKG_ERRORS" >&5
+
+	fluidsynth_available=no
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-                fluidsynth_available=no
-elif test "x$pkg_failed" = "xuntried"; then
 	fluidsynth_available=no
 else
-	FLUIDSYNTH_CFLAGS="$pkg_cv_FLUIDSYNTH_CFLAGS"
-	FLUIDSYNTH_LIBS="$pkg_cv_FLUIDSYNTH_LIBS"
+	FLUIDSYNTH_CFLAGS=$pkg_cv_FLUIDSYNTH_CFLAGS
+	FLUIDSYNTH_LIBS=$pkg_cv_FLUIDSYNTH_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 	fluidsynth_available=yes
@@ -11343,41 +10849,64 @@
 
 if test "x$enable_amidiplug" = "xyes"; then
   INPUT_PLUGINS="$INPUT_PLUGINS amidi-plug"
-  pkg_failed=no
+
+pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for GLIB" >&5
 $as_echo_n "checking for GLIB... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"glib-2.0 >= 2.6.0\""; } >&5
+
+if test -n "$GLIB_CFLAGS"; then
+    pkg_cv_GLIB_CFLAGS="$GLIB_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"glib-2.0 >= 2.6.0\""; } >&5
   ($PKG_CONFIG --exists --print-errors "glib-2.0 >= 2.6.0") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${GLIB_CFLAGS}" != "x"; then
-            pkg_cv_GLIB_CFLAGS="${GLIB_CFLAGS}"
-        else
-            pkg_cv_GLIB_CFLAGS=`$PKG_CONFIG --cflags "glib-2.0 >= 2.6.0" 2>/dev/null`
-        fi
-        if test "x${GLIB_LIBS}" != "x"; then
-            pkg_cv_GLIB_LIBS="${GLIB_LIBS}"
-        else
-            pkg_cv_GLIB_LIBS=`$PKG_CONFIG --libs "glib-2.0 >= 2.6.0" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_GLIB_CFLAGS=`$PKG_CONFIG --cflags "glib-2.0 >= 2.6.0" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$GLIB_LIBS"; then
+    pkg_cv_GLIB_LIBS="$GLIB_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"glib-2.0 >= 2.6.0\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "glib-2.0 >= 2.6.0") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_GLIB_LIBS=`$PKG_CONFIG --libs "glib-2.0 >= 2.6.0" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        GLIB_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "glib-2.0 >= 2.6.0" 2>&1`
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        GLIB_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "glib-2.0 >= 2.6.0" 2>&1`
         else
-	        GLIB_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "glib-2.0 >= 2.6.0" 2>&1`
+	        GLIB_PKG_ERRORS=`$PKG_CONFIG --print-errors "glib-2.0 >= 2.6.0" 2>&1`
         fi
-		echo "$GLIB_PKG_ERRORS" >&5
-	as_fn_error "Package requirements (glib-2.0 >= 2.6.0) were not met:
+	# Put the nasty error message in config.log where it belongs
+	echo "$GLIB_PKG_ERRORS" >&5
+
+	as_fn_error $? "Package requirements (glib-2.0 >= 2.6.0) were not met:
 
 $GLIB_PKG_ERRORS
 
@@ -11386,12 +10915,13 @@
 
 Alternatively, you may set the environment variables GLIB_CFLAGS
 and GLIB_LIBS to avoid the need to call pkg-config.
-See the pkg-config man page for more details.
-" "$LINENO" 5
-elif test "x$pkg_failed" = "xuntried"; then
+See the pkg-config man page for more details." "$LINENO" 5
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 	{ { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-as_fn_error "The pkg-config script could not be found or is too old.  Make sure it
+as_fn_error $? "The pkg-config script could not be found or is too old.  Make sure it
 is in your PATH or set the PKG_CONFIG environment variable to the full
 path to pkg-config.
 
@@ -11400,49 +10930,72 @@
 See the pkg-config man page for more details.
 
 To get pkg-config, see <http://pkg-config.freedesktop.org/>.
-See \`config.log' for more details." "$LINENO" 5; }
+See \`config.log' for more details" "$LINENO" 5 ; }
 else
-	GLIB_CFLAGS="$pkg_cv_GLIB_CFLAGS"
-	GLIB_LIBS="$pkg_cv_GLIB_LIBS"
+	GLIB_CFLAGS=$pkg_cv_GLIB_CFLAGS
+	GLIB_LIBS=$pkg_cv_GLIB_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
-	:
+
 fi
-  pkg_failed=no
+
+pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for GMODULE" >&5
 $as_echo_n "checking for GMODULE... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"gmodule-2.0 >= 2.6.0\""; } >&5
+
+if test -n "$GMODULE_CFLAGS"; then
+    pkg_cv_GMODULE_CFLAGS="$GMODULE_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"gmodule-2.0 >= 2.6.0\""; } >&5
   ($PKG_CONFIG --exists --print-errors "gmodule-2.0 >= 2.6.0") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${GMODULE_CFLAGS}" != "x"; then
-            pkg_cv_GMODULE_CFLAGS="${GMODULE_CFLAGS}"
-        else
-            pkg_cv_GMODULE_CFLAGS=`$PKG_CONFIG --cflags "gmodule-2.0 >= 2.6.0" 2>/dev/null`
-        fi
-        if test "x${GMODULE_LIBS}" != "x"; then
-            pkg_cv_GMODULE_LIBS="${GMODULE_LIBS}"
-        else
-            pkg_cv_GMODULE_LIBS=`$PKG_CONFIG --libs "gmodule-2.0 >= 2.6.0" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_GMODULE_CFLAGS=`$PKG_CONFIG --cflags "gmodule-2.0 >= 2.6.0" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$GMODULE_LIBS"; then
+    pkg_cv_GMODULE_LIBS="$GMODULE_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"gmodule-2.0 >= 2.6.0\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "gmodule-2.0 >= 2.6.0") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_GMODULE_LIBS=`$PKG_CONFIG --libs "gmodule-2.0 >= 2.6.0" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        GMODULE_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "gmodule-2.0 >= 2.6.0" 2>&1`
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        GMODULE_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "gmodule-2.0 >= 2.6.0" 2>&1`
         else
-	        GMODULE_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "gmodule-2.0 >= 2.6.0" 2>&1`
+	        GMODULE_PKG_ERRORS=`$PKG_CONFIG --print-errors "gmodule-2.0 >= 2.6.0" 2>&1`
         fi
-		echo "$GMODULE_PKG_ERRORS" >&5
-	as_fn_error "Package requirements (gmodule-2.0 >= 2.6.0) were not met:
+	# Put the nasty error message in config.log where it belongs
+	echo "$GMODULE_PKG_ERRORS" >&5
+
+	as_fn_error $? "Package requirements (gmodule-2.0 >= 2.6.0) were not met:
 
 $GMODULE_PKG_ERRORS
 
@@ -11451,12 +11004,13 @@
 
 Alternatively, you may set the environment variables GMODULE_CFLAGS
 and GMODULE_LIBS to avoid the need to call pkg-config.
-See the pkg-config man page for more details.
-" "$LINENO" 5
-elif test "x$pkg_failed" = "xuntried"; then
+See the pkg-config man page for more details." "$LINENO" 5
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 	{ { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-as_fn_error "The pkg-config script could not be found or is too old.  Make sure it
+as_fn_error $? "The pkg-config script could not be found or is too old.  Make sure it
 is in your PATH or set the PKG_CONFIG environment variable to the full
 path to pkg-config.
 
@@ -11465,13 +11019,13 @@
 See the pkg-config man page for more details.
 
 To get pkg-config, see <http://pkg-config.freedesktop.org/>.
-See \`config.log' for more details." "$LINENO" 5; }
+See \`config.log' for more details" "$LINENO" 5 ; }
 else
-	GMODULE_CFLAGS="$pkg_cv_GMODULE_CFLAGS"
-	GMODULE_LIBS="$pkg_cv_GMODULE_LIBS"
+	GMODULE_CFLAGS=$pkg_cv_GMODULE_CFLAGS
+	GMODULE_LIBS=$pkg_cv_GMODULE_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
-	:
+
 fi
   AMIDIPLUG_BACKEND_DIR=amidi-plug
 
@@ -11481,7 +11035,7 @@
       enable_amidiplug_alsa=yes
     else
       if test "x$enable_amidiplug_alsa" = "xyes"; then
-        as_fn_error "Cannot find ALSA development files (ver >= 1.0), but compilation of AMIDI-Plug ALSA backend has been explicitly requested; please install ALSA dev files and run configure again" "$LINENO" 5
+        as_fn_error $? "Cannot find ALSA development files (ver >= 1.0), but compilation of AMIDI-Plug ALSA backend has been explicitly requested; please install ALSA dev files and run configure again" "$LINENO" 5
         enable_amidiplug_alsa=no
       else
         enable_amidiplug_alsa=no
@@ -11490,48 +11044,71 @@
   fi
   if test "x$enable_amidiplug_fluidsynth" = "xauto" -o "x$enable_amidiplug_fluidsynth" = "xyes"; then
     if test "x$fluidsynth_available" != "xyes" -a "x$fluidsynth_available" != "xno"; then
-      pkg_failed=no
+
+pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for FLUIDSYNTH" >&5
 $as_echo_n "checking for FLUIDSYNTH... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"fluidsynth >= 1.0.6\""; } >&5
+
+if test -n "$FLUIDSYNTH_CFLAGS"; then
+    pkg_cv_FLUIDSYNTH_CFLAGS="$FLUIDSYNTH_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"fluidsynth >= 1.0.6\""; } >&5
   ($PKG_CONFIG --exists --print-errors "fluidsynth >= 1.0.6") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${FLUIDSYNTH_CFLAGS}" != "x"; then
-            pkg_cv_FLUIDSYNTH_CFLAGS="${FLUIDSYNTH_CFLAGS}"
-        else
-            pkg_cv_FLUIDSYNTH_CFLAGS=`$PKG_CONFIG --cflags "fluidsynth >= 1.0.6" 2>/dev/null`
-        fi
-        if test "x${FLUIDSYNTH_LIBS}" != "x"; then
-            pkg_cv_FLUIDSYNTH_LIBS="${FLUIDSYNTH_LIBS}"
-        else
-            pkg_cv_FLUIDSYNTH_LIBS=`$PKG_CONFIG --libs "fluidsynth >= 1.0.6" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_FLUIDSYNTH_CFLAGS=`$PKG_CONFIG --cflags "fluidsynth >= 1.0.6" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$FLUIDSYNTH_LIBS"; then
+    pkg_cv_FLUIDSYNTH_LIBS="$FLUIDSYNTH_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"fluidsynth >= 1.0.6\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "fluidsynth >= 1.0.6") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_FLUIDSYNTH_LIBS=`$PKG_CONFIG --libs "fluidsynth >= 1.0.6" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        FLUIDSYNTH_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "fluidsynth >= 1.0.6" 2>&1`
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        FLUIDSYNTH_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "fluidsynth >= 1.0.6" 2>&1`
         else
-	        FLUIDSYNTH_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "fluidsynth >= 1.0.6" 2>&1`
+	        FLUIDSYNTH_PKG_ERRORS=`$PKG_CONFIG --print-errors "fluidsynth >= 1.0.6" 2>&1`
         fi
-		echo "$FLUIDSYNTH_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+	# Put the nasty error message in config.log where it belongs
+	echo "$FLUIDSYNTH_PKG_ERRORS" >&5
+
+	fluidsynth_available=no
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-                fluidsynth_available=no
-elif test "x$pkg_failed" = "xuntried"; then
 	fluidsynth_available=no
 else
-	FLUIDSYNTH_CFLAGS="$pkg_cv_FLUIDSYNTH_CFLAGS"
-	FLUIDSYNTH_LIBS="$pkg_cv_FLUIDSYNTH_LIBS"
+	FLUIDSYNTH_CFLAGS=$pkg_cv_FLUIDSYNTH_CFLAGS
+	FLUIDSYNTH_LIBS=$pkg_cv_FLUIDSYNTH_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 	fluidsynth_available=yes
@@ -11542,7 +11119,7 @@
       enable_amidiplug_fluidsynth=yes
     else
       if test "x$enable_amidiplug_fluidsynth" = "xyes"; then
-        as_fn_error "Cannot find FluidSynth development files (ver >= 1.0.6), but compilation of AMIDI-Plug FluidSynth backend has been explicitly requested; please install FluidSynth dev files and run configure again" "$LINENO" 5
+        as_fn_error $? "Cannot find FluidSynth development files (ver >= 1.0.6), but compilation of AMIDI-Plug FluidSynth backend has been explicitly requested; please install FluidSynth dev files and run configure again" "$LINENO" 5
         enable_amidiplug_fluidsynth=no
       else
         enable_amidiplug_fluidsynth=no
@@ -11703,8 +11280,7 @@
 do :
   as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
 ac_fn_c_check_func "$LINENO" "$ac_func" "$as_ac_var"
-eval as_val=\$$as_ac_var
-   if test "x$as_val" = x""yes; then :
+if eval test \"x\$"$as_ac_var"\" = x"yes"; then :
   cat >>confdefs.h <<_ACEOF
 #define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
 _ACEOF
@@ -11725,109 +11301,155 @@
 
 
 if test "$enable_cdaudio_ng" = "yes"; then
-   pkg_failed=no
+
+pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for CDIO" >&5
 $as_echo_n "checking for CDIO... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libcdio >= 0.70\""; } >&5
+
+if test -n "$CDIO_CFLAGS"; then
+    pkg_cv_CDIO_CFLAGS="$CDIO_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libcdio >= 0.70\""; } >&5
   ($PKG_CONFIG --exists --print-errors "libcdio >= 0.70") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${CDIO_CFLAGS}" != "x"; then
-            pkg_cv_CDIO_CFLAGS="${CDIO_CFLAGS}"
-        else
-            pkg_cv_CDIO_CFLAGS=`$PKG_CONFIG --cflags "libcdio >= 0.70" 2>/dev/null`
-        fi
-        if test "x${CDIO_LIBS}" != "x"; then
-            pkg_cv_CDIO_LIBS="${CDIO_LIBS}"
-        else
-            pkg_cv_CDIO_LIBS=`$PKG_CONFIG --libs "libcdio >= 0.70" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_CDIO_CFLAGS=`$PKG_CONFIG --cflags "libcdio >= 0.70" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$CDIO_LIBS"; then
+    pkg_cv_CDIO_LIBS="$CDIO_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libcdio >= 0.70\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "libcdio >= 0.70") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_CDIO_LIBS=`$PKG_CONFIG --libs "libcdio >= 0.70" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        CDIO_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "libcdio >= 0.70" 2>&1`
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        CDIO_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "libcdio >= 0.70" 2>&1`
         else
-	        CDIO_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "libcdio >= 0.70" 2>&1`
+	        CDIO_PKG_ERRORS=`$PKG_CONFIG --print-errors "libcdio >= 0.70" 2>&1`
         fi
-		echo "$CDIO_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-                { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: *** Cannot find libcdio 0.70 or newer, cdaudio-ng will not be built ***" >&5
+	# Put the nasty error message in config.log where it belongs
+	echo "$CDIO_PKG_ERRORS" >&5
+
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: *** Cannot find libcdio 0.70 or newer, cdaudio-ng will not be built ***" >&5
 $as_echo "$as_me: WARNING: *** Cannot find libcdio 0.70 or newer, cdaudio-ng will not be built ***" >&2;}
    enable_cdaudio_ng=no
 
-elif test "x$pkg_failed" = "xuntried"; then
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 	{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: *** Cannot find libcdio 0.70 or newer, cdaudio-ng will not be built ***" >&5
 $as_echo "$as_me: WARNING: *** Cannot find libcdio 0.70 or newer, cdaudio-ng will not be built ***" >&2;}
    enable_cdaudio_ng=no
 
 else
-	CDIO_CFLAGS="$pkg_cv_CDIO_CFLAGS"
-	CDIO_LIBS="$pkg_cv_CDIO_LIBS"
+	CDIO_CFLAGS=$pkg_cv_CDIO_CFLAGS
+	CDIO_LIBS=$pkg_cv_CDIO_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
-	:
+
 fi
 fi
 
 if test "$enable_cdaudio_ng" = "yes"; then
-   pkg_failed=no
+
+pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for CDIO" >&5
 $as_echo_n "checking for CDIO... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libcdio_cdda >= 0.70\""; } >&5
+
+if test -n "$CDIO_CFLAGS"; then
+    pkg_cv_CDIO_CFLAGS="$CDIO_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libcdio_cdda >= 0.70\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "libcdio_cdda >= 0.70") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_CDIO_CFLAGS=`$PKG_CONFIG --cflags "libcdio_cdda >= 0.70" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$CDIO_LIBS"; then
+    pkg_cv_CDIO_LIBS="$CDIO_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libcdio_cdda >= 0.70\""; } >&5
   ($PKG_CONFIG --exists --print-errors "libcdio_cdda >= 0.70") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${CDIO_CFLAGS}" != "x"; then
-            pkg_cv_CDIO_CFLAGS="${CDIO_CFLAGS}"
-        else
-            pkg_cv_CDIO_CFLAGS=`$PKG_CONFIG --cflags "libcdio_cdda >= 0.70" 2>/dev/null`
-        fi
-        if test "x${CDIO_LIBS}" != "x"; then
-            pkg_cv_CDIO_LIBS="${CDIO_LIBS}"
-        else
-            pkg_cv_CDIO_LIBS=`$PKG_CONFIG --libs "libcdio_cdda >= 0.70" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_CDIO_LIBS=`$PKG_CONFIG --libs "libcdio_cdda >= 0.70" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
 fi
+ else
+    pkg_failed=untried
+fi
+
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        CDIO_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "libcdio_cdda >= 0.70" 2>&1`
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        CDIO_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "libcdio_cdda >= 0.70" 2>&1`
         else
-	        CDIO_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "libcdio_cdda >= 0.70" 2>&1`
+	        CDIO_PKG_ERRORS=`$PKG_CONFIG --print-errors "libcdio_cdda >= 0.70" 2>&1`
         fi
-		echo "$CDIO_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-                { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: *** Cannot find libcdio_cdda 0.70 or newer, cdaudio-ng will not be built ***" >&5
+	# Put the nasty error message in config.log where it belongs
+	echo "$CDIO_PKG_ERRORS" >&5
+
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: *** Cannot find libcdio_cdda 0.70 or newer, cdaudio-ng will not be built ***" >&5
 $as_echo "$as_me: WARNING: *** Cannot find libcdio_cdda 0.70 or newer, cdaudio-ng will not be built ***" >&2;}
    enable_cdaudio_ng=no
 
-elif test "x$pkg_failed" = "xuntried"; then
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 	{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: *** Cannot find libcdio_cdda 0.70 or newer, cdaudio-ng will not be built ***" >&5
 $as_echo "$as_me: WARNING: *** Cannot find libcdio_cdda 0.70 or newer, cdaudio-ng will not be built ***" >&2;}
    enable_cdaudio_ng=no
 
 else
-	CDIO_CFLAGS="$pkg_cv_CDIO_CFLAGS"
-	CDIO_LIBS="$pkg_cv_CDIO_LIBS"
+	CDIO_CFLAGS=$pkg_cv_CDIO_CFLAGS
+	CDIO_LIBS=$pkg_cv_CDIO_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 	CDIO_LIBS=`pkg-config --libs libcdio_cdda`
@@ -11838,54 +11460,77 @@
 fi
 
 if test "$enable_cdaudio_ng" = "yes"; then
-   pkg_failed=no
+
+pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for CDDB" >&5
 $as_echo_n "checking for CDDB... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libcddb >= 1.2.1\""; } >&5
+
+if test -n "$CDDB_CFLAGS"; then
+    pkg_cv_CDDB_CFLAGS="$CDDB_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libcddb >= 1.2.1\""; } >&5
   ($PKG_CONFIG --exists --print-errors "libcddb >= 1.2.1") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${CDDB_CFLAGS}" != "x"; then
-            pkg_cv_CDDB_CFLAGS="${CDDB_CFLAGS}"
-        else
-            pkg_cv_CDDB_CFLAGS=`$PKG_CONFIG --cflags "libcddb >= 1.2.1" 2>/dev/null`
-        fi
-        if test "x${CDDB_LIBS}" != "x"; then
-            pkg_cv_CDDB_LIBS="${CDDB_LIBS}"
-        else
-            pkg_cv_CDDB_LIBS=`$PKG_CONFIG --libs "libcddb >= 1.2.1" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_CDDB_CFLAGS=`$PKG_CONFIG --cflags "libcddb >= 1.2.1" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$CDDB_LIBS"; then
+    pkg_cv_CDDB_LIBS="$CDDB_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libcddb >= 1.2.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "libcddb >= 1.2.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_CDDB_LIBS=`$PKG_CONFIG --libs "libcddb >= 1.2.1" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
 fi
+ else
+    pkg_failed=untried
+fi
+
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        CDDB_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "libcddb >= 1.2.1" 2>&1`
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        CDDB_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "libcddb >= 1.2.1" 2>&1`
         else
-	        CDDB_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "libcddb >= 1.2.1" 2>&1`
+	        CDDB_PKG_ERRORS=`$PKG_CONFIG --print-errors "libcddb >= 1.2.1" 2>&1`
         fi
-		echo "$CDDB_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-                { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: *** Cannot find libcddb 1.2.1 or newer, cdaudio-ng will not be built ***" >&5
+	# Put the nasty error message in config.log where it belongs
+	echo "$CDDB_PKG_ERRORS" >&5
+
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: *** Cannot find libcddb 1.2.1 or newer, cdaudio-ng will not be built ***" >&5
 $as_echo "$as_me: WARNING: *** Cannot find libcddb 1.2.1 or newer, cdaudio-ng will not be built ***" >&2;}
    enable_cdaudio_ng=no
 
-elif test "x$pkg_failed" = "xuntried"; then
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 	{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: *** Cannot find libcddb 1.2.1 or newer, cdaudio-ng will not be built ***" >&5
 $as_echo "$as_me: WARNING: *** Cannot find libcddb 1.2.1 or newer, cdaudio-ng will not be built ***" >&2;}
    enable_cdaudio_ng=no
 
 else
-	CDDB_CFLAGS="$pkg_cv_CDDB_CFLAGS"
-	CDDB_LIBS="$pkg_cv_CDDB_LIBS"
+	CDDB_CFLAGS=$pkg_cv_CDDB_CFLAGS
+	CDDB_LIBS=$pkg_cv_CDDB_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 	INPUT_PLUGINS="$INPUT_PLUGINS cdaudio-ng"
@@ -12004,48 +11649,71 @@
 
 
 if test "x$have_scrobbler" = "xyes"; then
-    pkg_failed=no
+
+pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for CURL" >&5
 $as_echo_n "checking for CURL... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libcurl >= 7.9.7\""; } >&5
+
+if test -n "$CURL_CFLAGS"; then
+    pkg_cv_CURL_CFLAGS="$CURL_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libcurl >= 7.9.7\""; } >&5
   ($PKG_CONFIG --exists --print-errors "libcurl >= 7.9.7") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${CURL_CFLAGS}" != "x"; then
-            pkg_cv_CURL_CFLAGS="${CURL_CFLAGS}"
-        else
-            pkg_cv_CURL_CFLAGS=`$PKG_CONFIG --cflags "libcurl >= 7.9.7" 2>/dev/null`
-        fi
-        if test "x${CURL_LIBS}" != "x"; then
-            pkg_cv_CURL_LIBS="${CURL_LIBS}"
-        else
-            pkg_cv_CURL_LIBS=`$PKG_CONFIG --libs "libcurl >= 7.9.7" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_CURL_CFLAGS=`$PKG_CONFIG --cflags "libcurl >= 7.9.7" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$CURL_LIBS"; then
+    pkg_cv_CURL_LIBS="$CURL_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libcurl >= 7.9.7\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "libcurl >= 7.9.7") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_CURL_LIBS=`$PKG_CONFIG --libs "libcurl >= 7.9.7" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
 fi
+ else
+    pkg_failed=untried
+fi
+
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        CURL_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "libcurl >= 7.9.7" 2>&1`
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        CURL_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "libcurl >= 7.9.7" 2>&1`
         else
-	        CURL_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "libcurl >= 7.9.7" 2>&1`
+	        CURL_PKG_ERRORS=`$PKG_CONFIG --print-errors "libcurl >= 7.9.7" 2>&1`
         fi
-		echo "$CURL_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+	# Put the nasty error message in config.log where it belongs
+	echo "$CURL_PKG_ERRORS" >&5
+
+	have_scrobbler="no"
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-                have_scrobbler="no"
-elif test "x$pkg_failed" = "xuntried"; then
 	have_scrobbler="no"
 else
-	CURL_CFLAGS="$pkg_cv_CURL_CFLAGS"
-	CURL_LIBS="$pkg_cv_CURL_LIBS"
+	CURL_CFLAGS=$pkg_cv_CURL_CFLAGS
+	CURL_LIBS=$pkg_cv_CURL_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 	have_scrobbler="$have_scrobbler"
@@ -12068,48 +11736,71 @@
 
 
 if test "x$have_neon" = "xyes"; then
-    pkg_failed=no
+
+pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for NEON" >&5
 $as_echo_n "checking for NEON... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"neon >= 0.26\""; } >&5
+
+if test -n "$NEON_CFLAGS"; then
+    pkg_cv_NEON_CFLAGS="$NEON_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"neon >= 0.26\""; } >&5
   ($PKG_CONFIG --exists --print-errors "neon >= 0.26") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${NEON_CFLAGS}" != "x"; then
-            pkg_cv_NEON_CFLAGS="${NEON_CFLAGS}"
-        else
-            pkg_cv_NEON_CFLAGS=`$PKG_CONFIG --cflags "neon >= 0.26" 2>/dev/null`
-        fi
-        if test "x${NEON_LIBS}" != "x"; then
-            pkg_cv_NEON_LIBS="${NEON_LIBS}"
-        else
-            pkg_cv_NEON_LIBS=`$PKG_CONFIG --libs "neon >= 0.26" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_NEON_CFLAGS=`$PKG_CONFIG --cflags "neon >= 0.26" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$NEON_LIBS"; then
+    pkg_cv_NEON_LIBS="$NEON_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"neon >= 0.26\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "neon >= 0.26") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_NEON_LIBS=`$PKG_CONFIG --libs "neon >= 0.26" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
 fi
+ else
+    pkg_failed=untried
+fi
+
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        NEON_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "neon >= 0.26" 2>&1`
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        NEON_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "neon >= 0.26" 2>&1`
         else
-	        NEON_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "neon >= 0.26" 2>&1`
+	        NEON_PKG_ERRORS=`$PKG_CONFIG --print-errors "neon >= 0.26" 2>&1`
         fi
-		echo "$NEON_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+	# Put the nasty error message in config.log where it belongs
+	echo "$NEON_PKG_ERRORS" >&5
+
+	have_neon="no"
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-                have_neon="no"
-elif test "x$pkg_failed" = "xuntried"; then
 	have_neon="no"
 else
-	NEON_CFLAGS="$pkg_cv_NEON_CFLAGS"
-	NEON_LIBS="$pkg_cv_NEON_LIBS"
+	NEON_CFLAGS=$pkg_cv_NEON_CFLAGS
+	NEON_LIBS=$pkg_cv_NEON_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 	TRANSPORT_PLUGINS="$TRANSPORT_PLUGINS neon"
@@ -12174,48 +11865,71 @@
 
 if test "x$have_mms" = "xyes"; then
     have_mms=yes
-    pkg_failed=no
+
+pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for MMS" >&5
 $as_echo_n "checking for MMS... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libmms >= 0.3\""; } >&5
+
+if test -n "$MMS_CFLAGS"; then
+    pkg_cv_MMS_CFLAGS="$MMS_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libmms >= 0.3\""; } >&5
   ($PKG_CONFIG --exists --print-errors "libmms >= 0.3") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${MMS_CFLAGS}" != "x"; then
-            pkg_cv_MMS_CFLAGS="${MMS_CFLAGS}"
-        else
-            pkg_cv_MMS_CFLAGS=`$PKG_CONFIG --cflags "libmms >= 0.3" 2>/dev/null`
-        fi
-        if test "x${MMS_LIBS}" != "x"; then
-            pkg_cv_MMS_LIBS="${MMS_LIBS}"
-        else
-            pkg_cv_MMS_LIBS=`$PKG_CONFIG --libs "libmms >= 0.3" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_MMS_CFLAGS=`$PKG_CONFIG --cflags "libmms >= 0.3" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$MMS_LIBS"; then
+    pkg_cv_MMS_LIBS="$MMS_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libmms >= 0.3\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "libmms >= 0.3") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_MMS_LIBS=`$PKG_CONFIG --libs "libmms >= 0.3" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
 fi
+ else
+    pkg_failed=untried
+fi
+
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        MMS_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "libmms >= 0.3" 2>&1`
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        MMS_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "libmms >= 0.3" 2>&1`
         else
-	        MMS_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "libmms >= 0.3" 2>&1`
+	        MMS_PKG_ERRORS=`$PKG_CONFIG --print-errors "libmms >= 0.3" 2>&1`
         fi
-		echo "$MMS_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+	# Put the nasty error message in config.log where it belongs
+	echo "$MMS_PKG_ERRORS" >&5
+
+	have_mms="no"
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-                have_mms="no"
-elif test "x$pkg_failed" = "xuntried"; then
 	have_mms="no"
 else
-	MMS_CFLAGS="$pkg_cv_MMS_CFLAGS"
-	MMS_LIBS="$pkg_cv_MMS_LIBS"
+	MMS_CFLAGS=$pkg_cv_MMS_CFLAGS
+	MMS_LIBS=$pkg_cv_MMS_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 	TRANSPORT_PLUGINS="$TRANSPORT_PLUGINS mms"
@@ -12238,55 +11952,78 @@
 
 if test "x$have_mtp_up" = "xyes"; then
     have_mtp_up=yes
-    pkg_failed=no
+
+pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for MTP" >&5
 $as_echo_n "checking for MTP... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libmtp >= 0.1.3\""; } >&5
+
+if test -n "$MTP_CFLAGS"; then
+    pkg_cv_MTP_CFLAGS="$MTP_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libmtp >= 0.1.3\""; } >&5
   ($PKG_CONFIG --exists --print-errors "libmtp >= 0.1.3") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${MTP_CFLAGS}" != "x"; then
-            pkg_cv_MTP_CFLAGS="${MTP_CFLAGS}"
-        else
-            pkg_cv_MTP_CFLAGS=`$PKG_CONFIG --cflags "libmtp >= 0.1.3" 2>/dev/null`
-        fi
-        if test "x${MTP_LIBS}" != "x"; then
-            pkg_cv_MTP_LIBS="${MTP_LIBS}"
-        else
-            pkg_cv_MTP_LIBS=`$PKG_CONFIG --libs "libmtp >= 0.1.3" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_MTP_CFLAGS=`$PKG_CONFIG --cflags "libmtp >= 0.1.3" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$MTP_LIBS"; then
+    pkg_cv_MTP_LIBS="$MTP_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libmtp >= 0.1.3\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "libmtp >= 0.1.3") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_MTP_LIBS=`$PKG_CONFIG --libs "libmtp >= 0.1.3" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
 fi
+ else
+    pkg_failed=untried
+fi
+
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        MTP_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "libmtp >= 0.1.3" 2>&1`
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        MTP_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "libmtp >= 0.1.3" 2>&1`
         else
-	        MTP_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "libmtp >= 0.1.3" 2>&1`
+	        MTP_PKG_ERRORS=`$PKG_CONFIG --print-errors "libmtp >= 0.1.3" 2>&1`
         fi
-		echo "$MTP_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+	# Put the nasty error message in config.log where it belongs
+	echo "$MTP_PKG_ERRORS" >&5
+
+	have_mtp_up="no"
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-                have_mtp_up="no"
-elif test "x$pkg_failed" = "xuntried"; then
 	have_mtp_up="no"
 else
-	MTP_CFLAGS="$pkg_cv_MTP_CFLAGS"
-	MTP_LIBS="$pkg_cv_MTP_LIBS"
+	MTP_CFLAGS=$pkg_cv_MTP_CFLAGS
+	MTP_LIBS=$pkg_cv_MTP_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 	GENERAL_PLUGINS="$GENERAL_PLUGINS mtp_up"
 fi
     MTP_LIBS=`pkg-config --libs libmtp`
     MTP_CFLAGS=`pkg-config --cflags libmtp`
-        if test "x$PKG_CONFIG" != "x" && \
+        if test -n "$PKG_CONFIG" && \
     { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libmtp >= 0.3.0\""; } >&5
   ($PKG_CONFIG --exists --print-errors "libmtp >= 0.3.0") 2>&5
   ac_status=$?
@@ -12321,48 +12058,71 @@
 have_bluetooth=no
 if test "x$have_bluetooth" = "xyes" -a "x$have_alsa" = "xyes"; then
     have_bluetooth=yes
-    pkg_failed=no
+
+pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for BLUEZ" >&5
 $as_echo_n "checking for BLUEZ... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"bluez >= 2.22\""; } >&5
+
+if test -n "$BLUEZ_CFLAGS"; then
+    pkg_cv_BLUEZ_CFLAGS="$BLUEZ_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"bluez >= 2.22\""; } >&5
   ($PKG_CONFIG --exists --print-errors "bluez >= 2.22") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${BLUEZ_CFLAGS}" != "x"; then
-            pkg_cv_BLUEZ_CFLAGS="${BLUEZ_CFLAGS}"
-        else
-            pkg_cv_BLUEZ_CFLAGS=`$PKG_CONFIG --cflags "bluez >= 2.22" 2>/dev/null`
-        fi
-        if test "x${BLUEZ_LIBS}" != "x"; then
-            pkg_cv_BLUEZ_LIBS="${BLUEZ_LIBS}"
-        else
-            pkg_cv_BLUEZ_LIBS=`$PKG_CONFIG --libs "bluez >= 2.22" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_BLUEZ_CFLAGS=`$PKG_CONFIG --cflags "bluez >= 2.22" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$BLUEZ_LIBS"; then
+    pkg_cv_BLUEZ_LIBS="$BLUEZ_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"bluez >= 2.22\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "bluez >= 2.22") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_BLUEZ_LIBS=`$PKG_CONFIG --libs "bluez >= 2.22" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
 fi
+ else
+    pkg_failed=untried
+fi
+
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        BLUEZ_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "bluez >= 2.22" 2>&1`
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        BLUEZ_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "bluez >= 2.22" 2>&1`
         else
-	        BLUEZ_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "bluez >= 2.22" 2>&1`
+	        BLUEZ_PKG_ERRORS=`$PKG_CONFIG --print-errors "bluez >= 2.22" 2>&1`
         fi
-		echo "$BLUEZ_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+	# Put the nasty error message in config.log where it belongs
+	echo "$BLUEZ_PKG_ERRORS" >&5
+
+	have_bluetooth="no"
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-                have_bluetooth="no"
-elif test "x$pkg_failed" = "xuntried"; then
 	have_bluetooth="no"
 else
-	BLUEZ_CFLAGS="$pkg_cv_BLUEZ_CFLAGS"
-	BLUEZ_LIBS="$pkg_cv_BLUEZ_LIBS"
+	BLUEZ_CFLAGS=$pkg_cv_BLUEZ_CFLAGS
+	BLUEZ_LIBS=$pkg_cv_BLUEZ_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 	GENERAL_PLUGINS="$GENERAL_PLUGINS bluetooth"
@@ -12404,22 +12164,31 @@
   sdl_exec_prefix=""
 fi
 
+# Check whether --enable-sdltest was given.
+if test "${enable_sdltest+set}" = set; then :
+  enableval=$enable_sdltest;
+else
+  enable_sdltest=yes
+fi
+
 
   if test x$sdl_exec_prefix != x ; then
-     sdl_args="$sdl_args --exec-prefix=$sdl_exec_prefix"
-     if test x${SDL_CONFIG+set} != xset ; then
-        SDL_CONFIG=$sdl_exec_prefix/bin/sdl-config
-     fi
+    sdl_config_args="$sdl_config_args --exec-prefix=$sdl_exec_prefix"
+    if test x${SDL_CONFIG+set} != xset ; then
+      SDL_CONFIG=$sdl_exec_prefix/bin/sdl-config
+    fi
   fi
   if test x$sdl_prefix != x ; then
-     sdl_args="$sdl_args --prefix=$sdl_prefix"
-     if test x${SDL_CONFIG+set} != xset ; then
-        SDL_CONFIG=$sdl_prefix/bin/sdl-config
-     fi
+    sdl_config_args="$sdl_config_args --prefix=$sdl_prefix"
+    if test x${SDL_CONFIG+set} != xset ; then
+      SDL_CONFIG=$sdl_prefix/bin/sdl-config
+    fi
   fi
 
-
-  PATH="$prefix/bin:$prefix/usr/bin:$PATH"
+  as_save_PATH="$PATH"
+  if test "x$prefix" != xNONE; then
+    PATH="$prefix/bin:$prefix/usr/bin:$PATH"
+  fi
   # Extract the first word of "sdl-config", so it can be a program name with args.
 set dummy sdl-config; ac_word=$2
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
@@ -12461,6 +12230,7 @@
 fi
 
 
+  PATH="$as_save_PATH"
   min_sdl_version=1.2.5
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for SDL - version >= $min_sdl_version" >&5
 $as_echo_n "checking for SDL - version >= $min_sdl_version... " >&6; }
@@ -12468,15 +12238,100 @@
   if test "$SDL_CONFIG" = "no" ; then
     no_sdl=yes
   else
-    SDL_CFLAGS=`$SDL_CONFIG $sdlconf_args --cflags`
-    SDL_LIBS=`$SDL_CONFIG $sdlconf_args --libs`
+    SDL_CFLAGS=`$SDL_CONFIG $sdl_config_args --cflags`
+    SDL_LIBS=`$SDL_CONFIG $sdl_config_args --libs`
 
-    sdl_major_version=`$SDL_CONFIG $sdl_args --version | \
+    sdl_major_version=`$SDL_CONFIG $sdl_config_args --version | \
            sed 's/\([0-9]*\).\([0-9]*\).\([0-9]*\)/\1/'`
-    sdl_minor_version=`$SDL_CONFIG $sdl_args --version | \
+    sdl_minor_version=`$SDL_CONFIG $sdl_config_args --version | \
            sed 's/\([0-9]*\).\([0-9]*\).\([0-9]*\)/\2/'`
     sdl_micro_version=`$SDL_CONFIG $sdl_config_args --version | \
            sed 's/\([0-9]*\).\([0-9]*\).\([0-9]*\)/\3/'`
+    if test "x$enable_sdltest" = "xyes" ; then
+      ac_save_CFLAGS="$CFLAGS"
+      ac_save_CXXFLAGS="$CXXFLAGS"
+      ac_save_LIBS="$LIBS"
+      CFLAGS="$CFLAGS $SDL_CFLAGS"
+      CXXFLAGS="$CXXFLAGS $SDL_CFLAGS"
+      LIBS="$LIBS $SDL_LIBS"
+      rm -f conf.sdltest
+      if test "$cross_compiling" = yes; then :
+  echo $ac_n "cross compiling; assumed OK... $ac_c"
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#include <stdio.h>
+#include <stdlib.h>
+#include <string.h>
+#include "SDL.h"
+
+char*
+my_strdup (char *str)
+{
+  char *new_str;
+
+  if (str)
+    {
+      new_str = (char *)malloc ((strlen (str) + 1) * sizeof(char));
+      strcpy (new_str, str);
+    }
+  else
+    new_str = NULL;
+
+  return new_str;
+}
+
+int main (int argc, char *argv[])
+{
+  int major, minor, micro;
+  char *tmp_version;
+
+  /* This hangs on some systems (?)
+  system ("touch conf.sdltest");
+  */
+  { FILE *fp = fopen("conf.sdltest", "a"); if ( fp ) fclose(fp); }
+
+  /* HP/UX 9 (%@#!) writes to sscanf strings */
+  tmp_version = my_strdup("$min_sdl_version");
+  if (sscanf(tmp_version, "%d.%d.%d", &major, &minor, &micro) != 3) {
+     printf("%s, bad version string\n", "$min_sdl_version");
+     exit(1);
+   }
+
+   if (($sdl_major_version > major) ||
+      (($sdl_major_version == major) && ($sdl_minor_version > minor)) ||
+      (($sdl_major_version == major) && ($sdl_minor_version == minor) && ($sdl_micro_version >= micro)))
+    {
+      return 0;
+    }
+  else
+    {
+      printf("\n*** 'sdl-config --version' returned %d.%d.%d, but the minimum version\n", $sdl_major_version, $sdl_minor_version, $sdl_micro_version);
+      printf("*** of SDL required is %d.%d.%d. If sdl-config is correct, then it is\n", major, minor, micro);
+      printf("*** best to upgrade to the required version.\n");
+      printf("*** If sdl-config was wrong, set the environment variable SDL_CONFIG\n");
+      printf("*** to point to the correct copy of sdl-config, and remove the file\n");
+      printf("*** config.cache before re-running configure\n");
+      return 1;
+    }
+}
+
+
+_ACEOF
+if ac_fn_c_try_run "$LINENO"; then :
+
+else
+  no_sdl=yes
+fi
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
+fi
+
+       CFLAGS="$ac_save_CFLAGS"
+       CXXFLAGS="$ac_save_CXXFLAGS"
+       LIBS="$ac_save_LIBS"
+     fi
   fi
   if test "x$no_sdl" = x ; then
      { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
@@ -12490,6 +12345,55 @@
        echo "*** If SDL was installed in PREFIX, make sure PREFIX/bin is in"
        echo "*** your path, or set the SDL_CONFIG environment variable to the"
        echo "*** full path to sdl-config."
+     else
+       if test -f conf.sdltest ; then
+        :
+       else
+          echo "*** Could not run SDL test program, checking why..."
+          CFLAGS="$CFLAGS $SDL_CFLAGS"
+          CXXFLAGS="$CXXFLAGS $SDL_CFLAGS"
+          LIBS="$LIBS $SDL_LIBS"
+          cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#include <stdio.h>
+#include "SDL.h"
+
+int main(int argc, char *argv[])
+{ return 0; }
+#undef  main
+#define main K_and_R_C_main
+
+int
+main ()
+{
+ return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+   echo "*** The test program compiled, but did not run. This usually means"
+          echo "*** that the run-time linker is not finding SDL or finding the wrong"
+          echo "*** version of SDL. If it is not finding SDL, you'll need to set your"
+          echo "*** LD_LIBRARY_PATH environment variable, or edit /etc/ld.so.conf to point"
+          echo "*** to the installed location  Also, make sure you have run ldconfig if that"
+          echo "*** is required on your system"
+	  echo "***"
+          echo "*** If you have an old version installed, it is best to remove it, although"
+          echo "*** you may also be able to get things to work by modifying LD_LIBRARY_PATH"
+else
+   echo "*** The test program failed to compile or link. See the file config.log for the"
+          echo "*** exact error that occured. This usually means SDL was incorrectly installed"
+          echo "*** or that you have moved SDL since it was installed. In the latter case, you"
+          echo "*** may want to edit the sdl-config script: $SDL_CONFIG"
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+          CFLAGS="$ac_save_CFLAGS"
+          CXXFLAGS="$ac_save_CXXFLAGS"
+          LIBS="$ac_save_LIBS"
+       fi
      fi
      SDL_CFLAGS=""
      SDL_LIBS=""
@@ -12515,55 +12419,78 @@
 
 
 
+
 pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for XML" >&5
 $as_echo_n "checking for XML... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libxml-2.0\""; } >&5
+
+if test -n "$XML_CFLAGS"; then
+    pkg_cv_XML_CFLAGS="$XML_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libxml-2.0\""; } >&5
   ($PKG_CONFIG --exists --print-errors "libxml-2.0") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${XML_CFLAGS}" != "x"; then
-            pkg_cv_XML_CFLAGS="${XML_CFLAGS}"
-        else
-            pkg_cv_XML_CFLAGS=`$PKG_CONFIG --cflags "libxml-2.0" 2>/dev/null`
-        fi
-        if test "x${XML_LIBS}" != "x"; then
-            pkg_cv_XML_LIBS="${XML_LIBS}"
-        else
-            pkg_cv_XML_LIBS=`$PKG_CONFIG --libs "libxml-2.0" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_XML_CFLAGS=`$PKG_CONFIG --cflags "libxml-2.0" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$XML_LIBS"; then
+    pkg_cv_XML_LIBS="$XML_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libxml-2.0\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "libxml-2.0") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_XML_LIBS=`$PKG_CONFIG --libs "libxml-2.0" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        XML_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "libxml-2.0" 2>&1`
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        XML_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "libxml-2.0" 2>&1`
         else
-	        XML_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "libxml-2.0" 2>&1`
+	        XML_PKG_ERRORS=`$PKG_CONFIG --print-errors "libxml-2.0" 2>&1`
         fi
-		echo "$XML_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+	# Put the nasty error message in config.log where it belongs
+	echo "$XML_PKG_ERRORS" >&5
+
+	have_xml=no
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-                have_xml=no
-elif test "x$pkg_failed" = "xuntried"; then
 	have_xml=no
 else
-	XML_CFLAGS="$pkg_cv_XML_CFLAGS"
-	XML_LIBS="$pkg_cv_XML_LIBS"
+	XML_CFLAGS=$pkg_cv_XML_CFLAGS
+	XML_LIBS=$pkg_cv_XML_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 	have_xml=yes
 fi
 
 if test $have_xml = "no" ; then
-    as_fn_error "Please install libxml-2.0." "$LINENO" 5
+    as_fn_error $? "Please install libxml-2.0." "$LINENO" 5
 fi
 
 CONTAINER_PLUGINS="$CONTAINER_PLUGINS xspf"
@@ -12580,48 +12507,71 @@
 
 if test "x$have_cue" = "xyes"; then
     have_cue=yes
-    pkg_failed=no
+
+pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for CUE" >&5
 $as_echo_n "checking for CUE... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libcue\""; } >&5
+
+if test -n "$CUE_CFLAGS"; then
+    pkg_cv_CUE_CFLAGS="$CUE_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libcue\""; } >&5
   ($PKG_CONFIG --exists --print-errors "libcue") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${CUE_CFLAGS}" != "x"; then
-            pkg_cv_CUE_CFLAGS="${CUE_CFLAGS}"
-        else
-            pkg_cv_CUE_CFLAGS=`$PKG_CONFIG --cflags "libcue" 2>/dev/null`
-        fi
-        if test "x${CUE_LIBS}" != "x"; then
-            pkg_cv_CUE_LIBS="${CUE_LIBS}"
-        else
-            pkg_cv_CUE_LIBS=`$PKG_CONFIG --libs "libcue" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_CUE_CFLAGS=`$PKG_CONFIG --cflags "libcue" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$CUE_LIBS"; then
+    pkg_cv_CUE_LIBS="$CUE_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libcue\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "libcue") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_CUE_LIBS=`$PKG_CONFIG --libs "libcue" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        CUE_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "libcue" 2>&1`
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        CUE_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "libcue" 2>&1`
         else
-	        CUE_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "libcue" 2>&1`
+	        CUE_PKG_ERRORS=`$PKG_CONFIG --print-errors "libcue" 2>&1`
         fi
-		echo "$CUE_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+	# Put the nasty error message in config.log where it belongs
+	echo "$CUE_PKG_ERRORS" >&5
+
+	have_cue="no"
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-                have_cue="no"
-elif test "x$pkg_failed" = "xuntried"; then
 	have_cue="no"
 else
-	CUE_CFLAGS="$pkg_cv_CUE_CFLAGS"
-	CUE_LIBS="$pkg_cv_CUE_LIBS"
+	CUE_CFLAGS=$pkg_cv_CUE_CFLAGS
+	CUE_LIBS=$pkg_cv_CUE_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 	CONTAINER_PLUGINS="$CONTAINER_PLUGINS cue"
@@ -12642,48 +12592,71 @@
 
 
 if test "x$have_projectm" = "xyes"; then
-	pkg_failed=no
+
+pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for LIBPROJECTM" >&5
 $as_echo_n "checking for LIBPROJECTM... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libprojectM < 1.0\""; } >&5
+
+if test -n "$LIBPROJECTM_CFLAGS"; then
+    pkg_cv_LIBPROJECTM_CFLAGS="$LIBPROJECTM_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libprojectM < 1.0\""; } >&5
   ($PKG_CONFIG --exists --print-errors "libprojectM < 1.0") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${LIBPROJECTM_CFLAGS}" != "x"; then
-            pkg_cv_LIBPROJECTM_CFLAGS="${LIBPROJECTM_CFLAGS}"
-        else
-            pkg_cv_LIBPROJECTM_CFLAGS=`$PKG_CONFIG --cflags "libprojectM < 1.0" 2>/dev/null`
-        fi
-        if test "x${LIBPROJECTM_LIBS}" != "x"; then
-            pkg_cv_LIBPROJECTM_LIBS="${LIBPROJECTM_LIBS}"
-        else
-            pkg_cv_LIBPROJECTM_LIBS=`$PKG_CONFIG --libs "libprojectM < 1.0" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_LIBPROJECTM_CFLAGS=`$PKG_CONFIG --cflags "libprojectM < 1.0" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LIBPROJECTM_LIBS"; then
+    pkg_cv_LIBPROJECTM_LIBS="$LIBPROJECTM_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libprojectM < 1.0\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "libprojectM < 1.0") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LIBPROJECTM_LIBS=`$PKG_CONFIG --libs "libprojectM < 1.0" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        LIBPROJECTM_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "libprojectM < 1.0" 2>&1`
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LIBPROJECTM_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "libprojectM < 1.0" 2>&1`
         else
-	        LIBPROJECTM_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "libprojectM < 1.0" 2>&1`
+	        LIBPROJECTM_PKG_ERRORS=`$PKG_CONFIG --print-errors "libprojectM < 1.0" 2>&1`
         fi
-		echo "$LIBPROJECTM_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+	# Put the nasty error message in config.log where it belongs
+	echo "$LIBPROJECTM_PKG_ERRORS" >&5
+
+	have_projectm="no"
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-                have_projectm="no"
-elif test "x$pkg_failed" = "xuntried"; then
 	have_projectm="no"
 else
-	LIBPROJECTM_CFLAGS="$pkg_cv_LIBPROJECTM_CFLAGS"
-	LIBPROJECTM_LIBS="$pkg_cv_LIBPROJECTM_LIBS"
+	LIBPROJECTM_CFLAGS=$pkg_cv_LIBPROJECTM_CFLAGS
+	LIBPROJECTM_LIBS=$pkg_cv_LIBPROJECTM_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 	have_projectm="yes"
@@ -12704,22 +12677,31 @@
   sdl_exec_prefix=""
 fi
 
+# Check whether --enable-sdltest was given.
+if test "${enable_sdltest+set}" = set; then :
+  enableval=$enable_sdltest;
+else
+  enable_sdltest=yes
+fi
+
 
   if test x$sdl_exec_prefix != x ; then
-     sdl_args="$sdl_args --exec-prefix=$sdl_exec_prefix"
-     if test x${SDL_CONFIG+set} != xset ; then
-        SDL_CONFIG=$sdl_exec_prefix/bin/sdl-config
-     fi
+    sdl_config_args="$sdl_config_args --exec-prefix=$sdl_exec_prefix"
+    if test x${SDL_CONFIG+set} != xset ; then
+      SDL_CONFIG=$sdl_exec_prefix/bin/sdl-config
+    fi
   fi
   if test x$sdl_prefix != x ; then
-     sdl_args="$sdl_args --prefix=$sdl_prefix"
-     if test x${SDL_CONFIG+set} != xset ; then
-        SDL_CONFIG=$sdl_prefix/bin/sdl-config
-     fi
+    sdl_config_args="$sdl_config_args --prefix=$sdl_prefix"
+    if test x${SDL_CONFIG+set} != xset ; then
+      SDL_CONFIG=$sdl_prefix/bin/sdl-config
+    fi
   fi
 
-
-  PATH="$prefix/bin:$prefix/usr/bin:$PATH"
+  as_save_PATH="$PATH"
+  if test "x$prefix" != xNONE; then
+    PATH="$prefix/bin:$prefix/usr/bin:$PATH"
+  fi
   # Extract the first word of "sdl-config", so it can be a program name with args.
 set dummy sdl-config; ac_word=$2
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
@@ -12761,6 +12743,7 @@
 fi
 
 
+  PATH="$as_save_PATH"
   min_sdl_version=1.2.5
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for SDL - version >= $min_sdl_version" >&5
 $as_echo_n "checking for SDL - version >= $min_sdl_version... " >&6; }
@@ -12768,15 +12751,100 @@
   if test "$SDL_CONFIG" = "no" ; then
     no_sdl=yes
   else
-    SDL_CFLAGS=`$SDL_CONFIG $sdlconf_args --cflags`
-    SDL_LIBS=`$SDL_CONFIG $sdlconf_args --libs`
+    SDL_CFLAGS=`$SDL_CONFIG $sdl_config_args --cflags`
+    SDL_LIBS=`$SDL_CONFIG $sdl_config_args --libs`
 
-    sdl_major_version=`$SDL_CONFIG $sdl_args --version | \
+    sdl_major_version=`$SDL_CONFIG $sdl_config_args --version | \
            sed 's/\([0-9]*\).\([0-9]*\).\([0-9]*\)/\1/'`
-    sdl_minor_version=`$SDL_CONFIG $sdl_args --version | \
+    sdl_minor_version=`$SDL_CONFIG $sdl_config_args --version | \
            sed 's/\([0-9]*\).\([0-9]*\).\([0-9]*\)/\2/'`
     sdl_micro_version=`$SDL_CONFIG $sdl_config_args --version | \
            sed 's/\([0-9]*\).\([0-9]*\).\([0-9]*\)/\3/'`
+    if test "x$enable_sdltest" = "xyes" ; then
+      ac_save_CFLAGS="$CFLAGS"
+      ac_save_CXXFLAGS="$CXXFLAGS"
+      ac_save_LIBS="$LIBS"
+      CFLAGS="$CFLAGS $SDL_CFLAGS"
+      CXXFLAGS="$CXXFLAGS $SDL_CFLAGS"
+      LIBS="$LIBS $SDL_LIBS"
+      rm -f conf.sdltest
+      if test "$cross_compiling" = yes; then :
+  echo $ac_n "cross compiling; assumed OK... $ac_c"
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#include <stdio.h>
+#include <stdlib.h>
+#include <string.h>
+#include "SDL.h"
+
+char*
+my_strdup (char *str)
+{
+  char *new_str;
+
+  if (str)
+    {
+      new_str = (char *)malloc ((strlen (str) + 1) * sizeof(char));
+      strcpy (new_str, str);
+    }
+  else
+    new_str = NULL;
+
+  return new_str;
+}
+
+int main (int argc, char *argv[])
+{
+  int major, minor, micro;
+  char *tmp_version;
+
+  /* This hangs on some systems (?)
+  system ("touch conf.sdltest");
+  */
+  { FILE *fp = fopen("conf.sdltest", "a"); if ( fp ) fclose(fp); }
+
+  /* HP/UX 9 (%@#!) writes to sscanf strings */
+  tmp_version = my_strdup("$min_sdl_version");
+  if (sscanf(tmp_version, "%d.%d.%d", &major, &minor, &micro) != 3) {
+     printf("%s, bad version string\n", "$min_sdl_version");
+     exit(1);
+   }
+
+   if (($sdl_major_version > major) ||
+      (($sdl_major_version == major) && ($sdl_minor_version > minor)) ||
+      (($sdl_major_version == major) && ($sdl_minor_version == minor) && ($sdl_micro_version >= micro)))
+    {
+      return 0;
+    }
+  else
+    {
+      printf("\n*** 'sdl-config --version' returned %d.%d.%d, but the minimum version\n", $sdl_major_version, $sdl_minor_version, $sdl_micro_version);
+      printf("*** of SDL required is %d.%d.%d. If sdl-config is correct, then it is\n", major, minor, micro);
+      printf("*** best to upgrade to the required version.\n");
+      printf("*** If sdl-config was wrong, set the environment variable SDL_CONFIG\n");
+      printf("*** to point to the correct copy of sdl-config, and remove the file\n");
+      printf("*** config.cache before re-running configure\n");
+      return 1;
+    }
+}
+
+
+_ACEOF
+if ac_fn_c_try_run "$LINENO"; then :
+
+else
+  no_sdl=yes
+fi
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
+fi
+
+       CFLAGS="$ac_save_CFLAGS"
+       CXXFLAGS="$ac_save_CXXFLAGS"
+       LIBS="$ac_save_LIBS"
+     fi
   fi
   if test "x$no_sdl" = x ; then
      { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
@@ -12790,6 +12858,55 @@
        echo "*** If SDL was installed in PREFIX, make sure PREFIX/bin is in"
        echo "*** your path, or set the SDL_CONFIG environment variable to the"
        echo "*** full path to sdl-config."
+     else
+       if test -f conf.sdltest ; then
+        :
+       else
+          echo "*** Could not run SDL test program, checking why..."
+          CFLAGS="$CFLAGS $SDL_CFLAGS"
+          CXXFLAGS="$CXXFLAGS $SDL_CFLAGS"
+          LIBS="$LIBS $SDL_LIBS"
+          cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#include <stdio.h>
+#include "SDL.h"
+
+int main(int argc, char *argv[])
+{ return 0; }
+#undef  main
+#define main K_and_R_C_main
+
+int
+main ()
+{
+ return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+   echo "*** The test program compiled, but did not run. This usually means"
+          echo "*** that the run-time linker is not finding SDL or finding the wrong"
+          echo "*** version of SDL. If it is not finding SDL, you'll need to set your"
+          echo "*** LD_LIBRARY_PATH environment variable, or edit /etc/ld.so.conf to point"
+          echo "*** to the installed location  Also, make sure you have run ldconfig if that"
+          echo "*** is required on your system"
+	  echo "***"
+          echo "*** If you have an old version installed, it is best to remove it, although"
+          echo "*** you may also be able to get things to work by modifying LD_LIBRARY_PATH"
+else
+   echo "*** The test program failed to compile or link. See the file config.log for the"
+          echo "*** exact error that occured. This usually means SDL was incorrectly installed"
+          echo "*** or that you have moved SDL since it was installed. In the latter case, you"
+          echo "*** may want to edit the sdl-config script: $SDL_CONFIG"
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+          CFLAGS="$ac_save_CFLAGS"
+          CXXFLAGS="$ac_save_CXXFLAGS"
+          LIBS="$ac_save_LIBS"
+       fi
      fi
      SDL_CFLAGS=""
      SDL_LIBS=""
@@ -12832,48 +12949,71 @@
 
 
 if test "$have_projectm1" = "yes"; then
-	pkg_failed=no
+
+pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for LIBPROJECTM1" >&5
 $as_echo_n "checking for LIBPROJECTM1... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libprojectM >= 1.1\""; } >&5
+
+if test -n "$LIBPROJECTM1_CFLAGS"; then
+    pkg_cv_LIBPROJECTM1_CFLAGS="$LIBPROJECTM1_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libprojectM >= 1.1\""; } >&5
   ($PKG_CONFIG --exists --print-errors "libprojectM >= 1.1") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${LIBPROJECTM1_CFLAGS}" != "x"; then
-            pkg_cv_LIBPROJECTM1_CFLAGS="${LIBPROJECTM1_CFLAGS}"
-        else
-            pkg_cv_LIBPROJECTM1_CFLAGS=`$PKG_CONFIG --cflags "libprojectM >= 1.1" 2>/dev/null`
-        fi
-        if test "x${LIBPROJECTM1_LIBS}" != "x"; then
-            pkg_cv_LIBPROJECTM1_LIBS="${LIBPROJECTM1_LIBS}"
-        else
-            pkg_cv_LIBPROJECTM1_LIBS=`$PKG_CONFIG --libs "libprojectM >= 1.1" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_LIBPROJECTM1_CFLAGS=`$PKG_CONFIG --cflags "libprojectM >= 1.1" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LIBPROJECTM1_LIBS"; then
+    pkg_cv_LIBPROJECTM1_LIBS="$LIBPROJECTM1_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libprojectM >= 1.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "libprojectM >= 1.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LIBPROJECTM1_LIBS=`$PKG_CONFIG --libs "libprojectM >= 1.1" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        LIBPROJECTM1_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "libprojectM >= 1.1" 2>&1`
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LIBPROJECTM1_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "libprojectM >= 1.1" 2>&1`
         else
-	        LIBPROJECTM1_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "libprojectM >= 1.1" 2>&1`
+	        LIBPROJECTM1_PKG_ERRORS=`$PKG_CONFIG --print-errors "libprojectM >= 1.1" 2>&1`
         fi
-		echo "$LIBPROJECTM1_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+	# Put the nasty error message in config.log where it belongs
+	echo "$LIBPROJECTM1_PKG_ERRORS" >&5
+
+	have_projectm1="no"
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-                have_projectm1="no"
-elif test "x$pkg_failed" = "xuntried"; then
 	have_projectm1="no"
 else
-	LIBPROJECTM1_CFLAGS="$pkg_cv_LIBPROJECTM1_CFLAGS"
-	LIBPROJECTM1_LIBS="$pkg_cv_LIBPROJECTM1_LIBS"
+	LIBPROJECTM1_CFLAGS=$pkg_cv_LIBPROJECTM1_CFLAGS
+	LIBPROJECTM1_LIBS=$pkg_cv_LIBPROJECTM1_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 	have_projectm1="yes"
@@ -12881,48 +13021,71 @@
 fi
 
 if test "$have_projectm1" = "yes"; then
-	pkg_failed=no
+
+pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for GTKGLEXT" >&5
 $as_echo_n "checking for GTKGLEXT... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"gtkglext-1.0\""; } >&5
+
+if test -n "$GTKGLEXT_CFLAGS"; then
+    pkg_cv_GTKGLEXT_CFLAGS="$GTKGLEXT_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"gtkglext-1.0\""; } >&5
   ($PKG_CONFIG --exists --print-errors "gtkglext-1.0") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${GTKGLEXT_CFLAGS}" != "x"; then
-            pkg_cv_GTKGLEXT_CFLAGS="${GTKGLEXT_CFLAGS}"
-        else
-            pkg_cv_GTKGLEXT_CFLAGS=`$PKG_CONFIG --cflags "gtkglext-1.0" 2>/dev/null`
-        fi
-        if test "x${GTKGLEXT_LIBS}" != "x"; then
-            pkg_cv_GTKGLEXT_LIBS="${GTKGLEXT_LIBS}"
-        else
-            pkg_cv_GTKGLEXT_LIBS=`$PKG_CONFIG --libs "gtkglext-1.0" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_GTKGLEXT_CFLAGS=`$PKG_CONFIG --cflags "gtkglext-1.0" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$GTKGLEXT_LIBS"; then
+    pkg_cv_GTKGLEXT_LIBS="$GTKGLEXT_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"gtkglext-1.0\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "gtkglext-1.0") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_GTKGLEXT_LIBS=`$PKG_CONFIG --libs "gtkglext-1.0" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        GTKGLEXT_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "gtkglext-1.0" 2>&1`
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        GTKGLEXT_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "gtkglext-1.0" 2>&1`
         else
-	        GTKGLEXT_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "gtkglext-1.0" 2>&1`
+	        GTKGLEXT_PKG_ERRORS=`$PKG_CONFIG --print-errors "gtkglext-1.0" 2>&1`
         fi
-		echo "$GTKGLEXT_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+	# Put the nasty error message in config.log where it belongs
+	echo "$GTKGLEXT_PKG_ERRORS" >&5
+
+	have_projectm1="no"
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-                have_projectm1="no"
-elif test "x$pkg_failed" = "xuntried"; then
 	have_projectm1="no"
 else
-	GTKGLEXT_CFLAGS="$pkg_cv_GTKGLEXT_CFLAGS"
-	GTKGLEXT_LIBS="$pkg_cv_GTKGLEXT_LIBS"
+	GTKGLEXT_CFLAGS=$pkg_cv_GTKGLEXT_CFLAGS
+	GTKGLEXT_LIBS=$pkg_cv_GTKGLEXT_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 	have_projectm1="yes"
@@ -12970,9 +13133,10 @@
 
 
 if test "x$enable_filewriter_mp3" = "xyes"; then
-   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for lame_get_id3v2_tag in -lmp3lame -lm" >&5
+   as_ac_Lib=`$as_echo "ac_cv_lib_mp3lame -lm''_lame_get_id3v2_tag" | $as_tr_sh`
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for lame_get_id3v2_tag in -lmp3lame -lm" >&5
 $as_echo_n "checking for lame_get_id3v2_tag in -lmp3lame -lm... " >&6; }
-if test "${ac_cv_lib_mp3lame__lm_lame_get_id3v2_tag+set}" = set; then :
+if eval "test \"\${$as_ac_Lib+set}\"" = set; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -12996,17 +13160,18 @@
 }
 _ACEOF
 if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_lib_mp3lame__lm_lame_get_id3v2_tag=yes
+  eval "$as_ac_Lib=yes"
 else
-  ac_cv_lib_mp3lame__lm_lame_get_id3v2_tag=no
+  eval "$as_ac_Lib=no"
 fi
 rm -f core conftest.err conftest.$ac_objext \
     conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_mp3lame__lm_lame_get_id3v2_tag" >&5
-$as_echo "$ac_cv_lib_mp3lame__lm_lame_get_id3v2_tag" >&6; }
-if test "x$ac_cv_lib_mp3lame__lm_lame_get_id3v2_tag" = x""yes; then :
+eval ac_res=\$$as_ac_Lib
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+if eval test \"x\$"$as_ac_Lib"\" = x"yes"; then :
   have_lame=yes
 else
   have_lame=no
@@ -13031,48 +13196,71 @@
 
 
 if test "x$enable_filewriter_vorbis" = "xyes"; then
-   pkg_failed=no
+
+pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for OGG_VORBIS" >&5
 $as_echo_n "checking for OGG_VORBIS... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"ogg >= 1.0 vorbis >= 1.0 vorbisfile >= 1.0\""; } >&5
+
+if test -n "$OGG_VORBIS_CFLAGS"; then
+    pkg_cv_OGG_VORBIS_CFLAGS="$OGG_VORBIS_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"ogg >= 1.0 vorbis >= 1.0 vorbisfile >= 1.0\""; } >&5
   ($PKG_CONFIG --exists --print-errors "ogg >= 1.0 vorbis >= 1.0 vorbisfile >= 1.0") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${OGG_VORBIS_CFLAGS}" != "x"; then
-            pkg_cv_OGG_VORBIS_CFLAGS="${OGG_VORBIS_CFLAGS}"
-        else
-            pkg_cv_OGG_VORBIS_CFLAGS=`$PKG_CONFIG --cflags "ogg >= 1.0 vorbis >= 1.0 vorbisfile >= 1.0" 2>/dev/null`
-        fi
-        if test "x${OGG_VORBIS_LIBS}" != "x"; then
-            pkg_cv_OGG_VORBIS_LIBS="${OGG_VORBIS_LIBS}"
-        else
-            pkg_cv_OGG_VORBIS_LIBS=`$PKG_CONFIG --libs "ogg >= 1.0 vorbis >= 1.0 vorbisfile >= 1.0" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_OGG_VORBIS_CFLAGS=`$PKG_CONFIG --cflags "ogg >= 1.0 vorbis >= 1.0 vorbisfile >= 1.0" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$OGG_VORBIS_LIBS"; then
+    pkg_cv_OGG_VORBIS_LIBS="$OGG_VORBIS_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"ogg >= 1.0 vorbis >= 1.0 vorbisfile >= 1.0\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "ogg >= 1.0 vorbis >= 1.0 vorbisfile >= 1.0") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_OGG_VORBIS_LIBS=`$PKG_CONFIG --libs "ogg >= 1.0 vorbis >= 1.0 vorbisfile >= 1.0" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        OGG_VORBIS_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "ogg >= 1.0 vorbis >= 1.0 vorbisfile >= 1.0" 2>&1`
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        OGG_VORBIS_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "ogg >= 1.0 vorbis >= 1.0 vorbisfile >= 1.0" 2>&1`
         else
-	        OGG_VORBIS_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "ogg >= 1.0 vorbis >= 1.0 vorbisfile >= 1.0" 2>&1`
+	        OGG_VORBIS_PKG_ERRORS=`$PKG_CONFIG --print-errors "ogg >= 1.0 vorbis >= 1.0 vorbisfile >= 1.0" 2>&1`
         fi
-		echo "$OGG_VORBIS_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+	# Put the nasty error message in config.log where it belongs
+	echo "$OGG_VORBIS_PKG_ERRORS" >&5
+
+	have_vorbisenc=no
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-                have_vorbisenc=no
-elif test "x$pkg_failed" = "xuntried"; then
 	have_vorbisenc=no
 else
-	OGG_VORBIS_CFLAGS="$pkg_cv_OGG_VORBIS_CFLAGS"
-	OGG_VORBIS_LIBS="$pkg_cv_OGG_VORBIS_LIBS"
+	OGG_VORBIS_CFLAGS=$pkg_cv_OGG_VORBIS_CFLAGS
+	OGG_VORBIS_LIBS=$pkg_cv_OGG_VORBIS_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 	have_vorbisenc=yes
@@ -13097,50 +13285,73 @@
 
 
 if test "x$enable_filewriter_flac" = "xyes"; then
-   pkg_failed=no
+
+pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for FLAC" >&5
 $as_echo_n "checking for FLAC... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"flac >= 1.1.2\""; } >&5
+
+if test -n "$FLAC_CFLAGS"; then
+    pkg_cv_FLAC_CFLAGS="$FLAC_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"flac >= 1.1.2\""; } >&5
   ($PKG_CONFIG --exists --print-errors "flac >= 1.1.2") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${FLAC_CFLAGS}" != "x"; then
-            pkg_cv_FLAC_CFLAGS="${FLAC_CFLAGS}"
-        else
-            pkg_cv_FLAC_CFLAGS=`$PKG_CONFIG --cflags "flac >= 1.1.2" 2>/dev/null`
-        fi
-        if test "x${FLAC_LIBS}" != "x"; then
-            pkg_cv_FLAC_LIBS="${FLAC_LIBS}"
-        else
-            pkg_cv_FLAC_LIBS=`$PKG_CONFIG --libs "flac >= 1.1.2" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_FLAC_CFLAGS=`$PKG_CONFIG --cflags "flac >= 1.1.2" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$FLAC_LIBS"; then
+    pkg_cv_FLAC_LIBS="$FLAC_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"flac >= 1.1.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "flac >= 1.1.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_FLAC_LIBS=`$PKG_CONFIG --libs "flac >= 1.1.2" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        FLAC_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "flac >= 1.1.2" 2>&1`
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        FLAC_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "flac >= 1.1.2" 2>&1`
         else
-	        FLAC_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "flac >= 1.1.2" 2>&1`
+	        FLAC_PKG_ERRORS=`$PKG_CONFIG --print-errors "flac >= 1.1.2" 2>&1`
         fi
-		echo "$FLAC_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-                have_writer_flac=no
+	# Put the nasty error message in config.log where it belongs
+	echo "$FLAC_PKG_ERRORS" >&5
+
+	have_writer_flac=no
 
-elif test "x$pkg_failed" = "xuntried"; then
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 	have_writer_flac=no
 
 else
-	FLAC_CFLAGS="$pkg_cv_FLAC_CFLAGS"
-	FLAC_LIBS="$pkg_cv_FLAC_LIBS"
+	FLAC_CFLAGS=$pkg_cv_FLAC_CFLAGS
+	FLAC_LIBS=$pkg_cv_FLAC_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 	have_writer_flac=yes
@@ -13174,48 +13385,71 @@
 
 
 if test "x$enable_bs2b" = "xyes"; then
-    pkg_failed=no
+
+pkg_failed=no
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for BS2B" >&5
 $as_echo_n "checking for BS2B... " >&6; }
-if test "x$PKG_CONFIG" != "x"; then
-    if { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libbs2b >= 3.0.0\""; } >&5
+
+if test -n "$BS2B_CFLAGS"; then
+    pkg_cv_BS2B_CFLAGS="$BS2B_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libbs2b >= 3.0.0\""; } >&5
   ($PKG_CONFIG --exists --print-errors "libbs2b >= 3.0.0") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-        if test "x${BS2B_CFLAGS}" != "x"; then
-            pkg_cv_BS2B_CFLAGS="${BS2B_CFLAGS}"
-        else
-            pkg_cv_BS2B_CFLAGS=`$PKG_CONFIG --cflags "libbs2b >= 3.0.0" 2>/dev/null`
-        fi
-        if test "x${BS2B_LIBS}" != "x"; then
-            pkg_cv_BS2B_LIBS="${BS2B_LIBS}"
-        else
-            pkg_cv_BS2B_LIBS=`$PKG_CONFIG --libs "libbs2b >= 3.0.0" 2>/dev/null`
-        fi
-    else
-        pkg_failed="yes"
-    fi
+  pkg_cv_BS2B_CFLAGS=`$PKG_CONFIG --cflags "libbs2b >= 3.0.0" 2>/dev/null`
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$BS2B_LIBS"; then
+    pkg_cv_BS2B_LIBS="$BS2B_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libbs2b >= 3.0.0\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "libbs2b >= 3.0.0") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_BS2B_LIBS=`$PKG_CONFIG --libs "libbs2b >= 3.0.0" 2>/dev/null`
 else
-	pkg_failed="untried"
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
 
-if test "x$pkg_failed" = "xyes"; then
-        if test "x$_pkg_short_errors_supported" = "xyes"; then
-	        BS2B_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "libbs2b >= 3.0.0" 2>&1`
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        BS2B_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors "libbs2b >= 3.0.0" 2>&1`
         else
-	        BS2B_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "libbs2b >= 3.0.0" 2>&1`
+	        BS2B_PKG_ERRORS=`$PKG_CONFIG --print-errors "libbs2b >= 3.0.0" 2>&1`
         fi
-		echo "$BS2B_PKG_ERRORS" >&5
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+	# Put the nasty error message in config.log where it belongs
+	echo "$BS2B_PKG_ERRORS" >&5
+
+	have_bs2b=no
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-                have_bs2b=no
-elif test "x$pkg_failed" = "xuntried"; then
 	have_bs2b=no
 else
-	BS2B_CFLAGS="$pkg_cv_BS2B_CFLAGS"
-	BS2B_LIBS="$pkg_cv_BS2B_LIBS"
+	BS2B_CFLAGS=$pkg_cv_BS2B_CFLAGS
+	BS2B_LIBS=$pkg_cv_BS2B_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 	have_bs2b=yes
@@ -13388,14 +13622,7 @@
 ac_config_files="$ac_config_files buildsys.mk extra.mk"
 
 
-
-	${as_echo:="echo"} "${as_me:="configure"}: touching .deps files"
-	for i in $(find . -name Makefile); do
-		DEPSFILE="$(dirname $i)/.deps"
-		test -f "$DEPSFILE" && rm "$DEPSFILE"
-		touch -t 0001010000 "$DEPSFILE"
-	done
-
+BUILDSYS_TOUCH_DEPS
 cat >confcache <<\_ACEOF
 # This file is a shell script that caches the results of configure
 # tests run on this system so they can be shared between configure
@@ -13479,6 +13706,7 @@
 
 ac_libobjs=
 ac_ltlibobjs=
+U=
 for ac_i in : $LIBOBJS; do test "x$ac_i" = x: && continue
   # 1. Remove the extension, and $U if already installed.
   ac_script='s/\$U\././;s/\.o$//;s/\.obj$//'
@@ -13495,43 +13723,43 @@
 
 
 if test -z "${AMDEP_TRUE}" && test -z "${AMDEP_FALSE}"; then
-  as_fn_error "conditional \"AMDEP\" was never defined.
+  as_fn_error $? "conditional \"AMDEP\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${am__fastdepCCAS_TRUE}" && test -z "${am__fastdepCCAS_FALSE}"; then
-  as_fn_error "conditional \"am__fastdepCCAS\" was never defined.
+  as_fn_error $? "conditional \"am__fastdepCCAS\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${USE_IPV6_TRUE}" && test -z "${USE_IPV6_FALSE}"; then
-  as_fn_error "conditional \"USE_IPV6\" was never defined.
+  as_fn_error $? "conditional \"USE_IPV6\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${USE_CHARDET_TRUE}" && test -z "${USE_CHARDET_FALSE}"; then
-  as_fn_error "conditional \"USE_CHARDET\" was never defined.
+  as_fn_error $? "conditional \"USE_CHARDET\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${HAVE_CDROM_TRUE}" && test -z "${HAVE_CDROM_FALSE}"; then
-  as_fn_error "conditional \"HAVE_CDROM\" was never defined.
+  as_fn_error $? "conditional \"HAVE_CDROM\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${HAVE_LINUX_JOYSTICK_TRUE}" && test -z "${HAVE_LINUX_JOYSTICK_FALSE}"; then
-  as_fn_error "conditional \"HAVE_LINUX_JOYSTICK\" was never defined.
+  as_fn_error $? "conditional \"HAVE_LINUX_JOYSTICK\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${ARCH_X86_TRUE}" && test -z "${ARCH_X86_FALSE}"; then
-  as_fn_error "conditional \"ARCH_X86\" was never defined.
+  as_fn_error $? "conditional \"ARCH_X86\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${USE_X86ASM_TRUE}" && test -z "${USE_X86ASM_FALSE}"; then
-  as_fn_error "conditional \"USE_X86ASM\" was never defined.
+  as_fn_error $? "conditional \"USE_X86ASM\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${HAVE_SOLARIS_TRUE}" && test -z "${HAVE_SOLARIS_FALSE}"; then
-  as_fn_error "conditional \"HAVE_SOLARIS\" was never defined.
+  as_fn_error $? "conditional \"HAVE_SOLARIS\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${HAVE_SUN_TRUE}" && test -z "${HAVE_SUN_FALSE}"; then
-  as_fn_error "conditional \"HAVE_SUN\" was never defined.
+  as_fn_error $? "conditional \"HAVE_SUN\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 
@@ -13681,19 +13909,19 @@
 (unset CDPATH) >/dev/null 2>&1 && unset CDPATH
 
 
-# as_fn_error ERROR [LINENO LOG_FD]
-# ---------------------------------
+# as_fn_error STATUS ERROR [LINENO LOG_FD]
+# ----------------------------------------
 # Output "`basename $0`: error: ERROR" to stderr. If LINENO and LOG_FD are
 # provided, also output the error to LOG_FD, referencing LINENO. Then exit the
-# script with status $?, using 1 if that was 0.
+# script with STATUS, using 1 if that was 0.
 as_fn_error ()
 {
-  as_status=$?; test $as_status -eq 0 && as_status=1
-  if test "$3"; then
-    as_lineno=${as_lineno-"$2"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
-    $as_echo "$as_me:${as_lineno-$LINENO}: error: $1" >&$3
+  as_status=$1; test $as_status -eq 0 && as_status=1
+  if test "$4"; then
+    as_lineno=${as_lineno-"$3"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+    $as_echo "$as_me:${as_lineno-$LINENO}: error: $2" >&$4
   fi
-  $as_echo "$as_me: error: $1" >&2
+  $as_echo "$as_me: error: $2" >&2
   as_fn_exit $as_status
 } # as_fn_error
 
@@ -13889,7 +14117,7 @@
       test -d "$as_dir" && break
     done
     test -z "$as_dirs" || eval "mkdir $as_dirs"
-  } || test -d "$as_dir" || as_fn_error "cannot create directory $as_dir"
+  } || test -d "$as_dir" || as_fn_error $? "cannot create directory $as_dir"
 
 
 } # as_fn_mkdir_p
@@ -13943,7 +14171,7 @@
 # values after options handling.
 ac_log="
 This file was extended by audacious-plugins $as_me 2.4.0, which was
-generated by GNU Autoconf 2.65.  Invocation command line was
+generated by GNU Autoconf 2.67.  Invocation command line was
 
   CONFIG_FILES    = $CONFIG_FILES
   CONFIG_HEADERS  = $CONFIG_HEADERS
@@ -14009,16 +14237,17 @@
 ac_cs_config="`$as_echo "$ac_configure_args" | sed 's/^ //; s/[\\""\`\$]/\\\\&/g'`"
 ac_cs_version="\\
 audacious-plugins config.status 2.4.0
-configured by $0, generated by GNU Autoconf 2.65,
+configured by $0, generated by GNU Autoconf 2.67,
   with options \\"\$ac_cs_config\\"
 
-Copyright (C) 2009 Free Software Foundation, Inc.
+Copyright (C) 2010 Free Software Foundation, Inc.
 This config.status script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it."
 
 ac_pwd='$ac_pwd'
 srcdir='$srcdir'
 INSTALL='$INSTALL'
+MKDIR_P='$MKDIR_P'
 test -n "\$AWK" || AWK=awk
 _ACEOF
 
@@ -14028,11 +14257,16 @@
 while test $# != 0
 do
   case $1 in
-  --*=*)
+  --*=?*)
     ac_option=`expr "X$1" : 'X\([^=]*\)='`
     ac_optarg=`expr "X$1" : 'X[^=]*=\(.*\)'`
     ac_shift=:
     ;;
+  --*=)
+    ac_option=`expr "X$1" : 'X\([^=]*\)='`
+    ac_optarg=
+    ac_shift=:
+    ;;
   *)
     ac_option=$1
     ac_optarg=$2
@@ -14054,6 +14288,7 @@
     $ac_shift
     case $ac_optarg in
     *\'*) ac_optarg=`$as_echo "$ac_optarg" | sed "s/'/'\\\\\\\\''/g"` ;;
+    '') as_fn_error $? "missing file argument" ;;
     esac
     as_fn_append CONFIG_FILES " '$ac_optarg'"
     ac_need_defaults=false;;
@@ -14066,7 +14301,7 @@
     ac_need_defaults=false;;
   --he | --h)
     # Conflict between --help and --header
-    as_fn_error "ambiguous option: \`$1'
+    as_fn_error $? "ambiguous option: \`$1'
 Try \`$0 --help' for more information.";;
   --help | --hel | -h )
     $as_echo "$ac_cs_usage"; exit ;;
@@ -14075,7 +14310,7 @@
     ac_cs_silent=: ;;
 
   # This is an error.
-  -*) as_fn_error "unrecognized option: \`$1'
+  -*) as_fn_error $? "unrecognized option: \`$1'
 Try \`$0 --help' for more information." ;;
 
   *) as_fn_append ac_config_targets " $1"
@@ -14121,8 +14356,8 @@
 #
 AMDEP_TRUE="$AMDEP_TRUE" ac_aux_dir="$ac_aux_dir"
 # Capture the value of obsolete ALL_LINGUAS because we need it to compute
-    # POFILES, GMOFILES, UPDATEPOFILES, DUMMYPOFILES, CATALOGS. But hide it
-    # from automake.
+    # POFILES, UPDATEPOFILES, DUMMYPOFILES, GMOFILES, CATALOGS. But hide it
+    # from automake < 1.5.
     eval 'OBSOLETE_ALL_LINGUAS''="$ALL_LINGUAS"'
     # Capture the value of LINGUAS because we need it to compute CATALOGS.
     LINGUAS="${LINGUAS-%UNSET%}"
@@ -14138,11 +14373,11 @@
   case $ac_config_target in
     "config.h") CONFIG_HEADERS="$CONFIG_HEADERS config.h" ;;
     "depfiles") CONFIG_COMMANDS="$CONFIG_COMMANDS depfiles" ;;
-    "default-1") CONFIG_COMMANDS="$CONFIG_COMMANDS default-1" ;;
+    "po-directories") CONFIG_COMMANDS="$CONFIG_COMMANDS po-directories" ;;
     "buildsys.mk") CONFIG_FILES="$CONFIG_FILES buildsys.mk" ;;
     "extra.mk") CONFIG_FILES="$CONFIG_FILES extra.mk" ;;
 
-  *) as_fn_error "invalid argument: \`$ac_config_target'" "$LINENO" 5;;
+  *) as_fn_error $? "invalid argument: \`$ac_config_target'" "$LINENO" 5 ;;
   esac
 done
 
@@ -14180,7 +14415,7 @@
 {
   tmp=./conf$$-$RANDOM
   (umask 077 && mkdir "$tmp")
-} || as_fn_error "cannot create a temporary directory in ." "$LINENO" 5
+} || as_fn_error $? "cannot create a temporary directory in ." "$LINENO" 5
 
 # Set up the scripts for CONFIG_FILES section.
 # No need to generate them if there are no CONFIG_FILES.
@@ -14197,7 +14432,7 @@
 fi
 ac_cs_awk_cr=`$AWK 'BEGIN { print "a\rb" }' </dev/null 2>/dev/null`
 if test "$ac_cs_awk_cr" = "a${ac_cr}b"; then
-  ac_cs_awk_cr='\r'
+  ac_cs_awk_cr='\\r'
 else
   ac_cs_awk_cr=$ac_cr
 fi
@@ -14211,18 +14446,18 @@
   echo "$ac_subst_vars" | sed 's/.*/&!$&$ac_delim/' &&
   echo "_ACEOF"
 } >conf$$subs.sh ||
-  as_fn_error "could not make $CONFIG_STATUS" "$LINENO" 5
-ac_delim_num=`echo "$ac_subst_vars" | grep -c '$'`
+  as_fn_error $? "could not make $CONFIG_STATUS" "$LINENO" 5
+ac_delim_num=`echo "$ac_subst_vars" | grep -c '^'`
 ac_delim='%!_!# '
 for ac_last_try in false false false false false :; do
   . ./conf$$subs.sh ||
-    as_fn_error "could not make $CONFIG_STATUS" "$LINENO" 5
+    as_fn_error $? "could not make $CONFIG_STATUS" "$LINENO" 5
 
   ac_delim_n=`sed -n "s/.*$ac_delim\$/X/p" conf$$subs.awk | grep -c X`
   if test $ac_delim_n = $ac_delim_num; then
     break
   elif $ac_last_try; then
-    as_fn_error "could not make $CONFIG_STATUS" "$LINENO" 5
+    as_fn_error $? "could not make $CONFIG_STATUS" "$LINENO" 5
   else
     ac_delim="$ac_delim!$ac_delim _$ac_delim!! "
   fi
@@ -14311,20 +14546,28 @@
 else
   cat
 fi < "$tmp/subs1.awk" > "$tmp/subs.awk" \
-  || as_fn_error "could not setup config files machinery" "$LINENO" 5
+  || as_fn_error $? "could not setup config files machinery" "$LINENO" 5
 _ACEOF
 
-# VPATH may cause trouble with some makes, so we remove $(srcdir),
-# ${srcdir} and @srcdir@ from VPATH if srcdir is ".", strip leading and
+# VPATH may cause trouble with some makes, so we remove sole $(srcdir),
+# ${srcdir} and @srcdir@ entries from VPATH if srcdir is ".", strip leading and
 # trailing colons and then remove the whole line if VPATH becomes empty
 # (actually we leave an empty line to preserve line numbers).
 if test "x$srcdir" = x.; then
-  ac_vpsub='/^[	 ]*VPATH[	 ]*=/{
-s/:*\$(srcdir):*/:/
-s/:*\${srcdir}:*/:/
-s/:*@srcdir@:*/:/
-s/^\([^=]*=[	 ]*\):*/\1/
+  ac_vpsub='/^[	 ]*VPATH[	 ]*=[	 ]*/{
+h
+s///
+s/^/:/
+s/[	 ]*$/:/
+s/:\$(srcdir):/:/g
+s/:\${srcdir}:/:/g
+s/:@srcdir@:/:/g
+s/^:*//
 s/:*$//
+x
+s/\(=[	 ]*\).*/\1/
+G
+s/\n//
 s/^[^=]*=[	 ]*$//
 }'
 fi
@@ -14352,7 +14595,7 @@
   if test -z "$ac_t"; then
     break
   elif $ac_last_try; then
-    as_fn_error "could not make $CONFIG_HEADERS" "$LINENO" 5
+    as_fn_error $? "could not make $CONFIG_HEADERS" "$LINENO" 5
   else
     ac_delim="$ac_delim!$ac_delim _$ac_delim!! "
   fi
@@ -14437,7 +14680,7 @@
 _ACAWK
 _ACEOF
 cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
-  as_fn_error "could not setup config headers machinery" "$LINENO" 5
+  as_fn_error $? "could not setup config headers machinery" "$LINENO" 5
 fi # test -n "$CONFIG_HEADERS"
 
 
@@ -14450,7 +14693,7 @@
   esac
   case $ac_mode$ac_tag in
   :[FHL]*:*);;
-  :L* | :C*:*) as_fn_error "invalid tag \`$ac_tag'" "$LINENO" 5;;
+  :L* | :C*:*) as_fn_error $? "invalid tag \`$ac_tag'" "$LINENO" 5 ;;
   :[FH]-) ac_tag=-:-;;
   :[FH]*) ac_tag=$ac_tag:$ac_tag.in;;
   esac
@@ -14478,7 +14721,7 @@
 	   [\\/$]*) false;;
 	   *) test -f "$srcdir/$ac_f" && ac_f="$srcdir/$ac_f";;
 	   esac ||
-	   as_fn_error "cannot find input file: \`$ac_f'" "$LINENO" 5;;
+	   as_fn_error 1 "cannot find input file: \`$ac_f'" "$LINENO" 5 ;;
       esac
       case $ac_f in *\'*) ac_f=`$as_echo "$ac_f" | sed "s/'/'\\\\\\\\''/g"`;; esac
       as_fn_append ac_file_inputs " '$ac_f'"
@@ -14505,7 +14748,7 @@
 
     case $ac_tag in
     *:-:* | *:-) cat >"$tmp/stdin" \
-      || as_fn_error "could not create $ac_file" "$LINENO" 5 ;;
+      || as_fn_error $? "could not create $ac_file" "$LINENO" 5  ;;
     esac
     ;;
   esac
@@ -14579,6 +14822,11 @@
   [\\/$]* | ?:[\\/]* ) ac_INSTALL=$INSTALL ;;
   *) ac_INSTALL=$ac_top_build_prefix$INSTALL ;;
   esac
+  ac_MKDIR_P=$MKDIR_P
+  case $MKDIR_P in
+  [\\/$]* | ?:[\\/]* ) ;;
+  */*) ac_MKDIR_P=$ac_top_build_prefix$MKDIR_P ;;
+  esac
 _ACEOF
 
 cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
@@ -14633,25 +14881,26 @@
 s&@abs_builddir@&$ac_abs_builddir&;t t
 s&@abs_top_builddir@&$ac_abs_top_builddir&;t t
 s&@INSTALL@&$ac_INSTALL&;t t
+s&@MKDIR_P@&$ac_MKDIR_P&;t t
 $ac_datarootdir_hack
 "
 eval sed \"\$ac_sed_extra\" "$ac_file_inputs" | $AWK -f "$tmp/subs.awk" >$tmp/out \
-  || as_fn_error "could not create $ac_file" "$LINENO" 5
+  || as_fn_error $? "could not create $ac_file" "$LINENO" 5
 
 test -z "$ac_datarootdir_hack$ac_datarootdir_seen" &&
   { ac_out=`sed -n '/\${datarootdir}/p' "$tmp/out"`; test -n "$ac_out"; } &&
   { ac_out=`sed -n '/^[	 ]*datarootdir[	 ]*:*=/p' "$tmp/out"`; test -z "$ac_out"; } &&
   { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $ac_file contains a reference to the variable \`datarootdir'
-which seems to be undefined.  Please make sure it is defined." >&5
+which seems to be undefined.  Please make sure it is defined" >&5
 $as_echo "$as_me: WARNING: $ac_file contains a reference to the variable \`datarootdir'
-which seems to be undefined.  Please make sure it is defined." >&2;}
+which seems to be undefined.  Please make sure it is defined" >&2;}
 
   rm -f "$tmp/stdin"
   case $ac_file in
   -) cat "$tmp/out" && rm -f "$tmp/out";;
   *) rm -f "$ac_file" && mv "$tmp/out" "$ac_file";;
   esac \
-  || as_fn_error "could not create $ac_file" "$LINENO" 5
+  || as_fn_error $? "could not create $ac_file" "$LINENO" 5
  ;;
   :H)
   #
@@ -14662,19 +14911,19 @@
       $as_echo "/* $configure_input  */" \
       && eval '$AWK -f "$tmp/defines.awk"' "$ac_file_inputs"
     } >"$tmp/config.h" \
-      || as_fn_error "could not create $ac_file" "$LINENO" 5
+      || as_fn_error $? "could not create $ac_file" "$LINENO" 5
     if diff "$ac_file" "$tmp/config.h" >/dev/null 2>&1; then
       { $as_echo "$as_me:${as_lineno-$LINENO}: $ac_file is unchanged" >&5
 $as_echo "$as_me: $ac_file is unchanged" >&6;}
     else
       rm -f "$ac_file"
       mv "$tmp/config.h" "$ac_file" \
-	|| as_fn_error "could not create $ac_file" "$LINENO" 5
+	|| as_fn_error $? "could not create $ac_file" "$LINENO" 5
     fi
   else
     $as_echo "/* $configure_input  */" \
       && eval '$AWK -f "$tmp/defines.awk"' "$ac_file_inputs" \
-      || as_fn_error "could not create -" "$LINENO" 5
+      || as_fn_error $? "could not create -" "$LINENO" 5
   fi
  ;;
 
@@ -14780,7 +15029,7 @@
   done
 }
  ;;
-    "default-1":C)
+    "po-directories":C)
     for ac_file in $CONFIG_FILES; do
       # Support "outfile[:infile[:infile...]]"
       case "$ac_file" in
@@ -14800,12 +15049,15 @@
           /*) top_srcdir="$ac_given_srcdir" ;;
           *)  top_srcdir="$ac_dots$ac_given_srcdir" ;;
         esac
+        # Treat a directory as a PO directory if and only if it has a
+        # POTFILES.in file. This allows packages to have multiple PO
+        # directories under different names or in different locations.
         if test -f "$ac_given_srcdir/$ac_dir/POTFILES.in"; then
           rm -f "$ac_dir/POTFILES"
           test -n "$as_me" && echo "$as_me: creating $ac_dir/POTFILES" || echo "creating $ac_dir/POTFILES"
           cat "$ac_given_srcdir/$ac_dir/POTFILES.in" | sed -e "/^#/d" -e "/^[ 	]*\$/d" -e "s,.*,     $top_srcdir/& \\\\," | sed -e "\$s/\(.*\) \\\\/\1/" > "$ac_dir/POTFILES"
           POMAKEFILEDEPS="POTFILES.in"
-          # ALL_LINGUAS, POFILES, GMOFILES, UPDATEPOFILES, DUMMYPOFILES depend
+          # ALL_LINGUAS, POFILES, UPDATEPOFILES, DUMMYPOFILES, GMOFILES depend
           # on $ac_dir but don't depend on user-specified configuration
           # parameters.
           if test -f "$ac_given_srcdir/$ac_dir/LINGUAS"; then
@@ -14813,27 +15065,36 @@
             if test -n "$OBSOLETE_ALL_LINGUAS"; then
               test -n "$as_me" && echo "$as_me: setting ALL_LINGUAS in configure.in is obsolete" || echo "setting ALL_LINGUAS in configure.in is obsolete"
             fi
-            ALL_LINGUAS_=`sed -e "/^#/d" "$ac_given_srcdir/$ac_dir/LINGUAS"`
-            # Hide the ALL_LINGUAS assigment from automake.
+            ALL_LINGUAS_=`sed -e "/^#/d" -e "s/#.*//" "$ac_given_srcdir/$ac_dir/LINGUAS"`
+            # Hide the ALL_LINGUAS assigment from automake < 1.5.
             eval 'ALL_LINGUAS''=$ALL_LINGUAS_'
             POMAKEFILEDEPS="$POMAKEFILEDEPS LINGUAS"
           else
             # The set of available languages was given in configure.in.
+            # Hide the ALL_LINGUAS assigment from automake < 1.5.
             eval 'ALL_LINGUAS''=$OBSOLETE_ALL_LINGUAS'
           fi
+          # Compute POFILES
+          # as      $(foreach lang, $(ALL_LINGUAS), $(srcdir)/$(lang).po)
+          # Compute UPDATEPOFILES
+          # as      $(foreach lang, $(ALL_LINGUAS), $(lang).po-update)
+          # Compute DUMMYPOFILES
+          # as      $(foreach lang, $(ALL_LINGUAS), $(lang).nop)
+          # Compute GMOFILES
+          # as      $(foreach lang, $(ALL_LINGUAS), $(srcdir)/$(lang).gmo)
           case "$ac_given_srcdir" in
             .) srcdirpre= ;;
             *) srcdirpre='$(srcdir)/' ;;
           esac
           POFILES=
-          GMOFILES=
           UPDATEPOFILES=
           DUMMYPOFILES=
+          GMOFILES=
           for lang in $ALL_LINGUAS; do
             POFILES="$POFILES $srcdirpre$lang.po"
-            GMOFILES="$GMOFILES $srcdirpre$lang.gmo"
             UPDATEPOFILES="$UPDATEPOFILES $lang.po-update"
             DUMMYPOFILES="$DUMMYPOFILES $lang.nop"
+            GMOFILES="$GMOFILES $srcdirpre$lang.gmo"
           done
           # CATALOGS depends on both $ac_dir and the user's LINGUAS
           # environment variable.
@@ -14868,7 +15129,7 @@
             done
           fi
           test -n "$as_me" && echo "$as_me: creating $ac_dir/Makefile" || echo "creating $ac_dir/Makefile"
-          sed -e "/^POTFILES =/r $ac_dir/POTFILES" -e "/^# Makevars/r $ac_given_srcdir/$ac_dir/Makevars" -e "s|@POFILES@|$POFILES|g" -e "s|@GMOFILES@|$GMOFILES|g" -e "s|@UPDATEPOFILES@|$UPDATEPOFILES|g" -e "s|@DUMMYPOFILES@|$DUMMYPOFILES|g" -e "s|@CATALOGS@|$CATALOGS|g" -e "s|@POMAKEFILEDEPS@|$POMAKEFILEDEPS|g" "$ac_dir/Makefile.in" > "$ac_dir/Makefile"
+          sed -e "/^POTFILES =/r $ac_dir/POTFILES" -e "/^# Makevars/r $ac_given_srcdir/$ac_dir/Makevars" -e "s|@POFILES@|$POFILES|g" -e "s|@UPDATEPOFILES@|$UPDATEPOFILES|g" -e "s|@DUMMYPOFILES@|$DUMMYPOFILES|g" -e "s|@GMOFILES@|$GMOFILES|g" -e "s|@CATALOGS@|$CATALOGS|g" -e "s|@POMAKEFILEDEPS@|$POMAKEFILEDEPS|g" "$ac_dir/Makefile.in" > "$ac_dir/Makefile"
           for f in "$ac_given_srcdir/$ac_dir"/Rules-*; do
             if test -f "$f"; then
               case "$f" in
@@ -14891,7 +15152,7 @@
 ac_clean_files=$ac_clean_files_save
 
 test $ac_write_fail = 0 ||
-  as_fn_error "write failure creating $CONFIG_STATUS" "$LINENO" 5
+  as_fn_error $? "write failure creating $CONFIG_STATUS" "$LINENO" 5
 
 
 # configure is writing to config.log, and then calls config.status.
@@ -14912,7 +15173,7 @@
   exec 5>>config.log
   # Use ||, not &&, to avoid exiting from the if with $? = 1, which
   # would make configure fail if this is the last instruction.
-  $ac_cs_success || as_fn_exit $?
+  $ac_cs_success || as_fn_exit 1
 fi
 if test -n "$ac_unrecognized_opts" && test "$enable_option_checking" != no; then
   { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: unrecognized options: $ac_unrecognized_opts" >&5
@@ -14961,7 +15222,7 @@
 echo "    -> libSIDPlay2 support:               $xs_have_sidplay2"
 echo "    -> distortion patched libSIDPlay2:    $xs_have_distortion"
 echo "  Game music (spc, nsf & gbs):            yes"
-echo "  PlayStation (psf/psf2) audio (psf):     yes"
+echo "  PlayStation (psf/psf2) audio:           $enable_psf"
 echo "  Nintendo 64 audio (usf):                $enable_usf"
 echo "  Nintendo DS audio (xsf):                yes experimental"
 echo "  AdLib synthesizer (adplug):             $have_adplug"
